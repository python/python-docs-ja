
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>モジュールオブジェクト (module object) &#8212; Python 3.8.3rc1 ドキュメント</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.8.3rc1 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="イテレータオブジェクト (iterator object)" href="iterator.html" />
    <link rel="prev" title="ファイルオブジェクト" href="file.html" />
    <link rel="canonical" href="https://docs.python.org/3/c-api/module.html" />
    
      
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>

    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
     


  </head><body>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="iterator.html" title="イテレータオブジェクト (iterator object)"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="file.html" title="ファイルオブジェクト"
             accesskey="P">前へ</a> |</li>

    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <a href="../index.html">3.8.3rc1 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python/C API リファレンスマニュアル</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="concrete.html" accesskey="U">具象オブジェクト (concrete object) レイヤ</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" type="text" name="q" />
          <input type="submit" value="検索" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-objects">
<span id="moduleobjects"></span><h1>モジュールオブジェクト (module object)<a class="headerlink" href="#module-objects" title="このヘッドラインへのパーマリンク">¶</a></h1>
<span class="target" id="index-0"></span><dl class="var">
<dt id="c.PyModule_Type">
<a class="reference internal" href="type.html#c.PyTypeObject" title="PyTypeObject">PyTypeObject</a> <code class="descname">PyModule_Type</code><a class="headerlink" href="#c.PyModule_Type" title="この定義へのパーマリンク">¶</a></dt>
<dd><p id="index-1">この <a class="reference internal" href="type.html#c.PyTypeObject" title="PyTypeObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyTypeObject</span></code></a> のインスタンスは Python のモジュールオブジェクト型を表現します。このオブジェクトは、Python プログラムには <code class="docutils literal notranslate"><span class="pre">types.ModuleType</span></code>  として公開されています。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_Check">
int <code class="descname">PyModule_Check</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_Check" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>p</em> がモジュールオブジェクトかモジュールオブジェクトのサブタイプであるときに真を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_CheckExact">
int <code class="descname">PyModule_CheckExact</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_CheckExact" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>p</em> がモジュールオブジェクトで、かつモジュールオブジェクトのサブタイプでないときに真を返します。 <a class="reference internal" href="#c.PyModule_Type" title="PyModule_Type"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyModule_Type</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_NewObject">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_NewObject</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_NewObject" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p id="index-2"><a class="reference internal" href="../reference/import.html#__name__" title="__name__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__name__</span></code></a> 属性に <em>name</em> が設定された新しいモジュールオブジェクトを返します。
モジュールの <a class="reference internal" href="../reference/import.html#__name__" title="__name__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__name__</span></code></a>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">__doc__</span></code>, <a class="reference internal" href="../reference/import.html#__package__" title="__package__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__package__</span></code></a>, <a class="reference internal" href="../reference/import.html#__loader__" title="__loader__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__loader__</span></code></a> 属性に値が入っています (<a class="reference internal" href="../reference/import.html#__name__" title="__name__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__name__</span></code></a> 以外は全て <code class="docutils literal notranslate"><span class="pre">None</span></code> です);
<a class="reference internal" href="../reference/import.html#__file__" title="__file__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__file__</span></code></a> 属性に値を入れるのは呼び出し側の責任です。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.3 で追加.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.4 で変更: </span><a class="reference internal" href="../reference/import.html#__package__" title="__package__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__package__</span></code></a> と <a class="reference internal" href="../reference/import.html#__loader__" title="__loader__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__loader__</span></code></a> は <code class="docutils literal notranslate"><span class="pre">None</span></code> に設定されます。</p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_New">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_New</code><span class="sig-paren">(</span>const char<em>&nbsp;*name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_New" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p><a class="reference internal" href="#c.PyModule_NewObject" title="PyModule_NewObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_NewObject()</span></code></a> に似ていますが、 name は Unicode オブジェクトではなく UTF-8 でエンコードされた文字列です。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetDict">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_GetDict</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetDict" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p id="index-3"><em>module</em> の名前空間を実装する辞書オブジェクトを返します;
このオブジェクトは、モジュールオブジェクトの <a class="reference internal" href="../library/stdtypes.html#object.__dict__" title="object.__dict__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__dict__</span></code></a> 属性と同じものです。
<em>module</em> がモジュールオブジェクト (もしくはモジュールオブジェクトのサブタイプ) でない場合は、 <a class="reference internal" href="../library/exceptions.html#SystemError" title="SystemError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SystemError</span></code></a> が送出され <code class="docutils literal notranslate"><span class="pre">NULL</span></code> が返されます。</p>
<p>拡張モジュールでは、モジュールの <a class="reference internal" href="../library/stdtypes.html#object.__dict__" title="object.__dict__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__dict__</span></code></a> を直接操作するよりも、 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_*()</span></code> および <code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_*()</span></code> 関数を使う方が推奨されます。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetNameObject">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_GetNameObject</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetNameObject" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p id="index-4"><em>module</em> の <a class="reference internal" href="../reference/import.html#__name__" title="__name__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__name__</span></code></a> の値を返します。モジュールがこの属性を提供していない場合や文字列型でない場合、 <a class="reference internal" href="../library/exceptions.html#SystemError" title="SystemError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SystemError</span></code></a> を送出して <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.3 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetName">
const char* <code class="descname">PyModule_GetName</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetName" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#c.PyModule_GetNameObject" title="PyModule_GetNameObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetNameObject()</span></code></a> に似ていますが、 <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code> でエンコードされた name を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetState">
void* <code class="descname">PyModule_GetState</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetState" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュールの &quot;state&quot;(モジュールを生成したタイミングで確保されるメモリブロックへのポインター) か、なければ <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。 <a class="reference internal" href="#c.PyModuleDef.m_size" title="PyModuleDef.m_size"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyModuleDef.m_size</span></code></a> を参照してください。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetDef">
<a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a>* <code class="descname">PyModule_GetDef</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetDef" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュールが作られる元となった <a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef</span></code></a> 構造体へのポインタを返します。
モジュールが定義によって作られていなかった場合は <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetFilenameObject">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_GetFilenameObject</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetFilenameObject" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p id="index-5"><em>module</em> の <a class="reference internal" href="../reference/import.html#__file__" title="__file__"><code class="xref py py-attr docutils literal notranslate"><span class="pre">__file__</span></code></a> 属性をもとに <em>module</em> がロードされたもとのファイル名を返します。もしファイル名が定義されていない場合や、 Unicode 文字列ではない場合、 <a class="reference internal" href="../library/exceptions.html#SystemError" title="SystemError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SystemError</span></code></a> を発生させて <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。それ以外の場合は Unicode オブジェクトへの参照を返します。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.2 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_GetFilename">
const char* <code class="descname">PyModule_GetFilename</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_GetFilename" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#c.PyModule_GetFilenameObject" title="PyModule_GetFilenameObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetFilenameObject()</span></code></a> と似ていますが、 'utf-8' でエンコードされたファイル名を返します。</p>
<div class="deprecated">
<p><span class="versionmodified">バージョン 3.2 で非推奨: </span><a class="reference internal" href="#c.PyModule_GetFilename" title="PyModule_GetFilename"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetFilename()</span></code></a> はエンコードできないファイル名に対しては <code class="xref c c-type docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code> を送出します。これの代わりに <a class="reference internal" href="#c.PyModule_GetFilenameObject" title="PyModule_GetFilenameObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetFilenameObject()</span></code></a> を使用してください。</p>
</div>
</dd></dl>

<div class="section" id="initializing-c-modules">
<span id="initializing-modules"></span><h2>Cモジュールの初期化<a class="headerlink" href="#initializing-c-modules" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常、モジュールオブジェクトは拡張モジュール (初期化関数をエクスポートしている共有ライブラリ) または組み込まれたモジュール (<a class="reference internal" href="import.html#c.PyImport_AppendInittab" title="PyImport_AppendInittab"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_AppendInittab()</span></code></a> を使って初期化関数が追加されているモジュール) から作られます。
詳細については <a class="reference internal" href="../extending/building.html#building"><span class="std std-ref">C および C++ 拡張のビルド</span></a> または <a class="reference internal" href="../extending/embedding.html#extending-with-embedding"><span class="std std-ref">埋め込まれた Python の拡張</span></a> を見てください。</p>
<p>初期化関数は、モジュール定義のインスタンスを <a class="reference internal" href="#c.PyModule_Create" title="PyModule_Create"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create()</span></code></a> に渡して出来上がったモジュールオブジェクトを返してもよいですし、もしくは定義構造体そのものを返し&quot;多段階初期化&quot;を要求しても構いません。</p>
<dl class="type">
<dt id="c.PyModuleDef">
<code class="descname">PyModuleDef</code><a class="headerlink" href="#c.PyModuleDef" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュール定義構造体はモジュールオブジェクトを生成するのに必要なすべての情報を保持します。
通常は、それぞれのモジュールごとに静的に初期化されたこの型の変数が1つだけ存在します。</p>
<dl class="member">
<dt id="c.PyModuleDef.m_base">
PyModuleDef_Base <code class="descname">m_base</code><a class="headerlink" href="#c.PyModuleDef.m_base" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このメンバーは常に <code class="xref py py-const docutils literal notranslate"><span class="pre">PyModuleDef_HEAD_INIT</span></code> で初期化してください。</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_name">
const char *<code class="descname">m_name</code><a class="headerlink" href="#c.PyModuleDef.m_name" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>新しいモジュールの名前。</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_doc">
const char *<code class="descname">m_doc</code><a class="headerlink" href="#c.PyModuleDef.m_doc" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Docstring for the module; usually a docstring variable created with
<a class="reference internal" href="intro.html#c.PyDoc_STRVAR" title="PyDoc_STRVAR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyDoc_STRVAR</span></code></a> is used.</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_size">
Py_ssize_t <code class="descname">m_size</code><a class="headerlink" href="#c.PyModuleDef.m_size" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュールの状態は、静的なグローバルな領域ではなく <a class="reference internal" href="#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> で取得できるモジュールごとのメモリ領域に保持されていることがあります。
これによってモジュールは複数のサブ・インタプリターで安全に使えます。</p>
<p>このメモリ領域は <em>m_size</em> に基づいてモジュール作成時に確保され、モジュールオブジェクトが破棄されるときに、 <code class="xref c c-member docutils literal notranslate"><span class="pre">m_free</span></code> 関数があればそれが呼ばれた後で解放されます。</p>
<p><code class="docutils literal notranslate"><span class="pre">m_size</span></code> に <code class="docutils literal notranslate"><span class="pre">-1</span></code> を設定すると、そのモジュールはグローバルな状態を持つためにサブ・インタープリターをサポートしていないということになります。</p>
<p><code class="docutils literal notranslate"><span class="pre">m_size</span></code> を非負の値に設定すると、モジュールは再初期化でき、その状態のために必要となる追加のメモリ量を指定できるということになります。
非負の <code class="docutils literal notranslate"><span class="pre">m_size</span></code> は多段階初期化で必要になります。</p>
<p>詳細は <span class="target" id="index-12"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3121"><strong>PEP 3121</strong></a> を参照。</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_methods">
<a class="reference internal" href="structures.html#c.PyMethodDef" title="PyMethodDef">PyMethodDef</a>* <code class="descname">m_methods</code><a class="headerlink" href="#c.PyModuleDef.m_methods" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="structures.html#c.PyMethodDef" title="PyMethodDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyMethodDef</span></code></a> で定義される、モジュールレベル関数のテーブルへのポインター。関数が存在しない場合は <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を設定することが可能。</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_slots">
<a class="reference internal" href="#c.PyModuleDef_Slot" title="PyModuleDef_Slot">PyModuleDef_Slot</a>* <code class="descname">m_slots</code><a class="headerlink" href="#c.PyModuleDef.m_slots" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>多段階初期化のためのスロット定義の配列で、 <code class="docutils literal notranslate"><span class="pre">{0,</span> <span class="pre">NULL}</span></code> 要素が終端となります。
一段階初期化を使うときは、 <em>m_slots</em> は <code class="docutils literal notranslate"><span class="pre">NULL</span></code> でなければなりません。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 3.5 で変更: </span>バージョン 3.5 より前は、このメンバは常に <code class="docutils literal notranslate"><span class="pre">NULL</span></code> に設定されていて、次のものとして定義されていました:</p>
<blockquote>
<div><dl class="member">
<dt id="c.PyModuleDef.m_reload">
<a class="reference internal" href="gcsupport.html#c.inquiry" title="inquiry">inquiry</a> <code class="descname">m_reload</code><a class="headerlink" href="#c.PyModuleDef.m_reload" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

</div></blockquote>
</div>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_traverse">
<a class="reference internal" href="gcsupport.html#c.traverseproc" title="traverseproc">traverseproc</a> <code class="descname">m_traverse</code><a class="headerlink" href="#c.PyModuleDef.m_traverse" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A traversal function to call during GC traversal of the module object, or
<code class="docutils literal notranslate"><span class="pre">NULL</span></code> if not needed. This function may be called before module state
is allocated (<a class="reference internal" href="#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> may return <cite>NULL</cite>),
and before the <a class="reference internal" href="#c.Py_mod_exec" title="Py_mod_exec"><code class="xref c c-member docutils literal notranslate"><span class="pre">Py_mod_exec</span></code></a> function is executed.</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_clear">
<a class="reference internal" href="gcsupport.html#c.inquiry" title="inquiry">inquiry</a> <code class="descname">m_clear</code><a class="headerlink" href="#c.PyModuleDef.m_clear" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A clear function to call during GC clearing of the module object, or
<code class="docutils literal notranslate"><span class="pre">NULL</span></code> if not needed. This function may be called before module state
is allocated (<a class="reference internal" href="#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> may return <cite>NULL</cite>),
and before the <a class="reference internal" href="#c.Py_mod_exec" title="Py_mod_exec"><code class="xref c c-member docutils literal notranslate"><span class="pre">Py_mod_exec</span></code></a> function is executed.</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef.m_free">
<a class="reference internal" href="typeobj.html#c.freefunc" title="freefunc">freefunc</a> <code class="descname">m_free</code><a class="headerlink" href="#c.PyModuleDef.m_free" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A function to call during deallocation of the module object, or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if
not needed. This function may be called before module state
is allocated (<a class="reference internal" href="#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> may return <cite>NULL</cite>),
and before the <a class="reference internal" href="#c.Py_mod_exec" title="Py_mod_exec"><code class="xref c c-member docutils literal notranslate"><span class="pre">Py_mod_exec</span></code></a> function is executed.</p>
</dd></dl>

</dd></dl>

<div class="section" id="single-phase-initialization">
<h3>一段階初期化<a class="headerlink" href="#single-phase-initialization" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>モジュールの初期化関数が直接モジュールオブジェクトを生成して返す場合があります。
これは&quot;一段階初期化&quot;と呼ばれ、次の2つのモジュール生成関数のどちらか1つを使います:</p>
<dl class="function">
<dt id="c.PyModule_Create">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_Create</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_Create" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p><em>def</em> での定義に従って新しいモジュールオブジェクトを生成します。
これは <a class="reference internal" href="#c.PyModule_Create2" title="PyModule_Create2"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create2()</span></code></a> の <em>module_api_version</em> に <code class="xref py py-const docutils literal notranslate"><span class="pre">PYTHON_API_VERSION</span></code> を設定したときのように振る舞います。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_Create2">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModule_Create2</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em>, int<em>&nbsp;module_api_version</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_Create2" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>APIバージョンを <em>module_api_version</em> として <em>def</em> での定義に従って新しいモジュールオブジェクトを生成します。
もし指定されたバージョンが実行しているインタープリターのバージョンと異なる場合は、 <a class="reference internal" href="../library/exceptions.html#RuntimeWarning" title="RuntimeWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeWarning</span></code></a> を発生させます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">ほとんどの場合、この関数ではなく <a class="reference internal" href="#c.PyModule_Create" title="PyModule_Create"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_Create()</span></code></a> を利用するべきです。この関数は、この関数の必要性を理解しているときにだけ利用してください。</p>
</div>
</dd></dl>

<p>モジュールオブジェクトが初期化関数から返される前に、たいていは <a class="reference internal" href="#c.PyModule_AddObject" title="PyModule_AddObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddObject()</span></code></a> などの関数を使ってモジュールオブジェクトにメンバを所属させます。</p>
</div>
<div class="section" id="multi-phase-initialization">
<span id="id1"></span><h3>多段階初期化<a class="headerlink" href="#multi-phase-initialization" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>拡張を直接生成するもう1つのやり方は、&quot;多段階初期化&quot;を要求する方法です。
この方法で作られる拡張モジュールは、よりPythonモジュールに近い振る舞いをします:
初期化処理は、モジュールオブジェクトを生成する <em>生成段階</em> とメンバを所属させる <em>実行段階</em> に分割されます。
この区別はクラスの <a class="reference internal" href="../reference/datamodel.html#object.__new__" title="object.__new__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__new__()</span></code></a> メソッドと <a class="reference internal" href="../reference/datamodel.html#object.__init__" title="object.__init__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code></a> メソッドに似ています。</p>
<p>一段階初期化で生成されたモジュールと違い、多段階初期化で生成されたモジュールはシングルトンではありません:
<em>sys.modules</em> のエントリーが削除されモジュールが再インポートされた場合、新しいモジュールオブジェクトが生成され、古いモジュールはPythonモジュールと同じように通常のガベージコレクションで処理されることになります。
デフォルトでは、同じ定義から作られた複数のモジュールは独立であるべきです: あるインスタンスに加えた変更は別のインスタンスに影響しません。
これは、(例えば <a class="reference internal" href="#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> を使って取得できる) 全ての状態や、(モジュールの <code class="xref py py-attr docutils literal notranslate"><span class="pre">__dict__</span></code> や <a class="reference internal" href="type.html#c.PyType_FromSpec" title="PyType_FromSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpec()</span></code></a> で生成された個々のクラスのような) モジュールに所属するものは、特定のモジュールオブジェクト特有のものであるべきということです。</p>
<p>多段階初期化を使って生成される全てのモジュールは <a class="reference internal" href="init.html#sub-interpreter-support"><span class="std std-ref">サブ・インタプリター</span></a> をサポートすることが求められます。
複数のモジュールが独立していることを保証するのには、たいていはこのサポートをするだけで十分です。</p>
<p>多段階初期化を要求するために、初期化関数 (PyInit_modulename) は空でない <a class="reference internal" href="#c.PyModuleDef.m_slots" title="PyModuleDef.m_slots"><code class="xref c c-member docutils literal notranslate"><span class="pre">m_slots</span></code></a> を持つ <a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef</span></code></a> を返します。
これを返す前に、 <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> インスタンスは次の関数で初期化されなくてはいけません:</p>
<dl class="function">
<dt id="c.PyModuleDef_Init">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyModuleDef_Init</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModuleDef_Init" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p>モジュール定義が型と参照カウントを正しく報告する、適切に初期化された Python オブジェクトであること保証します。</p>
<p><code class="docutils literal notranslate"><span class="pre">PyObject*</span></code> にキャストされた <em>def</em> を返します。エラーが発生した場合 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<p>モジュール定義の <em>m_slots</em> メンバは <code class="docutils literal notranslate"><span class="pre">PyModuleDef_Slot</span></code> 構造体の配列を指さなければなりません:</p>
<dl class="type">
<dt id="c.PyModuleDef_Slot">
<code class="descname">PyModuleDef_Slot</code><a class="headerlink" href="#c.PyModuleDef_Slot" title="この定義へのパーマリンク">¶</a></dt>
<dd><dl class="member">
<dt id="c.PyModuleDef_Slot.slot">
int <code class="descname">slot</code><a class="headerlink" href="#c.PyModuleDef_Slot.slot" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>スロット ID で、以下で説明されている利用可能な値から選ばれます。</p>
</dd></dl>

<dl class="member">
<dt id="c.PyModuleDef_Slot.value">
void* <code class="descname">value</code><a class="headerlink" href="#c.PyModuleDef_Slot.value" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>スロットの値で、意味はスロット ID に依存します。</p>
</dd></dl>

<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<p><em>m_slots</em> 配列はID 0 のスロットで終端されていなければなりません。</p>
<p>利用可能なスロットの型は以下です:</p>
<dl class="var">
<dt id="c.Py_mod_create">
<code class="descname">Py_mod_create</code><a class="headerlink" href="#c.Py_mod_create" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュールオブジェクト自身を生成するために呼ばれる関数を指定します。
このスロットの <em>value</em> ポインタは次のシグネチャを持つ関数を指していなくてはいけません:</p>
<dl class="function">
<dt id="c.create_module">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">create_module</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*spec</em>, <a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.create_module" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<p><span class="target" id="index-13"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0451"><strong>PEP 451</strong></a> で定義された <a class="reference internal" href="../library/importlib.html#importlib.machinery.ModuleSpec" title="importlib.machinery.ModuleSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModuleSpec</span></code></a> インスタンスと、モジュール定義を受け取る関数です。
これは新しいモジュールオブジェクトを返すか、エラーを設定して <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返すべきです。</p>
<p>この関数は最小限に留めておくべきです。
特に任意のPythonコードを呼び出すべきではなく、同じモジュールをインポートしようとすると無限ループに陥るでしょう。</p>
<p>複数の <code class="docutils literal notranslate"><span class="pre">Py_mod_create</span></code> スロットを1つのモジュール定義に設定しない方がよいです。</p>
<p><code class="docutils literal notranslate"><span class="pre">Py_mod_create</span></code> が設定されていない場合は、インポート機構は <a class="reference internal" href="#c.PyModule_New" title="PyModule_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_New()</span></code></a> を使って通常のモジュールオブジェクトを生成します。
モジュールの名前は定義ではなく <em>spec</em> から取得され、これによって拡張モジュールが動的にモジュール階層における位置を調整できたり、シンボリックリンクを通して同一のモジュール定義を共有しつつ別の名前でインポートできたりします。</p>
<p>返されるオブジェクトが <a class="reference internal" href="#c.PyModule_Type" title="PyModule_Type"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModule_Type</span></code></a> のインスタンスである必要はありません。
インポートに関連する属性の設定と取得ができる限りは、どんな型でも使えます。
しかし、 <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> が <code class="docutils literal notranslate"><span class="pre">NULL</span></code> でない <code class="docutils literal notranslate"><span class="pre">m_traverse</span></code>, <code class="docutils literal notranslate"><span class="pre">m_clear</span></code>, <code class="docutils literal notranslate"><span class="pre">m_free</span></code> 、もしくはゼロでない <code class="docutils literal notranslate"><span class="pre">m_size</span></code> 、もしくは <code class="docutils literal notranslate"><span class="pre">Py_mod_create</span></code> 以外のスロットを持つ場合は、 <code class="docutils literal notranslate"><span class="pre">PyModule_Type</span></code> インスタンスのみが返されるでしょう。</p>
</dd></dl>

<dl class="var">
<dt id="c.Py_mod_exec">
<code class="descname">Py_mod_exec</code><a class="headerlink" href="#c.Py_mod_exec" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モジュールを <em>実行する</em> ときに呼ばれる関数を指定します。
これはPythonモジュールのコードを実行するのと同等です:
この関数はたいていはクラスと定数をモジュールにします。
この関数のシグネチャは以下です:</p>
<dl class="function">
<dt id="c.exec_module">
int <code class="descname">exec_module</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>*<em>&nbsp;module</em><span class="sig-paren">)</span><a class="headerlink" href="#c.exec_module" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<p>複数の <code class="docutils literal notranslate"><span class="pre">Py_mod_exec</span></code> スロットが設定されていた場合は、 <em>m_slots</em> 配列に現れた順に処理されていきます。</p>
</dd></dl>

<p>多段階初期化についてより詳しくは <span class="target" id="index-14"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0489"><strong>PEP 489</strong></a> を見てください。</p>
</div>
<div class="section" id="low-level-module-creation-functions">
<h3>低水準モジュール作成関数<a class="headerlink" href="#low-level-module-creation-functions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下の関数は、多段階初期化を使うときに裏側で呼び出されます。
例えばモジュールオブジェクトを動的に生成するときに、これらの関数を直接使えます。
<code class="docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec</span></code> および <code class="docutils literal notranslate"><span class="pre">PyModule_ExecDef</span></code> のどちらも、呼び出した後にはモジュールが完全に初期化されていなければなりません。</p>
<dl class="function">
<dt id="c.PyModule_FromDefAndSpec">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a> * <code class="descname">PyModule_FromDefAndSpec</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em>, <a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*spec</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_FromDefAndSpec" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p><em>module</em> と ModuleSpec オブジェクトの <em>spec</em> で定義されたとおりに新しいモジュールオブジェクトを生成します。
この関数は、 <a class="reference internal" href="#c.PyModule_FromDefAndSpec2" title="PyModule_FromDefAndSpec2"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec2()</span></code></a> 関数の <em>module_api_version</em> に <code class="xref py py-const docutils literal notranslate"><span class="pre">PYTHON_API_VERSION</span></code> を指定した時とおなじようにふるまいます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_FromDefAndSpec2">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a> * <code class="descname">PyModule_FromDefAndSpec2</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em>, <a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*spec</em>, int<em>&nbsp;module_api_version</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_FromDefAndSpec2" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: New reference.</em><p>APIバージョンを <em>module_api_version</em> として、 <em>module</em> と ModuleSpec オブジェクトの <em>spec</em> で定義されたとおりに新しいモジュールオブジェクトを生成します。
もし指定されたバージョンが実行しているインタープリターのバージョンと異なる場合は、 <a class="reference internal" href="../library/exceptions.html#RuntimeWarning" title="RuntimeWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeWarning</span></code></a> を発生させます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">ほとんどの場合、この関数ではなく <a class="reference internal" href="#c.PyModule_FromDefAndSpec" title="PyModule_FromDefAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec()</span></code></a> を利用するべきです。
この関数は、この関数の必要性を理解しているときにだけ利用してください。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_ExecDef">
int <code class="descname">PyModule_ExecDef</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, <a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_ExecDef" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>def</em> で与えられた任意の実行スロット (<a class="reference internal" href="#c.Py_mod_exec" title="Py_mod_exec"><code class="xref c c-data docutils literal notranslate"><span class="pre">Py_mod_exec</span></code></a>) を実行します。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_SetDocString">
int <code class="descname">PyModule_SetDocString</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, const char<em>&nbsp;*docstring</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_SetDocString" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>module</em> の docstring を <em>docstring</em> に設定します。
この関数は、 <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> から <code class="docutils literal notranslate"><span class="pre">PyModule_Create</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec</span></code> を使ってモジュールを生成するときに自動的に呼び出されます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_AddFunctions">
int <code class="descname">PyModule_AddFunctions</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, <a class="reference internal" href="structures.html#c.PyMethodDef" title="PyMethodDef">PyMethodDef</a><em>&nbsp;*functions</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddFunctions" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>終端が <code class="docutils literal notranslate"><span class="pre">NULL</span></code> になっている <em>functions</em> 配列にある関数を <em>module</em> に追加します。
<a class="reference internal" href="structures.html#c.PyMethodDef" title="PyMethodDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyMethodDef</span></code></a> 構造体の個々のエントリについては PyMethodDef の説明を参照してください (モジュールの名前空間が共有されていないので、 C で実装されたモジュールレベル &quot;関数&quot; はたいていモジュールを1つ目の引数として受け取り、 Python クラスのインスタンスメソッドに似た形にします)。
この関数は、 <code class="docutils literal notranslate"><span class="pre">PyModuleDef</span></code> から <code class="docutils literal notranslate"><span class="pre">PyModule_Create</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">PyModule_FromDefAndSpec</span></code> を使ってモジュールを生成するときに自動的に呼び出されます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.5 で追加.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="support-functions">
<h3>サポート関数<a class="headerlink" href="#support-functions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>モジュールの初期化関数 (一段階初期化を使う場合) 、あるいはモジュールの実行スロットから呼び出される関数 (多段階初期化を使う場合) は次の関数を使うと、モジュールの state の初期化を簡単にできます:</p>
<dl class="function">
<dt id="c.PyModule_AddObject">
int <code class="descname">PyModule_AddObject</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, const char<em>&nbsp;*name</em>, <a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddObject" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>module</em> にオブジェクトを <em>name</em> として追加します。
この関数はモジュールの初期化関数から利用される便利関数です。
この関数は成功したときには <em>value</em> への参照を盗みます。
エラーのときには <code class="docutils literal notranslate"><span class="pre">-1</span></code> を、成功したときには <code class="docutils literal notranslate"><span class="pre">0</span></code> を返します。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>Unlike other functions that steal references, <code class="docutils literal notranslate"><span class="pre">PyModule_AddObject()</span></code> only
decrements the reference count of <em>value</em> <strong>on success</strong>.</p>
<p>This means that its return value must be checked, and calling code must
<a class="reference internal" href="refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> <em>value</em> manually on error. Example usage:</p>
<div class="last highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">Py_INCREF</span><span class="p">(</span><span class="n">spam</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;spam&quot;</span><span class="p">,</span> <span class="n">spam</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">module</span><span class="p">);</span>
    <span class="n">Py_DECREF</span><span class="p">(</span><span class="n">spam</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_AddIntConstant">
int <code class="descname">PyModule_AddIntConstant</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, const char<em>&nbsp;*name</em>, long<em>&nbsp;value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddIntConstant" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>module</em> に整数定数を <em>name</em> として追加します。この便宜関数はモジュールの初期化関数から利用されています。エラーのときには <code class="docutils literal notranslate"><span class="pre">-1</span></code> を、成功したときには <code class="docutils literal notranslate"><span class="pre">0</span></code> を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_AddStringConstant">
int <code class="descname">PyModule_AddStringConstant</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, const char<em>&nbsp;*name</em>, const char<em>&nbsp;*value</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddStringConstant" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>module</em> に文字列定数を <em>name</em> として追加します。
この便利関数はモジュールの初期化関数から利用されています。
文字列 <em>value</em> は <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 終端されていなければなりません。
エラーのときには <code class="docutils literal notranslate"><span class="pre">-1</span></code> を、成功したときには <code class="docutils literal notranslate"><span class="pre">0</span></code> を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_AddIntMacro">
int <code class="descname">PyModule_AddIntMacro</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, macro<span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddIntMacro" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>module</em> に int 定数を追加します。名前と値は <em>macro</em> から取得されます。例えば、 <code class="docutils literal notranslate"><span class="pre">PyModule_AddIntMacro(module,</span> <span class="pre">AF_INET)</span></code> とすると、 <em>AF_INET</em> という名前の int 型定数を <em>AF_INET</em> の値で <em>module</em> に追加します。エラー時には <code class="docutils literal notranslate"><span class="pre">-1</span></code> を、成功時には <code class="docutils literal notranslate"><span class="pre">0</span></code> を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyModule_AddStringMacro">
int <code class="descname">PyModule_AddStringMacro</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, macro<span class="sig-paren">)</span><a class="headerlink" href="#c.PyModule_AddStringMacro" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列定数を <em>module</em> に追加します。</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-lookup">
<h2>モジュール検索<a class="headerlink" href="#module-lookup" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>一段階初期化は、現在のインタプリタのコンテキストから探せるシングルトンのモジュールを生成します。
これによって、後からモジュール定義への参照だけでモジュールオブジェクトが取得できます。</p>
<p>多段階初期化を使うと単一の定義から複数のモジュールが作成できるので、これらの関数は多段階初期化を使って作成されたモジュールには使えません。</p>
<dl class="function">
<dt id="c.PyState_FindModule">
<a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a>* <code class="descname">PyState_FindModule</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyState_FindModule" title="この定義へのパーマリンク">¶</a></dt>
<dd><em class="refcount">Return value: Borrowed reference.</em><p>現在のインタプリタの <em>def</em> から作られたモジュールオブジェクトを返します。このメソッドの前提条件として、前もって <a class="reference internal" href="#c.PyState_AddModule" title="PyState_AddModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyState_AddModule()</span></code></a> でインタプリタの state にモジュールオブジェクトを連結しておくことを要求します。対応するモジュールオブジェクトが見付からない、もしくは事前にインタプリタの state に連結されていない場合は、 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> を返します。</p>
</dd></dl>

<dl class="function">
<dt id="c.PyState_AddModule">
int <code class="descname">PyState_AddModule</code><span class="sig-paren">(</span><a class="reference internal" href="structures.html#c.PyObject" title="PyObject">PyObject</a><em>&nbsp;*module</em>, <a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyState_AddModule" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>関数に渡されたモジュールオブジェクトを、インタプリタの state に連結します。この関数を使うことで <a class="reference internal" href="#c.PyState_FindModule" title="PyState_FindModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyState_FindModule()</span></code></a> からモジュールオブジェクトにアクセスできるようになります。</p>
<p>一段階初期化を使って作成されたモジュールにのみ有効です。</p>
<p>Python calls <code class="docutils literal notranslate"><span class="pre">PyState_AddModule</span></code> automatically after importing a module,
so it is unnecessary (but harmless) to call it from module initialization
code. An explicit call is needed only if the module's own init code
subsequently calls <code class="docutils literal notranslate"><span class="pre">PyState_FindModule</span></code>.
The function is mainly intended for implementing alternative import
mechanisms (either by calling it directly, or by referring to its
implementation for details of the required state updates).</p>
<p>成功したら 0 を、失敗したら -1 を返します。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.3 で追加.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PyState_RemoveModule">
int <code class="descname">PyState_RemoveModule</code><span class="sig-paren">(</span><a class="reference internal" href="#c.PyModuleDef" title="PyModuleDef">PyModuleDef</a><em>&nbsp;*def</em><span class="sig-paren">)</span><a class="headerlink" href="#c.PyState_RemoveModule" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Removes the module object created from <em>def</em> from the interpreter state.
Return 0 on success or -1 on failure.</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 3.3 で追加.</span></p>
</div>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">モジュールオブジェクト (module object)</a><ul>
<li><a class="reference internal" href="#initializing-c-modules">Cモジュールの初期化</a><ul>
<li><a class="reference internal" href="#single-phase-initialization">一段階初期化</a></li>
<li><a class="reference internal" href="#multi-phase-initialization">多段階初期化</a></li>
<li><a class="reference internal" href="#low-level-module-creation-functions">低水準モジュール作成関数</a></li>
<li><a class="reference internal" href="#support-functions">サポート関数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-lookup">モジュール検索</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="file.html"
                        title="前の章へ">ファイルオブジェクト</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="iterator.html"
                        title="次の章へ">イテレータオブジェクト (iterator object)</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.8/Doc/c-api/module.rst"
            rel="nofollow">ソースコードを表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="iterator.html" title="イテレータオブジェクト (iterator object)"
             >次へ</a> |</li>
        <li class="right" >
          <a href="file.html" title="ファイルオブジェクト"
             >前へ</a> |</li>

    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <a href="../index.html">3.8.3rc1 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python/C API リファレンスマニュアル</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="concrete.html" >具象オブジェクト (concrete object) レイヤ</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" type="text" name="q" />
          <input type="submit" value="検索" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">著作権</a> 2001-2020, Python Software Foundation.
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最終更新: 5月 13, 2020
    <a href="https://docs.python.org/3/bugs.html">Found a bug</a>?
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>

  </body>
</html>