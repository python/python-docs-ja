
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>What&#39;s New In Python 3.3 &#8212; Python 3.8.3 ドキュメント</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 3.8.3 ドキュメント 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="What&#39;s New In Python 3.2" href="3.2.html" />
    <link rel="prev" title="What&#39;s New In Python 3.4" href="3.4.html" />
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.3.html" />
    
      
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>

    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
     


  </head><body>
  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="3.2.html" title="What&#39;s New In Python 3.2"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="3.4.html" title="What&#39;s New In Python 3.4"
             accesskey="P">前へ</a> |</li>

    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <a href="../index.html">3.8.3 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">What's New in Python</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" type="text" name="q" />
          <input type="submit" value="検索" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="what-s-new-in-python-3-3">
<h1>What's New In Python 3.3<a class="headerlink" href="#what-s-new-in-python-3-3" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>この記事では 3.2 と比較した Python 3.3 の新機能を解説します。 Python 3.3 は2012年9月29日にリリースされました。全詳細については <a class="reference external" href="https://docs.python.jp/3.3/whatsnew/changelog.html">変更履歴</a> をご覧ください。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><span class="target" id="index-72"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0398"><strong>PEP 398</strong></a> - Python 3.3 リリーススケジュール</p>
</div>
<div class="section" id="summary-release-highlights">
<h2>概要 -- リリースハイライト<a class="headerlink" href="#summary-release-highlights" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>新たな文法機能:</p>
<ul class="simple">
<li><a class="reference internal" href="#pep-380"><span class="std std-ref">ジェネレータの委譲</span></a>. のための新しい <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 式</li>
<li><a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> オブジェクト向けの <code class="docutils literal notranslate"><span class="pre">u'unicode'</span></code> 文法の再適用</li>
</ul>
<p>新たなライブラリモジュール:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/faulthandler.html#module-faulthandler" title="faulthandler: Dump the Python traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">faulthandler</span></code></a> (低水準のクラッシュのデバッグを補助する)</li>
<li><a class="reference internal" href="../library/ipaddress.html#module-ipaddress" title="ipaddress: IPv4/IPv6 manipulation library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ipaddress</span></code></a> (IPアドレスとマスクを表す高水準オブジェクト)</li>
<li><a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> (XZ / LZMA アルゴリズムを使用したデータ圧縮)</li>
<li><a class="reference internal" href="../library/unittest.mock.html#module-unittest.mock" title="unittest.mock: Mock object library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest.mock</span></code></a> (テスト向けにシステムの一部をモックオブジェクトで置き換える)</li>
<li><a class="reference internal" href="../library/venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> (人気の <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> パッケージのような、Python <a class="reference internal" href="#pep-405"><span class="std std-ref">virtual environments</span></a>)</li>
</ul>
<p>新たな組み込み機能:</p>
<ul class="simple">
<li><a class="reference internal" href="#pep-3151"><span class="std std-ref">I/O 例外階層</span></a> の手直し</li>
</ul>
<p>実装の改善:</p>
<ul class="simple">
<li><a class="reference internal" href="#importlib"><span class="std std-ref">インポート機構</span></a> を、 <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> を元に書き換え</li>
<li>よりコンパクトな <a class="reference internal" href="#pep-393"><span class="std std-ref">ユニコード文字列</span></a>.</li>
<li>よりコンパクトな <a class="reference internal" href="#pep-412"><span class="std std-ref">属性辞書</span></a>.</li>
</ul>
<p>ライブラリモジュールの大幅な改善:</p>
<ul class="simple">
<li><a class="reference internal" href="#new-decimal"><span class="std std-ref">decimal</span></a> モジュールのCによる高速化</li>
<li><a class="reference internal" href="#new-email"><span class="std std-ref">email</span></a> モジュールでのより良いユニコード処理 (<a class="reference internal" href="../glossary.html#term-provisional-package"><span class="xref std std-term">暫定版</span></a>)</li>
</ul>
<p>セキュリティの改善:</p>
<ul class="simple">
<li>ハッシュのランダム化がデフォルトで有効になりました。</li>
</ul>
<p>以降はユーザ向けの変更の包括的なリストになっています。</p>
</div>
<div class="section" id="pep-405-virtual-environments">
<span id="pep-405"></span><h2>PEP 405: 仮想環境<a class="headerlink" href="#pep-405-virtual-environments" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>仮想環境 (virtual environment) は隔離されたPython環境を作成する手助けをします。
一方で保守を容易にするために、システム全体のインストールを共有します。
仮想環境はそれ自身の site packages (つまりローカルにインストールされたライブラリ) を持ちつつ、任意でシステム全体の site packages と分離できます。
このコンセプトと実装は、人気のサードパーティパッケージである <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code> を元にしていますが、インタプリタコアとの統合による恩恵を受けています。</p>
<p>この PEP はプログラムからのアクセス用の <a class="reference internal" href="../library/venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> モジュールと、コマンドラインからのアクセスと管理向けの <code class="docutils literal notranslate"><span class="pre">pyvenv</span></code> スクリプトを追加します。Pythonインタプリタは仮想環境のディレクトリツリーの存在を示す <code class="docutils literal notranslate"><span class="pre">pyvenv.cfg</span></code> をチェックします。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-1"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0405"><strong>PEP 405</strong></a> - Python Virtual Environments</dt>
<dd>PEP written by Carl Meyer; implementation by Carl Meyer and Vinay Sajip</dd>
</dl>
</div>
</div>
<div class="section" id="pep-420-implicit-namespace-packages">
<h2>PEP 420: 暗黙的な名前空間パッケージ<a class="headerlink" href="#pep-420-implicit-namespace-packages" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> マーカーファイルを必要としないパッケージディレクトリと、複数のモジュールパスをネイティブでサポートします(<span class="target" id="index-73"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0420"><strong>PEP 420</strong></a> に記載された様々なサードパーティでの名前空間のアプローチに影響されています)</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-3"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0420"><strong>PEP 420</strong></a> - Implicit Namespace Packages</dt>
<dd>PEP written by Eric V. Smith; implementation by Eric V. Smith
and Barry Warsaw</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3118-new-memoryview-implementation-and-buffer-protocol-documentation">
<span id="pep-3118-update"></span><h2>PEP 3118: 新たなメモリビューの実装とバッファプロトコルのドキュメント<a class="headerlink" href="#pep-3118-new-memoryview-implementation-and-buffer-protocol-documentation" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span class="target" id="index-74"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> の実装が大幅に改善されました。</p>
<p>新しい memoryview 実装が、Py_buffer 構造体内にフィールドを動的にアロケートする際に多数のクラッシュの報告をもたらしていた全ての所有権問題、ライフタイム問題を包括的に解決しました。加えて、不連続もしくは多次元の入力に対してクラッシュしたり誤った結果を返していた多数の関数が修正されました。</p>
<p>memoryview オブジェクトに、 PEP-3118 準拠の getbufferproc() が追加されています
(訳注: <a class="reference internal" href="../c-api/typeobj.html#buffer-structs"><span class="std std-ref">バッファオブジェクト構造体 (buffer object structure)</span></a> 参照)。これはコンシューマの要求型をチェックします。多くの新機能が追加されており、これらのほとんどが不連続配列とサブオフセットを持つ配列に完全な一般化をもたらすものです。</p>
<p><a class="reference internal" href="../c-api/buffer.html#bufferobjects"><span class="std std-ref">ドキュメント</span></a> が更新され、エキスポータ(提供側)とコンシューマ(利用側)両方についての責務をより明確に詳細化しています。 <a class="reference internal" href="../c-api/buffer.html#buffer-request-types"><span class="std std-ref">バッファ要求のフラグ</span></a> が、基本フラグと組合せフラグでグループ分けされています。不連続配列と多次元の NumPy スタイル行列のメモリレイアウトについて説明されています。</p>
<div class="section" id="features">
<h3>フィーチャー<a class="headerlink" href="#features" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>struct モジュールの構文の全ての native <a class="reference internal" href="../library/struct.html#format-characters"><span class="std std-ref">書式指定文字</span></a> をサポートするようになりました ('&#64;' プレフィクスが付いていても良いです)。 (訳注: <a class="reference internal" href="../library/stdtypes.html#memoryview.format" title="memoryview.format"><code class="xref py py-attr docutils literal notranslate"><span class="pre">format</span></code></a> 参照。)</li>
<li>いくつかの制限はありますが、 <a class="reference internal" href="../library/stdtypes.html#memoryview.cast" title="memoryview.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cast()</span></code></a> メソッドでフォーマット変更と C-<a class="reference internal" href="../glossary.html#term-contiguous"><span class="xref std std-term">contiguous</span></a> 配列の形状 (shape) の変更を行うことが出来ます。</li>
<li>任意の配列型で多次元のリスト表現がサポートされるようになっています。</li>
<li>任意の配列型で多次元の比較がサポートされるようになっています。</li>
<li>'B', 'b', 'c' いずれかのフォーマットの <a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a> な (読み出し専用の) 型の1次元メモリビューもまた、 hashable です。 (Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue13411">bpo-13411</a>.)</li>
<li>1 次元配列型での任意のスライスがサポートされています。たとえば負の step を与えて memoryview を逆順に並べ替えることが O(1) オーダで出来るようになりました。</li>
</ul>
</div>
<div class="section" id="api-changes">
<h3>API の変更<a class="headerlink" href="#api-changes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>最大 <a class="reference internal" href="../library/stdtypes.html#memoryview.ndim" title="memoryview.ndim"><code class="xref py py-attr docutils literal notranslate"><span class="pre">次元</span></code></a> は公式に 64 に制限されています。</li>
<li>空の <a class="reference internal" href="../library/stdtypes.html#memoryview.shape" title="memoryview.shape"><code class="xref py py-attr docutils literal notranslate"><span class="pre">shape</span></code></a>, 空の <a class="reference internal" href="../library/stdtypes.html#memoryview.strides" title="memoryview.strides"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strides</span></code></a>, 空の <a class="reference internal" href="../library/stdtypes.html#memoryview.suboffsets" title="memoryview.suboffsets"><code class="xref py py-attr docutils literal notranslate"><span class="pre">suboffsets</span></code></a> を表現するのに以前は <code class="docutils literal notranslate"><span class="pre">None</span></code> を用いていましたが今ではこれは空のタプルです。</li>
<li>フォーマット 'B' (unsigned bytes) での memoryview 要素へのアクセスは整数を返すようになりました (struct モジュールでの構文に従っています)。bytes オブジェクトが欲しければまずビューを 'c' で <a class="reference internal" href="../library/stdtypes.html#memoryview.cast" title="memoryview.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cast()</span></code></a> しなければなりません。</li>
<li>memoryview どうしの比較は被演算対象の論理構造を使って行うようになり、また、全ての配列要素は値で比較されます。struct モジュールの構文の全てのフォーマット文字でサポートされます。認識出来ないフォーマット文字でのビューは今でも許されていますが、ビューの指す中身によらずこれは常に等しくないとされます。</li>
<li>ほかの変更については、 <a class="reference internal" href="#build-and-c-api-changes">ビルドならびに C API の変更</a> と <a class="reference internal" href="#porting-c-code">C コードの移植</a> を参照してください。</li>
</ul>
<p>(Contributed by Stefan Krah in <a class="reference external" href="https://bugs.python.org/issue10181">bpo-10181</a>.)</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last"><span class="target" id="index-5"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> - Revising the Buffer Protocol</p>
</div>
</div>
</div>
<div class="section" id="pep-393-flexible-string-representation">
<span id="pep-393"></span><h2>PEP 393: 文字列の柔軟な表現<a class="headerlink" href="#pep-393-flexible-string-representation" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Unicode 文字列型が、複数の内部表現 (1、2 または 4 バイトで表現される Unicode 序数(ordinal) の最大値依存) を、表現される文字列内でサポートするように変更されました (訳注: 以前までは Python のビルド時に固定で決めていました)。このことは全てのシステムにおいて、一般のケースでは空間効率の良い表現をしながらも UCS-4 へのフルアクセスを与えます。既存の API との互換性のために複数の表現が並行で存在することになりますが、徐々にこの互換性はなくされていくはずです。</p>
<p>Python 側にはこの変更による不都合は何もないはずです。</p>
<p>C API 側では <span class="target" id="index-75"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> は完全に後方互換です。レガシーな API は最低 5 年は残されるはずです。レガシー API を使うアプリケーションはメモリ削減の効能が完全には得られないか、あるいは最悪の場合には少し余計なメモリを使うかもしれません。これは Python がそれぞれの文字列の二つのバージョン (レガシーなフォーマットと新しい効率的な格納方法) を維持する必要があるかもしれないからです</p>
<div class="section" id="functionality">
<h3>機能性<a class="headerlink" href="#functionality" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-76"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> でなされた変更は以下の通りです:</p>
<ul class="simple">
<li>Python は今や非 BMP 面の文字を含む Unicode コードポイントの完全な範囲 (つまり <code class="docutils literal notranslate"><span class="pre">U+0000</span></code> から <code class="docutils literal notranslate"><span class="pre">U+10FFFF</span></code> まで) を常にサポートします。narrow ビルド / wide ビルドという区別は今では存在していないため、Python は今ではいつでもかつての wide ビルドのように振る舞い、Windows でもこれは例外ではありません。</li>
<li>narrow ビルドとの決別は、それに付き物だった問題も解決しました。例えば:<ul>
<li><a class="reference internal" href="../library/functions.html#len" title="len"><code class="xref py py-func docutils literal notranslate"><span class="pre">len()</span></code></a> は今では非 BMP 面文字について必ず 1 を返します。つまり <code class="docutils literal notranslate"><span class="pre">len('\U0010FFFF')</span> <span class="pre">==</span> <span class="pre">1</span></code> です;</li>
<li>サロゲートペアが文字列リテラル内で再結合されることはありません。つまり <code class="docutils literal notranslate"><span class="pre">'\uDBFF\uDFFF'</span> <span class="pre">!=</span> <span class="pre">'\U0010FFFF'</span></code> です;</li>
<li>非 BMP 面文字を指すインデクスやスライスは期待通りの値を返します。つまり <code class="docutils literal notranslate"><span class="pre">'\U0010FFFF'[0]</span></code> は今では <code class="docutils literal notranslate"><span class="pre">'\uDBFF'</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">'\U0010FFFF'</span></code> を返します;</li>
<li>ほかの全ての標準ライブラリ関数が今では正しく非 BMP コードポイントを処理します。</li>
</ul>
</li>
<li><a class="reference internal" href="../library/sys.html#sys.maxunicode" title="sys.maxunicode"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.maxunicode</span></code></a> の値は今やいつでも <code class="docutils literal notranslate"><span class="pre">1114111</span></code> (十六進で <code class="docutils literal notranslate"><span class="pre">0x10FFFF</span></code>) です。後方互換性のために C API の <code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetMax()</span></code> 関数は今でも <code class="docutils literal notranslate"><span class="pre">0xFFFF</span></code> か <code class="docutils literal notranslate"><span class="pre">0x10FFFF</span></code> のどちらかを返すようになってはいますが、新しい Unicode API とともには使ってはいけません (see <a class="reference external" href="https://bugs.python.org/issue13054">bpo-13054</a>)。</li>
<li><code class="file docutils literal notranslate"><span class="pre">./configure</span></code> スクリプトのフラグ <code class="docutils literal notranslate"><span class="pre">--with-wide-unicode</span></code> は削除されました。</li>
</ul>
</div>
<div class="section" id="performance-and-resource-usage">
<h3>性能およびリソース使用量<a class="headerlink" href="#performance-and-resource-usage" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Unicode 文字列の記憶域サイズが文字列内のコードポイント最大値に依存するようになったということです:</p>
<ul class="simple">
<li>純粋な ASCII と Latin1 文字列 (<code class="docutils literal notranslate"><span class="pre">U+0000-U+00FF</span></code>) はコードポイントごとに 1 バイトを占めます;</li>
<li>BMP 文字列 (<code class="docutils literal notranslate"><span class="pre">U+0000-U+FFFF</span></code>) はコードポイントごとに 2 バイトを占めます;</li>
<li>非 BMP 文字列 (<code class="docutils literal notranslate"><span class="pre">U+10000-U+10FFFF</span></code>) はコードポイントごとに 4 バイトを占めます。</li>
</ul>
<p>結局のところほとんどのアプリケーションにとってのこれの効能は、文字列記憶のためのメモリ使用量が激減することで、これは以前の wide unicode ビルドと比較して顕著です。これは多くの場合、インターナショナルな文脈であってもなお純粋な ASCII が使われるであろうことに関係があります。(というのも多くの文字列が人間向けでない言語として格納されるからです。例えば XML フラグメンツや HTTP ヘッダ、JSON エンコードされたデータ、などなど。)同じ理由から、大きなアプリケーションで CPU キャッシュ活用効率を高めるであろうことも期待出来ます。Python 3.3 のメモリ使用は Python 3.2 の 2 倍から 3 倍小さく、また、Python 2.7 よりも少し良いことが Django ベンチマークでわかっています (詳細は PEP をみてください)。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-77"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> - 文字列の柔軟な表現 (Flexible String Representation)</dt>
<dd>PEP written by Martin von Löwis; implementation by Torsten Becker
and Martin von Löwis.</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="pep-397-python-launcher-for-windows">
<span id="pep-397"></span><h2>PEP 397: Windows の Python ランチャ<a class="headerlink" href="#pep-397-python-launcher-for-windows" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 3.3 の Windows インストーラが、ランチャアプリケーションの <code class="docutils literal notranslate"><span class="pre">py</span></code> をインストールするようになりました。これは Python をバージョンに依存しない方法で起動するのに使われます。</p>
<p>ランチャは <code class="docutils literal notranslate"><span class="pre">*.py</span></code> ファイルをダブルクリックすると暗黙のうちに呼び出されます。システムにインストールされているのが単一の Python バージョンであれば、そのバージョンがファイルの実行に使われます。複数バージョンがインストールされていればデフォルトでは最新バージョンが使われますが、Python スクリプト内で Unix スタイルの「shebang 行 ( <code class="docutils literal notranslate"><span class="pre">#!</span></code> )」を含めることでオーバライド出来ます。</p>
<p>ランチャは明示的にコマンドラインから <code class="docutils literal notranslate"><span class="pre">py</span></code> アプリケーションとして使うことも出来ます。 <code class="docutils literal notranslate"><span class="pre">py</span></code> の実行は暗黙にスクリプトを起動するバージョン選択のルールに従いますが、与えるコマンドライン引数により狙ったバージョンを選択出来ます (たとえば <code class="docutils literal notranslate"><span class="pre">-3</span></code> は Python 2 もインストールされている際に Python 3 を要求し、 <code class="docutils literal notranslate"><span class="pre">-2.6</span></code> はもっと新しいバージョンがインストールされている場合に特定の古いバージョンを要求します)。</p>
<p>ランチャに加え、Windows インストーラには新しくインストールする Python をシステムの PATH に追加するオプションが含まれるようになりました。 (Contributed by Brian Curtin in <a class="reference external" href="https://bugs.python.org/issue3561">bpo-3561</a>.)</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="docutils">
<dt><span class="target" id="index-9"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0397"><strong>PEP 397</strong></a> - Python Launcher for Windows</dt>
<dd>PEP written by Mark Hammond and Martin v. Löwis; implementation by
Vinay Sajip.</dd>
</dl>
<p>ランチャのドキュメント: <a class="reference internal" href="../using/windows.html#launcher"><span class="std std-ref">Windows の Python ランチャ</span></a></p>
<p class="last">インストーラ PATH の調整: <a class="reference internal" href="../using/windows.html#windows-path-mod"><span class="std std-ref">Python 実行ファイルを見つける</span></a></p>
</div>
</div>
<div class="section" id="pep-3151-reworking-the-os-and-io-exception-hierarchy">
<span id="pep-3151"></span><h2>PEP 3151: OS および IO 例外階層の手直し<a class="headerlink" href="#pep-3151-reworking-the-os-and-io-exception-hierarchy" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>OS エラーが送出する例外の階層が単純化され、粒度が下げられました。</p>
<p><a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a>、<a class="reference internal" href="../library/exceptions.html#IOError" title="IOError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">IOError</span></code></a>、<a class="reference internal" href="../library/exceptions.html#EnvironmentError" title="EnvironmentError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">EnvironmentError</span></code></a>、<a class="reference internal" href="../library/exceptions.html#WindowsError" title="WindowsError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">WindowsError</span></code></a>、<code class="xref py py-exc docutils literal notranslate"><span class="pre">mmap.error</span></code>、<a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a>、そして  <a class="reference internal" href="../library/select.html#select.error" title="select.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">select.error</span></code></a> の中から適切な例外の型を選ぶのに心配する必要はもうありません。
上記の例外の型は全てたった1つ <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> になりました。
<a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> 以外の名前は互換性のためにエイリアスとして残されています。</p>
<p>また、特定のエラー条件を捕捉するのが容易になりました。
<code class="docutils literal notranslate"><span class="pre">errno</span></code> 属性 (または <code class="docutils literal notranslate"><span class="pre">args[0]</span></code>) の特定の定数を <a class="reference internal" href="../library/errno.html#module-errno" title="errno: Standard errno system symbols."><code class="xref py py-mod docutils literal notranslate"><span class="pre">errno</span></code></a> モジュールから調べる代わりに、適切な <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> 派生クラスを捕捉することが出来ます。
利用可能な派生クラスは以下の通りです:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/exceptions.html#BlockingIOError" title="BlockingIOError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BlockingIOError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ChildProcessError" title="ChildProcessError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ChildProcessError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ConnectionError" title="ConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#FileExistsError" title="FileExistsError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FileExistsError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#FileNotFoundError" title="FileNotFoundError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FileNotFoundError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#InterruptedError" title="InterruptedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InterruptedError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#IsADirectoryError" title="IsADirectoryError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">IsADirectoryError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#NotADirectoryError" title="NotADirectoryError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotADirectoryError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#PermissionError" title="PermissionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ProcessLookupError" title="ProcessLookupError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ProcessLookupError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#TimeoutError" title="TimeoutError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TimeoutError</span></code></a></li>
</ul>
<p><a class="reference internal" href="../library/exceptions.html#ConnectionError" title="ConnectionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionError</span></code></a> 自身には細かな派生クラスがあります:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/exceptions.html#BrokenPipeError" title="BrokenPipeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BrokenPipeError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ConnectionAbortedError" title="ConnectionAbortedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionAbortedError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ConnectionRefusedError" title="ConnectionRefusedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionRefusedError</span></code></a></li>
<li><a class="reference internal" href="../library/exceptions.html#ConnectionResetError" title="ConnectionResetError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionResetError</span></code></a></li>
</ul>
<p>新たな例外のおかげで <a class="reference internal" href="../library/errno.html#module-errno" title="errno: Standard errno system symbols."><code class="xref py py-mod docutils literal notranslate"><span class="pre">errno</span></code></a> の一般的な使い方を避けることが出来ます。
例えば、Python 3.2 向けに書かれた以下のコード:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">errno</span> <span class="kn">import</span> <span class="n">ENOENT</span><span class="p">,</span> <span class="n">EACCES</span><span class="p">,</span> <span class="n">EPERM</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;document.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">ENOENT</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;document.txt file is missing&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="ow">in</span> <span class="p">(</span><span class="n">EACCES</span><span class="p">,</span> <span class="n">EPERM</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are not allowed to read document.txt&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>
</div>
<p>は <a class="reference internal" href="../library/errno.html#module-errno" title="errno: Standard errno system symbols."><code class="xref py py-mod docutils literal notranslate"><span class="pre">errno</span></code></a> をインポートしたり手動で例外属性を調べたりせずに書くことが出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;document.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;document.txt file is missing&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are not allowed to read document.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-10"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3151"><strong>PEP 3151</strong></a> - Reworking the OS and IO Exception Hierarchy</dt>
<dd>PEP written and implemented by Antoine Pitrou</dd>
</dl>
</div>
</div>
<div class="section" id="pep-380-syntax-for-delegating-to-a-subgenerator">
<span id="pep-380"></span><span id="index-11"></span><h2>PEP 380: サブジェネレータへの委譲構文<a class="headerlink" href="#pep-380-syntax-for-delegating-to-a-subgenerator" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PEP 380 は <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 式を追加します。これは <a class="reference internal" href="../glossary.html#term-generator"><span class="xref std std-term">ジェネレータ</span></a> に、その操作の一部をほかのジェネレータに委譲するための式です。これによって <a class="reference internal" href="../reference/simple_stmts.html#yield"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">yield</span></code></a> を含んでいるコードのセクションをほかのジェネレータに移動出来るでしょう。加えてサブジェネレータは値を伴って戻ることが出来、その戻り値は委譲した側のジェネレータで使えます。</p>
<p><code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 式がデザインされた主たる動機はサブジェネレータへの委譲として使うことではありますが、実際には任意のサブイテレータに委譲することも出来ます。</p>
<p>単純なイテレータに対して、 <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span> <span class="pre">iterable</span></code> は本質的には <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">item</span> <span class="pre">in</span> <span class="pre">iterable:</span> <span class="pre">yield</span> <span class="pre">item</span></code> への単なる速記法です:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">yield from</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">yield from</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="go">[5, 4, 3, 2, 1, 0, 1, 2, 3, 4]</span>
</pre></div>
</div>
<p>ですが普通のループとは違って <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> ではサブジェネレータは、呼び出し側スコープから <a class="reference internal" href="../reference/expressions.html#generator.send" title="generator.send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> されたり <a class="reference internal" href="../reference/expressions.html#generator.throw" title="generator.throw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">throw()</span></code></a> された値を直接受け取ることができ、また、外側のジェネレータに最終的な値を返せます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">accumulate</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">tally</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">next</span> <span class="o">=</span> <span class="k">yield</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">next</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">tally</span>
<span class="gp">... </span>        <span class="n">tally</span> <span class="o">+=</span> <span class="nb">next</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">gather_tallies</span><span class="p">(</span><span class="n">tallies</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">tally</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">accumulate</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">tallies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tallies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acc</span> <span class="o">=</span> <span class="n">gather_tallies</span><span class="p">(</span><span class="n">tallies</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>  <span class="c1"># Ensure the accumulator is ready to accept values</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">acc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Finish the first tally</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">acc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Finish the second tally</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tallies</span>
<span class="go">[6, 10]</span>
</pre></div>
</div>
<p>この変更を推し進める一番本質にあったものは、たとえ <code class="docutils literal notranslate"><span class="pre">send</span></code> メソッドや <code class="docutils literal notranslate"><span class="pre">throw</span></code> メソッドとともに使われることを前提に設計されたジェネレータであっても、大きな関数を複数のサブ関数に分割するのと同じくらいに、ジェネレータを簡単に複数のサブジェネレータに分割出来るようにすることでした。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-78"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0380"><strong>PEP 380</strong></a> - サブジェネレータへの委譲構文</dt>
<dd>PEP written by Greg Ewing; implementation by Greg Ewing, integrated into
3.3 by Renaud Blanch, Ryan Kelly and Nick Coghlan; documentation by
Zbigniew Jędrzejewski-Szmek and Nick Coghlan</dd>
</dl>
</div>
</div>
<div class="section" id="pep-409-suppressing-exception-context">
<h2>PEP 409: 例外コンテキストの抑制<a class="headerlink" href="#pep-409-suppressing-exception-context" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PEP 409 は、チェインされた例外コンテキストの表示を無効にするための新構文を導入します。これを使えば例外翻訳して投げ直すようなアプリケーションで、エラーメッセージをわかりやすくすることが出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">D</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_attributes</span> <span class="o">=</span> <span class="n">extra</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">D</span><span class="p">({})</span><span class="o">.</span><span class="n">x</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">8</span>, in <span class="n">__getattr__</span>
<span class="gr">AttributeError</span>: <span class="n">x</span>
</pre></div>
</div>
<p>元となる要因例外を抑制する <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">None</span></code> を後置しなければ、もとの例外はデフォルトで表示されます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_attributes</span> <span class="o">=</span> <span class="n">extra</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_attributes</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="p">({})</span><span class="o">.</span><span class="n">x</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">6</span>, in <span class="n">__getattr__</span>
<span class="gr">KeyError</span>: <span class="n">&#39;x&#39;</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">8</span>, in <span class="n">__getattr__</span>
<span class="gr">AttributeError</span>: <span class="n">x</span>
</pre></div>
</div>
<p>抑制することでデバッグ能力が失われるというわけではなくて、元々の例外コンテキストは利用可能なままです。(例えば介在するライブラリが有益な背後の詳細を不適切に隠してしまっているなど、必要な場合はあるでしょう。)</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">D</span><span class="p">({})</span><span class="o">.</span><span class="n">x</span>
<span class="gp">... </span><span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">__context__</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">KeyError(&#39;x&#39;,)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-79"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0409"><strong>PEP 409</strong></a> - 例外コンテキストの抑制</dt>
<dd>PEP written by Ethan Furman; implemented by Ethan Furman and Nick
Coghlan.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-414-explicit-unicode-literals">
<h2>PEP 414: 明示的なユニコードリテラル<a class="headerlink" href="#pep-414-explicit-unicode-literals" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Unicode を意識する Python アプリケーションが Python 2 で Unicode リテラルを多用しているとしても Python 3 への移行を容易にするために、Python 3.3 では文字列リテラルへの &quot;<code class="docutils literal notranslate"><span class="pre">u</span></code>&quot; 前置を再びサポートすることにしました。この前置は Python 3 自身では何らの意味も持ちはせず、Python 3 への移行において純粋な機械的変更を要する事項を単に減らすためだけのために提供されます。開発者はもっと重要な意味的変更 (たとえばバイナリとテキストの厳密な区別) に集中すべきなのです。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-80"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0414"><strong>PEP 414</strong></a> - 明示的なユニコードリテラル</dt>
<dd>PEP written by Armin Ronacher.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3155-qualified-name-for-classes-and-functions">
<h2>PEP 3155: クラスと関数の正規名<a class="headerlink" href="#pep-3155-qualified-name-for-classes-and-functions" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>関数オブジェクトとクラスオブジェクトは新たに <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code> 属性を持つようになりました。これはモジュールのトップレベルからその定義までの「道のり (path)」を表現するものです。グローバルな関数とクラスについてはこれは <code class="docutils literal notranslate"><span class="pre">__name__</span></code> と同じです。ほかの場合にはこれは、実際に定義されている場所についてや、グローバルスコープから如何にしてアクセス可能かについて、もっと良い情報を与えてくれます。</p>
<p>(束縛されていない) メソッドでの例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">meth</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;meth&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">meth</span><span class="o">.</span><span class="vm">__qualname__</span>
<span class="go">&#39;C.meth&#39;</span>
</pre></div>
</div>
<p>入れ子のクラスでの例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">class</span> <span class="nc">D</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">def</span> <span class="nf">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;D&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="vm">__qualname__</span>
<span class="go">&#39;C.D&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">meth</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;meth&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">meth</span><span class="o">.</span><span class="vm">__qualname__</span>
<span class="go">&#39;C.D.meth&#39;</span>
</pre></div>
</div>
<p>入れ子の関数の例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
<span class="gp">... </span>        <span class="k">pass</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">inner</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outer</span><span class="p">()</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;inner&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outer</span><span class="p">()</span><span class="o">.</span><span class="vm">__qualname__</span>
<span class="go">&#39;outer.&lt;locals&gt;.inner&#39;</span>
</pre></div>
</div>
<p>それらオブジェクトの文字列表現も、この新しくてより正確な情報を含むように変更されています:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
<span class="go">&quot;&lt;class &#39;__main__.C.D&#39;&gt;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">meth</span><span class="p">)</span>
<span class="go">&#39;&lt;function C.D.meth at 0x7f46b9fe31e0&gt;&#39;</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-81"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3155"><strong>PEP 3155</strong></a> - クラスと関数の正規名 (qualified name)</dt>
<dd>PEP written and implemented by Antoine Pitrou.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-412-key-sharing-dictionary">
<span id="pep-412"></span><h2>PEP 412: キー共有辞書<a class="headerlink" href="#pep-412-key-sharing-dictionary" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>オブジェクト属性を記憶するのに使われる辞書が、内部記憶域の一部 (キーとそれに対応するハッシュ値) を互いに共有出来るようになりました。これにより、組み込みでない型のインスタンスをたくさん作るプログラムのメモリ消費が少なくなります。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-82"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0412"><strong>PEP 412</strong></a> - キー共有辞書</dt>
<dd>PEP written and implemented by Mark Shannon.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-362-function-signature-object">
<h2>PEP 362: 関数シグニチャオブジェクト<a class="headerlink" href="#pep-362-function-signature-object" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>新たに追加された関数 <a class="reference internal" href="../library/inspect.html#inspect.signature" title="inspect.signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.signature()</span></code></a> は、Python 呼び出し可能オブジェクト (callable) を調べることを簡単で直接的なものにしてくれます。幅広い callable をサポートしています:デコレートされているかどうかによらず関数、クラス、 <a class="reference internal" href="../library/functools.html#functools.partial" title="functools.partial"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.partial()</span></code></a> オブジェクト。新たに追加されたクラス群 <a class="reference internal" href="../library/inspect.html#inspect.Signature" title="inspect.Signature"><code class="xref py py-class docutils literal notranslate"><span class="pre">inspect.Signature</span></code></a>, <a class="reference internal" href="../library/inspect.html#inspect.Parameter" title="inspect.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">inspect.Parameter</span></code></a>, <a class="reference internal" href="../library/inspect.html#inspect.BoundArguments" title="inspect.BoundArguments"><code class="xref py py-class docutils literal notranslate"><span class="pre">inspect.BoundArguments</span></code></a> は、アノテーション、デフォルト値、パラメータの種類、束縛されている引数などのような呼び出しシグニチャについての情報を保持し、これによって、デコレータを書いたりあるいは呼び出しシグニチャや引数を検証したり改訂したりするコードを書くことが、非常に単純になります。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-83"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0362"><strong>PEP 362</strong></a>: - 関数シグニチャオブジェクト</dt>
<dd>PEP written by Brett Cannon, Yury Selivanov, Larry Hastings, Jiwon Seo;
implemented by Yury Selivanov.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-421-adding-sys-implementation">
<h2>PEP 421: sys.implementation の追加<a class="headerlink" href="#pep-421-adding-sys-implementation" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../library/sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a> モジュールに新規属性が追加され、これは現在動作中のインタプリタ実装に固有の詳細を公開します。その <a class="reference internal" href="../library/sys.html#sys.implementation" title="sys.implementation"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.implementation</span></code></a> 属性の手始めの集合として、 <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">version</span></code>, <code class="docutils literal notranslate"><span class="pre">hexversion</span></code>, <code class="docutils literal notranslate"><span class="pre">cache_tag</span></code> が定義されています。</p>
<p><code class="docutils literal notranslate"><span class="pre">sys.implementation</span></code> の真意は、標準ライブラリによって利用される実装固有の情報を一つの名前空間で一元管理することにあります。このことにより異なる Python 実装が単一の標準ライブラリのコードベースを共有することが、もっとずっと簡単になります。今時点での初期状態では <code class="docutils literal notranslate"><span class="pre">sys.implementation</span></code> は実装固有データのごく一部を保持しているだけです。標準ライブラリの移植性がもっと高くなるように、徐々にこの比率が変わっていくでしょう。</p>
<p>標準ライブラリの移植性を改善した一例が <code class="docutils literal notranslate"><span class="pre">cache_tag</span></code> です。Python 3.3 以降は <code class="docutils literal notranslate"><span class="pre">sys.implementation.cache_tag</span></code> が <span class="target" id="index-84"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3147"><strong>PEP 3147</strong></a> をサポートするために <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> により使われます。組み込みのインポートシステムのために <code class="docutils literal notranslate"><span class="pre">importlib</span></code> を使う全ての Python 実装が、モジュールのキャッシュの振る舞いを制御するのに <code class="docutils literal notranslate"><span class="pre">cache_tag</span></code> を利用できます。</p>
<div class="section" id="simplenamespace">
<h3>SimpleNamespace<a class="headerlink" href="#simplenamespace" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">sys.implementation</span></code> の実現に伴って Python に新たな型 <a class="reference internal" href="../library/types.html#types.SimpleNamespace" title="types.SimpleNamespace"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.SimpleNamespace</span></code></a> が導入されることとなりました。 <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> のようなマッピングベースの名前空間とは対照的に、 <code class="docutils literal notranslate"><span class="pre">SimpleNamespace</span></code> は <a class="reference internal" href="../library/functions.html#object" title="object"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> のような属性ベースです。ですが <code class="docutils literal notranslate"><span class="pre">object</span></code> とは違って <code class="docutils literal notranslate"><span class="pre">SimpleNamespace</span></code> インスタンスは書き込み可能です。つまり普通の属性アクセスを通じて名前空間に追加したり削除したり修正したりできます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-85"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0421"><strong>PEP 421</strong></a> - sys.implementation の追加</dt>
<dd>PEP written and implemented by Eric Snow.</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="using-importlib-as-the-implementation-of-import">
<span id="importlib"></span><h2>インポート実装としての importlib の使用<a class="headerlink" href="#using-importlib-as-the-implementation-of-import" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="https://bugs.python.org/issue2377">bpo-2377</a> [Replace __import__ w/ importlib.__import__ (__import__ を importlib.__import__ で置き換える)]、 <a class="reference external" href="https://bugs.python.org/issue13959">bpo-13959</a> [Re-implement parts of <a class="reference internal" href="../library/imp.html#module-imp" title="imp: Access the implementation of the import statement. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code></a> in pure Python (<a class="reference internal" href="../library/imp.html#module-imp" title="imp: Access the implementation of the import statement. (非推奨)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code></a> の一部をピュア Python で再実装する)]、 <a class="reference external" href="https://bugs.python.org/issue14605">bpo-14605</a> [Make import machinery explicit (インポート機構を明示的なものにする)]、 <a class="reference external" href="https://bugs.python.org/issue14646">bpo-14646</a> [Require loaders set __loader__ and __package__ (ローダーが __loader__ と __package__ をセットするのを必須とする)]。</p>
<p><a class="reference internal" href="../library/functions.html#__import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> 関数を <a class="reference internal" href="../library/importlib.html#importlib.__import__" title="importlib.__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.__import__()</span></code></a> によって実現するようにしました。これは <span class="target" id="index-86"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0302"><strong>PEP 302</strong></a> の「第二段階」を完了させるものです。この変更には複数の恩恵があります。まず最初にこれはインポートの機構を、C コードの奥深くで暗黙に秘密裏に行うのではなく、より透明化します。このことで、Python 3.3 をサポートする全ての Python VM で単一の実装を用いることが出来るようになり、インポートのセマンティクスにおける VM 固有の逸脱と決別する助けともなります。そしてこれはインポート機構の保守をより容易とし、将来起こりうる進化を促します。</p>
<p>一般のユーザにとっては、セマンティクスにおいて目に見える変化はないはずです。今時点でインポートを操作したりインポート呼び出しをプログラム的に行っている場合は、このドキュメントの <a class="reference internal" href="#porting-python-code">Python コードの移植</a> でカバーしているコードの修正が必要になるかもしれません。</p>
<div class="section" id="new-apis">
<h3>新たな API<a class="headerlink" href="#new-apis" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>この変更による一番大きな恩恵の一つは、インポート文の動作に何が介在するのかについて露になったことです。つまりかつては様々なインポータが暗黙で行っていたことが、今では完全に <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> パッケージの一部として公開されています。</p>
<p><a class="reference internal" href="../library/importlib.html#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib.abc</span></code></a> で定義される抽象基底クラスは <a class="reference internal" href="../glossary.html#term-meta-path-finder"><span class="xref std std-term">meta path finder</span></a> と <a class="reference internal" href="../glossary.html#term-path-entry-finder"><span class="xref std std-term">path entry finder</span></a> の差異を正確に表現するように拡張されて、それぞれ順に <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder" title="importlib.abc.MetaPathFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder</span></code></a> と <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder" title="importlib.abc.PathEntryFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder</span></code></a> が導入されました。古い ABC である <a class="reference internal" href="../library/importlib.html#importlib.abc.Finder" title="importlib.abc.Finder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Finder</span></code></a> は後方互換性のためだけに残されますが、何かのメソッドの必要性を強制したりはしません。</p>
<p>ファインダ (finder) の側面からは、 <a class="reference internal" href="../library/importlib.html#importlib.machinery.FileFinder" title="importlib.machinery.FileFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.machinery.FileFinder</span></code></a> がモジュールのソースファイルおよびバイトコードファイルの検索に使われる機構を公開しています。以前はこのクラスは <a class="reference internal" href="../library/sys.html#sys.path_hooks" title="sys.path_hooks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_hooks</span></code></a> の暗黙のメンバでした。</p>
<p>ローダ (loader) については、新規の抽象基底クラス <a class="reference internal" href="../library/importlib.html#importlib.abc.FileLoader" title="importlib.abc.FileLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.FileLoader</span></code></a> が、モジュールのコードを格納する機構としてのファイルシステムを使うローダを書く助けとなります。ソースファイルのローダ (<a class="reference internal" href="../library/importlib.html#importlib.machinery.SourceFileLoader" title="importlib.machinery.SourceFileLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.machinery.SourceFileLoader</span></code></a>)、ソースを持たないバイトコードのためのローダ (<a class="reference internal" href="../library/importlib.html#importlib.machinery.SourcelessFileLoader" title="importlib.machinery.SourcelessFileLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.machinery.SourcelessFileLoader</span></code></a>)、そして拡張モジュールのためのローダ (<a class="reference internal" href="../library/importlib.html#importlib.machinery.ExtensionFileLoader" title="importlib.machinery.ExtensionFileLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.machinery.ExtensionFileLoader</span></code></a>) が今では直接的に利用出来ます。</p>
<p><a class="reference internal" href="../library/exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> には属性 <code class="docutils literal notranslate"><span class="pre">name</span></code> と <code class="docutils literal notranslate"><span class="pre">path</span></code> が追加されて、これには提供すべき関連データがある場合にセットされます。インポート失敗時のメッセージも、これまでのようにモジュール名の末尾だけを与えるのではなく、モジュールの完全名を提供するようになりました。</p>
<p><a class="reference internal" href="../library/importlib.html#importlib.invalidate_caches" title="importlib.invalidate_caches"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.invalidate_caches()</span></code></a> 関数が <a class="reference internal" href="../library/sys.html#sys.path_importer_cache" title="sys.path_importer_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code></a> 内にキャッシュされている全てのファインダの同名メソッドを呼び出すようになりました。これにより必要に応じて記憶されている状態をクリーンアップ出来ます。</p>
</div>
<div class="section" id="visible-changes">
<h3>目に見える変化<a class="headerlink" href="#visible-changes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>潜在的に必要となるかもしれないコード修正については、 <a class="reference internal" href="#porting-python-code">Python コードの移植</a> セクションを参照してください。</p>
<p><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> によって公開されるものが拡がったことによる、インポートについてのほかの目に見える変化があります。最大の変化は <a class="reference internal" href="../library/sys.html#sys.meta_path" title="sys.meta_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.meta_path</span></code></a> と <a class="reference internal" href="../library/sys.html#sys.path_hooks" title="sys.path_hooks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_hooks</span></code></a> が、インポートで使われる meta path finder と path entry hook の全てを格納するようになったことです。以前はファインダは直接的に公開されるのではなく、インポートの C コード内に暗黙のものとして隠されていました。このことによって、今では望めば要件に合うようファインダを取り除いたり順序を変えたりといったことが簡単に行えるようになっています。</p>
<p>もう一つの変化は、モジュール生成時に使われたローダを格納する <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 属性を、全てのモジュールが持つようになったことです。 <span class="target" id="index-87"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0302"><strong>PEP 302</strong></a> はローダの実装においてこの属性をセットすることを必須とするよう更新されました。ですので今後サードパーティのローダが更新されれば、この属性の存在に依存出来るようになります。ですがそのときが来るまでは、インポート処理がモジュールのロードの後処理としてセットします。</p>
<p>さらにローダが <span class="target" id="index-88"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0366"><strong>PEP 366</strong></a> よりの <code class="docutils literal notranslate"><span class="pre">__package__</span></code> 属性を設定することも期待出来るようになりました。繰り返しになりますがインポート処理自身が既にこれを全てのローダで <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> より行っていて、また、インポート処理自身がこの属性をロードの後処理としてセットしています。</p>
<p><a class="reference internal" href="../library/sys.html#sys.path_hooks" title="sys.path_hooks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_hooks</span></code></a> にファインダが見つからない場合に、 <a class="reference internal" href="../library/sys.html#sys.path_importer_cache" title="sys.path_importer_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code></a> に <code class="docutils literal notranslate"><span class="pre">None</span></code> が挿入されるようになりました。 <a class="reference internal" href="../library/imp.html#imp.NullImporter" title="imp.NullImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">imp.NullImporter</span></code></a> は <a class="reference internal" href="../library/sys.html#sys.path_hooks" title="sys.path_hooks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_hooks</span></code></a> に直接的に公開されないため、これはファインダが見つからないことの表現値としては当てにならないものになりました。</p>
<p>全てのほかの変更は、Python 3.3 へのコードの更新の際に考慮すべきセマンティクスの変更に関係しています。ですのでそららについて、このドキュメントの <a class="reference internal" href="#porting-python-code">Python コードの移植</a> セクションを読むべきです。</p>
<p>(Implementation by Brett Cannon)</p>
</div>
</div>
<div class="section" id="other-language-changes">
<h2>その他の言語変更<a class="headerlink" href="#other-language-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 言語コアに小さな変更がいくつか行われました:</p>
<ul>
<li><p class="first">Unicode <a class="reference external" href="http://www.unicode.org/Public/UCD/latest/ucd/NameAliases.txt">name aliases</a> と <a class="reference external" href="http://www.unicode.org/Public/UCD/latest/ucd/NamedSequences.txt">named sequences</a> のサポートが追加されました。 <a class="reference internal" href="../library/unicodedata.html#unicodedata.lookup" title="unicodedata.lookup"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicodedata.lookup()</span></code></a> と <code class="docutils literal notranslate"><span class="pre">'\N{...}'</span></code> の両方が name aliases の解決を行い、 <a class="reference internal" href="../library/unicodedata.html#unicodedata.lookup" title="unicodedata.lookup"><code class="xref py py-func docutils literal notranslate"><span class="pre">unicodedata.lookup()</span></code></a> は named sequences の解決も行います。</p>
<p>(Contributed by Ezio Melotti in <a class="reference external" href="https://bugs.python.org/issue12753">bpo-12753</a>.)</p>
</li>
<li><p class="first">Unicode データベースを UCD バージョン 6.1.0 にアップグレードしました。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-func docutils literal notranslate"><span class="pre">range()</span></code></a> オブジェクトどうしの等値性比較が、それぞれの range オブジェクトによって生成されるシーケンスの等値性を反映して行われるようになりました (<a class="reference external" href="https://bugs.python.org/issue13201">bpo-13201</a>)。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> オブジェクトのメソッド <code class="docutils literal notranslate"><span class="pre">count()</span></code>, <code class="docutils literal notranslate"><span class="pre">find()</span></code>, <code class="docutils literal notranslate"><span class="pre">rfind()</span></code>, <code class="docutils literal notranslate"><span class="pre">index()</span></code>, <code class="docutils literal notranslate"><span class="pre">rindex()</span></code> が、第一引数に 0 から 255 の整数を受け付けるようになりました。</p>
<p>(Contributed by Petri Lehtinen in <a class="reference external" href="https://bugs.python.org/issue12170">bpo-12170</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> オブジェクトのメソッド <code class="docutils literal notranslate"><span class="pre">rjust()</span></code>, <code class="docutils literal notranslate"><span class="pre">ljust()</span></code>, <code class="docutils literal notranslate"><span class="pre">center()</span></code> が、 <code class="docutils literal notranslate"><span class="pre">fill</span></code> 引数として <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> を受け付けるようになりました  (Contributed by Petri Lehtinen in <a class="reference external" href="https://bugs.python.org/issue12380">bpo-12380</a>.)。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> と <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> に新規メソッド <code class="docutils literal notranslate"><span class="pre">copy()</span></code>, <code class="docutils literal notranslate"><span class="pre">clear()</span></code> が追加されました (<a class="reference external" href="https://bugs.python.org/issue10516">bpo-10516</a>)。これに伴い <a class="reference internal" href="../library/collections.abc.html#collections.abc.MutableSequence" title="collections.abc.MutableSequence"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableSequence</span></code></a> にも <code class="xref py py-meth docutils literal notranslate"><span class="pre">clear()</span></code> メソッドが追加されました (<a class="reference external" href="https://bugs.python.org/issue11388">bpo-11388</a>)。</p>
</li>
<li><p class="first">raw bytes リテラルとして <code class="docutils literal notranslate"><span class="pre">br&quot;...&quot;</span></code> だけでなく  <code class="docutils literal notranslate"><span class="pre">rb&quot;...&quot;</span></code> とも書けるようになりました。</p>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue13748">bpo-13748</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#dict.setdefault" title="dict.setdefault"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.setdefault()</span></code></a> が与えられたキーのルックアップを一度しか行わないようになったので、組み込み型でのこれの使用はアトミックになります。(訳注: 外部観察可能な変化で説明すると、以前はこの呼び出しが、キーの2回の __hash__、__eq__ 呼び出しを引き起こしていたものが、1回になった。)</p>
<p>(Contributed by Filip Gruszczyński in <a class="reference external" href="https://bugs.python.org/issue13521">bpo-13521</a>.)</p>
</li>
<li><p class="first">関数呼び出しが関数シグニチャに合致しない場合のエラーメッセージがかなり改善されました。</p>
<p>(Contributed by Benjamin Peterson.)</p>
</li>
</ul>
</div>
<div class="section" id="a-finer-grained-import-lock">
<h2>細粒度のインポートロック<a class="headerlink" href="#a-finer-grained-import-lock" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以前のバージョンの CPython では、常に大域的なインポートロックを当てにしていました。このことは意図せず頭痛の種を持ち込むこと繋がっていました。たとえば、モジュールをインポートすることで副作用として異なるスレッドでのコード実行を引き起こす際に起こる、デッドロックといったことです。不恰好な回避策がときどき採用されてきました。C API 関数 <a class="reference internal" href="../c-api/import.html#c.PyImport_ImportModuleNoBlock" title="PyImport_ImportModuleNoBlock"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModuleNoBlock()</span></code></a> などです。</p>
<p>Python 3.3 ではモジュールのインポートでは、モジュール単位でのロックを採用しています。このことによって複数スレッドからの指定モジュールのインポートは (モジュールが不完全な初期化のまま曝されるのを防いで) 正しく直列化されて、前述の頭痛の種は取り除かれています。</p>
<p>(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue9260">bpo-9260</a>.)</p>
</div>
<div class="section" id="builtin-functions-and-types">
<h2>組み込みの関数と型<a class="headerlink" href="#builtin-functions-and-types" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../library/functions.html#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> に新規パラメータ <em>opener</em> が追加されました。背後のファイルオブジェクトのファイル記述子は <em>opener</em> を (<em>file</em>, <em>flags</em>) で呼び出して得られます。これは例えば <a class="reference internal" href="../library/os.html#os.O_CLOEXEC" title="os.O_CLOEXEC"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.O_CLOEXEC</span></code></a> のようなカスタムなフラグを用いるのに使えます。 / <code class="docutils literal notranslate"><span class="pre">'x'</span></code> モードが追加されました。排他的作成として開きます。ファイルが既存の場合は失敗します。</li>
<li><a class="reference internal" href="../library/functions.html#print" title="print"><code class="xref py py-func docutils literal notranslate"><span class="pre">print()</span></code></a>: <em>flush</em> キーワード引数が追加されました。<em>flush</em> キーワード引数が真の場合ストリームは強制的にフラッシュされます。</li>
<li><a class="reference internal" href="../library/functions.html#hash" title="hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">hash()</span></code></a>: ハッシュのランダム化がデフォルトで有効になりました。 <a class="reference internal" href="../reference/datamodel.html#object.__hash__" title="object.__hash__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">object.__hash__()</span></code></a> と環境変数 <span class="target" id="index-89"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONHASHSEED"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHASHSEED</span></code></a> を参照してください。</li>
<li><a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 型に <a class="reference internal" href="../library/stdtypes.html#str.casefold" title="str.casefold"><code class="xref py py-meth docutils literal notranslate"><span class="pre">casefold()</span></code></a> メソッドが追加されました。文字列の casefold されたコピーを返します。casefold された文字列は、大文字小文字に関係ないマッチに使えます。例えば <code class="docutils literal notranslate"><span class="pre">'ß'.casefold()</span></code> は <code class="docutils literal notranslate"><span class="pre">'ss'</span></code> を返します。</li>
<li>シーケンスについてのドキュメントを大幅に書き換えました。バイナリのシーケンスとテキストのシーケンスについての区別についてより良い説明を加え、また、個々の組み込みシーケンスに関して個別のドキュメントを提供しています (<a class="reference external" href="https://bugs.python.org/issue4966">bpo-4966</a>)。</li>
</ul>
</div>
<div class="section" id="new-modules">
<h2>新たなモジュール<a class="headerlink" href="#new-modules" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="faulthandler">
<h3>faulthandler<a class="headerlink" href="#faulthandler" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>この新規モジュール <a class="reference internal" href="../library/faulthandler.html#module-faulthandler" title="faulthandler: Dump the Python traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">faulthandler</span></code></a> には、異常 (セグメンテーション違反のようなクラッシュ) 時、タイムアウト時、ユーザシグナルの発生時などのタイミングで Python traceback を明示的にダンプするための関数が含まれています。シグナル <code class="xref py py-const docutils literal notranslate"><span class="pre">SIGSEGV</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">SIGFPE</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">SIGABRT</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">SIGBUS</span></code>, <code class="xref py py-const docutils literal notranslate"><span class="pre">SIGILL</span></code> に対するフォールトハンドラをインストールするには、 <a class="reference internal" href="../library/faulthandler.html#faulthandler.enable" title="faulthandler.enable"><code class="xref py py-func docutils literal notranslate"><span class="pre">faulthandler.enable()</span></code></a> を呼び出してください。インタプリタ開始時点でも有効に出来ます。それには環境変数 <span class="target" id="index-90"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONFAULTHANDLER"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONFAULTHANDLER</span></code></a> をセットするか、コマンドラインオプション <a class="reference internal" href="../using/cmdline.html#id5"><code class="xref std std-option docutils literal notranslate"><span class="pre">-X</span></code></a> <code class="docutils literal notranslate"><span class="pre">faulthandler</span></code> を与えます。</p>
<p>Linuxでのセグメンテーションフォールト時の例:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -q -X faulthandler
<span class="gp">&gt;</span>&gt;&gt; import ctypes
<span class="gp">&gt;</span>&gt;&gt; ctypes.string_at<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="go">Fatal Python error: Segmentation fault</span>

<span class="go">Current thread 0x00007fb899f39700:</span>
<span class="go">  File &quot;/home/python/cpython/Lib/ctypes/__init__.py&quot;, line 486 in string_at</span>
<span class="go">  File &quot;&lt;stdin&gt;&quot;, line 1 in &lt;module&gt;</span>
<span class="go">Segmentation fault</span>
</pre></div>
</div>
</div>
<div class="section" id="ipaddress">
<h3>ipaddress<a class="headerlink" href="#ipaddress" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新規モジュール <a class="reference internal" href="../library/ipaddress.html#module-ipaddress" title="ipaddress: IPv4/IPv6 manipulation library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ipaddress</span></code></a> は、IPv4/IPv6 アドレス、ネットワーク、インターフェイス (すなわち固有の IP サブネットで関連付けられる IP アドレス)を表現するオブジェクトを生成したり加工したりするための道具立てを提供します。</p>
<p>(Contributed by Google and Peter Moody in <span class="target" id="index-25"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3144"><strong>PEP 3144</strong></a>.)</p>
</div>
<div class="section" id="lzma">
<h3>lzma<a class="headerlink" href="#lzma" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新たに追加された <a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> モジュールは LZMA アルゴリズムを用いたデータの圧縮と解凍を提供します。<code class="docutils literal notranslate"><span class="pre">.xz</span></code> および <code class="docutils literal notranslate"><span class="pre">.lzma</span></code> ファイル形式もサポートされています。</p>
<p>(Contributed by Nadeem Vawda and Per Øyvind Karlsen in <a class="reference external" href="https://bugs.python.org/issue6715">bpo-6715</a>.)</p>
</div>
</div>
<div class="section" id="improved-modules">
<h2>改良されたモジュール<a class="headerlink" href="#improved-modules" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="abc">
<h3>abc<a class="headerlink" href="#abc" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>抽象メソッドで構成されるデスクリプタを含む抽象基底クラスのサポートが改善されています。抽象デスクリプタを宣言するために推奨されるアプローチは今後は、動的に更新されるプロパティとして <code class="xref py py-attr docutils literal notranslate"><span class="pre">__isabstractmethod__</span></code> を提供することです。この結果として、組み込みのデスクリプタが更新されました。</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../library/abc.html#abc.abstractproperty" title="abc.abstractproperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractproperty</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#property" title="property"><code class="xref py py-class docutils literal notranslate"><span class="pre">property</span></code></a> を渡して使ってください。</li>
<li><a class="reference internal" href="../library/abc.html#abc.abstractclassmethod" title="abc.abstractclassmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractclassmethod</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">classmethod</span></code></a> を渡して使ってください。</li>
<li><a class="reference internal" href="../library/abc.html#abc.abstractstaticmethod" title="abc.abstractstaticmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractstaticmethod</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">staticmethod</span></code></a> を渡して使ってください。</li>
</ul>
</div></blockquote>
<p>(Contributed by Darren Dale in <a class="reference external" href="https://bugs.python.org/issue11610">bpo-11610</a>.)</p>
<p><a class="reference internal" href="../library/abc.html#abc.ABCMeta.register" title="abc.ABCMeta.register"><code class="xref py py-meth docutils literal notranslate"><span class="pre">abc.ABCMeta.register()</span></code></a> が登録されたサブクラスを返すようになりました。つまりクラスデコレータとして使うことができるようになったということです (<a class="reference external" href="https://bugs.python.org/issue10868">bpo-10868</a>)。</p>
</div>
<div class="section" id="array">
<h3>array<a class="headerlink" href="#array" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/array.html#module-array" title="array: Space efficient arrays of uniformly typed numeric values."><code class="xref py py-mod docutils literal notranslate"><span class="pre">array</span></code></a> モジュールに型コード <code class="docutils literal notranslate"><span class="pre">q</span></code> と <code class="docutils literal notranslate"><span class="pre">Q</span></code> による <code class="xref c c-type docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> 型サポートが追加されました。</p>
<p>(Contributed by Oren Tirosh and Hirokazu Yamamoto in <a class="reference external" href="https://bugs.python.org/issue1172711">bpo-1172711</a>.)</p>
</div>
<div class="section" id="base64">
<h3>base64<a class="headerlink" href="#base64" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/base64.html#module-base64" title="base64: RFC 3548: Base16, Base32, Base64 Data Encodings; Base85 and Ascii85"><code class="xref py py-mod docutils literal notranslate"><span class="pre">base64</span></code></a> モジュールのモダンなインターフェイスのほうのデコード関数が、ASCII 文字のみで構成された Unicode 文字列を受け付けるようになりました。たとえば <code class="docutils literal notranslate"><span class="pre">base64.b64decode('YWJj')</span></code> は <code class="docutils literal notranslate"><span class="pre">b'abc'</span></code> を返します。 (Contributed by Catalin Iacob in <a class="reference external" href="https://bugs.python.org/issue13641">bpo-13641</a>.)</p>
</div>
<div class="section" id="binascii">
<h3>binascii<a class="headerlink" href="#binascii" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">a2b_</span></code> 関数が、バイナリオブジェクトだけでなく ASCII 文字のみで構成された Unicode 文字列を入力として受け付けるようになりました。 (Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue13637">bpo-13637</a>.)</p>
</div>
<div class="section" id="bz2">
<h3>bz2<a class="headerlink" href="#bz2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/bz2.html#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bz2</span></code></a> モジュールが最初から書き直されました。その過程で新機能がいくつか追加されました。</p>
<ul>
<li><p class="first">新たな <a class="reference internal" href="../library/bz2.html#bz2.open" title="bz2.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">bz2.open()</span></code></a> 関数: bzip2 で圧縮されたファイルをバイナリかテキストモードで開きます。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> が、コンストラクタの <em>fileobj</em> 引数で、任意のファイル様オブジェクトの読み書きが出来るようになりました。</p>
<p>(Contributed by Nadeem Vawda in <a class="reference external" href="https://bugs.python.org/issue5863">bpo-5863</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> と <a class="reference internal" href="../library/bz2.html#bz2.decompress" title="bz2.decompress"><code class="xref py py-func docutils literal notranslate"><span class="pre">bz2.decompress()</span></code></a> が (<strong class="program">pbzip2</strong> ツールで生成されたような) マルチストリームの入力を展開出来るようになりました。同時に <a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> は、 <code class="docutils literal notranslate"><span class="pre">'a'</span></code> (追記) モードを使ってこのタイプの圧縮ファイルを作るのに使えるようになりました。</p>
<p>(Contributed by Nir Aides in <a class="reference external" href="https://bugs.python.org/issue1625">bpo-1625</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> が、 <a class="reference internal" href="../library/io.html#io.BufferedIOBase" title="io.BufferedIOBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.BufferedIOBase</span></code></a> API で規定されているメソッドや属性のうち、 <code class="xref py py-meth docutils literal notranslate"><span class="pre">detach()</span></code> と <code class="xref py py-meth docutils literal notranslate"><span class="pre">truncate()</span></code> を除くすべてを実装するようになりました。</p>
</li>
</ul>
</div>
<div class="section" id="codecs">
<h3>codecs<a class="headerlink" href="#codecs" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/codecs.html#module-encodings.mbcs" title="encodings.mbcs: Windows ANSI codepage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mbcs</span></code></a> コーデックが、全ての Windows バージョンでエラーハンドラ <code class="docutils literal notranslate"><span class="pre">replace</span></code> と <code class="docutils literal notranslate"><span class="pre">ignore</span></code> を正しく処理するように書き換えられました。 <a class="reference internal" href="../library/codecs.html#module-encodings.mbcs" title="encodings.mbcs: Windows ANSI codepage"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mbcs</span></code></a> コーデックは以前は、エンコードでは <code class="docutils literal notranslate"><span class="pre">replace</span></code> のみ、デコードでは <code class="docutils literal notranslate"><span class="pre">ignore</span></code> のみでしたが、これにより全てのエラーハンドラがサポートされます。</p>
<p>新たに Windows のみ用のコーデック <code class="docutils literal notranslate"><span class="pre">cp65001</span></code> が追加されました (<a class="reference external" href="https://bugs.python.org/issue13216">bpo-13216</a>)。これは Windows コードページ 65001 (Windows UTF-8, <code class="docutils literal notranslate"><span class="pre">CP_UTF8</span></code>) です。例えばこれはコンソール出力のコードページが (例えば <code class="docutils literal notranslate"><span class="pre">chcp</span> <span class="pre">65001</span></code> コマンドを使って)  cp65001 にセットされている場合に <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> で使われます。</p>
<p>マルチバイト CJK デコーダの再同期が高速になりました。これは不正なバイトシーケンスが最初のバイトであれば無視するだけです。例えば <code class="docutils literal notranslate"><span class="pre">b'\xff\n'.decode('gb2312',</span> <span class="pre">'replace')</span></code> は文字置き換えののちに <code class="docutils literal notranslate"><span class="pre">\n</span></code> を返すようになっています。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue12016">bpo-12016</a>)</p>
<p>漸増的 CJK コーデックのエンコーダは以前は encode() メソッド呼び出しのたびにリセットしていましたが、リセットしなくなりました。例えば:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">codecs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getincrementalencoder</span><span class="p">(</span><span class="s1">&#39;hz&#39;</span><span class="p">)(</span><span class="s1">&#39;strict&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="se">\u52ff\u65bd\u65bc\u4eba\u3002</span><span class="s1"> Bye.&#39;</span><span class="p">)</span>
<span class="go">b&#39;~{NpJ)l6HK!#~} Bye.&#39;</span>
</pre></div>
</div>
<p>この例の場合は以前の Python では <code class="docutils literal notranslate"><span class="pre">b'~{Np~}~{J)~}~{l6~}~{HK~}~{!#~}</span> <span class="pre">Bye.'</span></code> となっていました。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue12100">bpo-12100</a>)</p>
<p><code class="docutils literal notranslate"><span class="pre">unicode_internal</span></code> コーデックは非推奨となりました。</p>
</div>
<div class="section" id="collections">
<h3>collections<a class="headerlink" href="#collections" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新たに追加されたクラス <a class="reference internal" href="../library/collections.html#collections.ChainMap" title="collections.ChainMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChainMap</span></code></a> は、複数のマッピングをひとまとまりに扱えるようにします。 (Written by Raymond Hettinger for <a class="reference external" href="https://bugs.python.org/issue11089">bpo-11089</a>, made public in <a class="reference external" href="https://bugs.python.org/issue11297">bpo-11297</a>.)</p>
<p>抽象基底クラス群は新しいモジュール <a class="reference internal" href="../library/collections.abc.html#module-collections.abc" title="collections.abc: Abstract base classes for containers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a> に移動しました。抽象コレクションと具象コレクションを識別しやすくするためです。これをインポートしている既存のコードを維持するために、 ABC の別名群が <a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections</span></code></a> モジュール内に残されています。 (<a class="reference external" href="https://bugs.python.org/issue11085">bpo-11085</a>)</p>
<p><a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Counter</span></code></a> クラスが、単項 <code class="docutils literal notranslate"><span class="pre">+</span></code> 演算子、単項 <code class="docutils literal notranslate"><span class="pre">-</span></code> 演算子、インプレイス演算子の <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code> をサポートするようになりました。(Contributed by Raymond Hettinger in <a class="reference external" href="https://bugs.python.org/issue13121">bpo-13121</a>.)</p>
</div>
<div class="section" id="contextlib">
<h3>contextlib<a class="headerlink" href="#contextlib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コンテキストマネージャをプログラム的に操作することと、これと類似のクリーンアップの機能性について、<a class="reference internal" href="../library/contextlib.html#contextlib.ExitStack" title="contextlib.ExitStack"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExitStack</span></code></a> が今後は確かな基礎を提供します。かつての (非推奨となり削除された) <code class="docutils literal notranslate"><span class="pre">contextlib.nested</span></code> API とは違って、この新しい API は、コンテキストマネージャがリソースを (たとえばファイルオブジェクトなどを) <code class="docutils literal notranslate"><span class="pre">__init__</span></code> メソッドで獲得したのか、あるいは (たとえば <a class="reference internal" href="../library/threading.html#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> モジュールからの同期オブジェクトを) <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> メソッドで獲得したのかとは無関係に正しく動作するように設計されました。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue13585">bpo-13585</a>)</p>
</div>
<div class="section" id="crypt">
<h3>crypt<a class="headerlink" href="#crypt" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/crypt.html#module-crypt" title="crypt: The crypt() function used to check Unix passwords. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">crypt</span></code></a> モジュールに、 salt として使う追加の crypt フォーマット (ハッシュ化メソッド) と <a class="reference internal" href="../library/crypt.html#crypt.mksalt" title="crypt.mksalt"><code class="xref py py-func docutils literal notranslate"><span class="pre">mksalt()</span></code></a> 関数が追加されました。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue10924">bpo-10924</a>)</p>
</div>
<div class="section" id="curses">
<h3>curses<a class="headerlink" href="#curses" title="このヘッドラインへのパーマリンク">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../library/curses.html#module-curses" title="curses: An interface to the curses library, providing portable terminal handling. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">curses</span></code></a> モジュールが ncursesw ライブラリとリンクしている場合に、 Unicode 文字列や Unicode 文字が渡されれば Unicode 関数 (例えば <code class="xref c c-func docutils literal notranslate"><span class="pre">waddwstr()</span></code>)、それ以外の場合はバイト列用関数 (例えば <code class="xref c c-func docutils literal notranslate"><span class="pre">waddstr()</span></code>) を呼び出すようにしました。</li>
<li>Unicode 文字列をエンコードするのに <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> ではなく locale のエンコーディングを使うようになりました。(---訳注:  <a class="reference external" href="https://bugs.python.org/issue12567">bpo-12567</a> に対応した説明と思います。とすればこれは <strong>ワイド文字を受け取らない C 関数に渡す</strong> 際に Unicode をエンコードする際の話。このときに以前は暗黙で <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> でエンコードしていたのは「誤りである」ということのようです。 ---)</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">curses.window</span></code> クラスに属性 <a class="reference internal" href="../library/curses.html#curses.window.encoding" title="curses.window.encoding"><code class="xref py py-attr docutils literal notranslate"><span class="pre">curses.window.encoding</span></code></a> が追加されました。</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">curses.window</span></code> クラスに <a class="reference internal" href="../library/curses.html#curses.window.get_wch" title="curses.window.get_wch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_wch()</span></code></a> メソッドが追加されました。これはワイド文字を一つ取得します。</li>
<li><a class="reference internal" href="../library/curses.html#module-curses" title="curses: An interface to the curses library, providing portable terminal handling. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">curses</span></code></a> モジュールに関数 <a class="reference internal" href="../library/curses.html#curses.unget_wch" title="curses.unget_wch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unget_wch()</span></code></a> が追加されました。これはワイド文字をプッシュし、次に <a class="reference internal" href="../library/curses.html#curses.window.get_wch" title="curses.window.get_wch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_wch()</span></code></a> を呼び出した時にその値が返るようにします。</li>
</ul>
</div></blockquote>
<p>(Contributed by Iñigo Serna in <a class="reference external" href="https://bugs.python.org/issue6755">bpo-6755</a>.)
(---訳注: 最初の2つはおそらく <a class="reference external" href="https://bugs.python.org/issue12567">bpo-12567</a> --)</p>
</div>
<div class="section" id="datetime">
<h3>datetime<a class="headerlink" href="#datetime" title="このヘッドラインへのパーマリンク">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>naive な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> インスタンスと aware な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> インスタンスの等価比較で、 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> を投げずに <a class="reference internal" href="../library/constants.html#False" title="False"><code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code></a> を返すようになりました。 (<a class="reference external" href="https://bugs.python.org/issue15006">bpo-15006</a>).</li>
<li>新規メソッド <a class="reference internal" href="../library/datetime.html#datetime.datetime.timestamp" title="datetime.datetime.timestamp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">datetime.datetime.timestamp()</span></code></a>: <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> インスタンスに対応する POSIX タイムスタンプを返します。</li>
<li><a class="reference internal" href="../library/datetime.html#datetime.datetime.strftime" title="datetime.datetime.strftime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">datetime.datetime.strftime()</span></code></a> メソッドが 1000 年よりも前の書式化をサポートしました。(---訳注: What's New in Python 3.2 での変更も参照してみてください。---)</li>
<li><a class="reference internal" href="../library/datetime.html#datetime.datetime.astimezone" title="datetime.datetime.astimezone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">datetime.datetime.astimezone()</span></code></a> メソッドを引数なしで呼び出せるようになりました。これは datetime インスタンスをシステムのタイムゾーンに変換します。</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="decimal">
<span id="new-decimal"></span><h3>decimal<a class="headerlink" href="#decimal" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="docutils">
<dt><a class="reference external" href="https://bugs.python.org/issue7652">bpo-7652</a> - decimal 算術演算の、高速なネイティブ 実装の統合</dt>
<dd>C-module and libmpdec written by Stefan Krah.</dd>
</dl>
<p>decimal モジュールの新しい C バージョンは高速な libmpdec と統合します。それは任意精度で正しい丸めを行う 10 進浮動小数点数算術演算を行います。libmpdec は IBM の「General Decimal Arithmetic Specification」に従っています。</p>
<p>性能向上は、データベースアプリケーションで 10 倍から、数値計算が中心的なアプリケーションで 100 倍まで幅があります。この数字は、 10進数の浮動小数点計算において使われる標準的な精度における期待値です。精度はユーザが変更可能なので、正確な数字は変わる可能性があります。例えば、整数 bignum 計算では、違いはかなりより大きくなるかもしれません。</p>
<p>以下の表は説明のためのものです。ベンチマークは <a class="reference external" href="http://www.bytereef.org/mpdecimal/quickstart.html">http://www.bytereef.org/mpdecimal/quickstart.html</a> にあります。</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="27%" />
<col width="29%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">decimal.py</th>
<th class="head">_decimal</th>
<th class="head">speedup</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>pi</td>
<td>42.02s</td>
<td>0.345s</td>
<td>120x</td>
</tr>
<tr class="row-odd"><td>telco</td>
<td>172.19s</td>
<td>5.68s</td>
<td>30x</td>
</tr>
<tr class="row-even"><td>psycopg</td>
<td>3.57s</td>
<td>0.29s</td>
<td>12x</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="id1">
<h4>フィーチャー<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../library/decimal.html#decimal.FloatOperation" title="decimal.FloatOperation"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FloatOperation</span></code></a> <a class="reference internal" href="../library/decimal.html#decimal-signals"><span class="std std-ref">シグナル</span></a> により、float と Decimal の混合の厳密なセマンティクスを有効に出来ます。(---訳注: 使用例が <a class="reference internal" href="../library/decimal.html#decimal-tutorial"><span class="std std-ref">クイックスタートチュートリアル</span></a> にあります。---)</li>
<li>Python がスレッド無しでコンパイルされている場合、C 版は自動的にコストがかかるスレッドローカルなコンテキスト機構を使用不可にします。この場合、 <a class="reference internal" href="../library/decimal.html#decimal.HAVE_THREADS" title="decimal.HAVE_THREADS"><code class="xref py py-data docutils literal notranslate"><span class="pre">HAVE_THREADS</span></code></a> が <code class="docutils literal notranslate"><span class="pre">False</span></code> にセットされます。</li>
</ul>
</div>
<div class="section" id="id2">
<h4>API の変更<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h4>
<ul>
<li><p class="first">C モジュールはマシンアーキテクチャに依存する以下のコンテキストの制限を持ちます:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="30%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">32-bit</th>
<th class="head">64-bit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-const docutils literal notranslate"><span class="pre">MAX_PREC</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">425000000</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">999999999999999999</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-const docutils literal notranslate"><span class="pre">MAX_EMAX</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">425000000</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">999999999999999999</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-const docutils literal notranslate"><span class="pre">MIN_EMIN</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">-425000000</span></code></td>
<td><code class="xref py py-const docutils literal notranslate"><span class="pre">-999999999999999999</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">コンテキストの雛形 (<a class="reference internal" href="../library/decimal.html#decimal.DefaultContext" title="decimal.DefaultContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultContext</span></code></a>, <a class="reference internal" href="../library/decimal.html#decimal.BasicContext" title="decimal.BasicContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicContext</span></code></a>, <a class="reference internal" href="../library/decimal.html#decimal.ExtendedContext" title="decimal.ExtendedContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtendedContext</span></code></a>) では <code class="xref py py-attr docutils literal notranslate"><span class="pre">Emax</span></code> と <code class="xref py py-attr docutils literal notranslate"><span class="pre">Emin</span></code> の絶対値が <code class="xref py py-const docutils literal notranslate"><span class="pre">999999</span></code> に変更されました。</p>
</li>
<li><p class="first">decimal.py の <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a> コンストラクタは上記のコンテキスト制限に無知で、任意の指数や精度で正確に変換しようとします。C 版は内部の制限を持っていますので、次の規則が使われます: 可能ならば値は正確に変換され、そうでない場合 <a class="reference internal" href="../library/decimal.html#decimal.InvalidOperation" title="decimal.InvalidOperation"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidOperation</span></code></a> が送出されて結果が NaN となります。後者のケースは丸めあるいは不正確な値を得るために <a class="reference internal" href="../library/decimal.html#decimal.Context.create_decimal" title="decimal.Context.create_decimal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_decimal()</span></code></a> を使うことでいつでも可能です。(---訳注: わかりにくい表現ですがコンテキストで InvalidOperation をトラップしていれば結果が NaN で受け取れて(そうでなければ InvalidOperation が投げられて)、その制御は create_decimal で明示的に行える、ということを言っています。---)</p>
</li>
<li><p class="first">decimal.py の <a class="reference internal" href="../library/decimal.html#decimal.Context.power" title="decimal.Context.power"><code class="xref py py-meth docutils literal notranslate"><span class="pre">power()</span></code></a> 関数は「always correctly-rounded (必ず適切に丸められる)」です。C 版ではこれの意味は関数 <a class="reference internal" href="../library/decimal.html#decimal.Decimal.exp" title="decimal.Decimal.exp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exp()</span></code></a> と <a class="reference internal" href="../library/decimal.html#decimal.Decimal.ln" title="decimal.Decimal.ln"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ln()</span></code></a> に関してであり、最終的な結果においては「almost always correctly rounded (ほとんど必ず適切に丸められる)」となるだけです。</p>
</li>
<li><p class="first">C 版ではシグナルを含む辞書は <a class="reference internal" href="../library/collections.abc.html#collections.abc.MutableMapping" title="collections.abc.MutableMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableMapping</span></code></a> です。速度的な理由により <code class="xref py py-attr docutils literal notranslate"><span class="pre">flags</span></code> と <code class="xref py py-attr docutils literal notranslate"><span class="pre">traps</span></code> はコンテキストが初期化された時点での <a class="reference internal" href="../library/collections.abc.html#collections.abc.MutableMapping" title="collections.abc.MutableMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableMapping</span></code></a> を参照し続けます。新たなシグナル辞書を <code class="xref py py-attr docutils literal notranslate"><span class="pre">flags</span></code> に <code class="xref py py-attr docutils literal notranslate"><span class="pre">traps</span></code> 割り当てれば新しい値で更新はされるものの、コンテキストはそれら右辺の辞書を参照しません。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/decimal.html#decimal.Context" title="decimal.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> を pickle 化するとこれまでとは異なる出力をします。これは Python 版と C 版で共通の交換フォーマットを実現するためです。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/decimal.html#decimal.Context" title="decimal.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> コンストタクタの引数順が <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> での表示順に合うように改められました。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/decimal.html#decimal.Decimal.quantize" title="decimal.Decimal.quantize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">quantize()</span></code></a> メソッドの <code class="docutils literal notranslate"><span class="pre">watchexp</span></code> パラメータが非推奨となりました。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="email">
<span id="new-email"></span><h3>email<a class="headerlink" href="#email" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="section" id="policy-framework">
<h4>ポリシーフレームワーク<a class="headerlink" href="#policy-framework" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>email パッケージに <a class="reference internal" href="../library/email.policy.html#module-email.policy" title="email.policy: Controlling the parsing and generating of messages"><code class="xref py py-mod docutils literal notranslate"><span class="pre">policy</span></code></a> フレームワークが追加されました。 <a class="reference internal" href="../library/email.policy.html#email.policy.Policy" title="email.policy.Policy"><code class="xref py py-class docutils literal notranslate"><span class="pre">Policy</span></code></a> は、 email パッケージがどのように振舞うのかを制御するための多数のメソッドとプロパティを持つオブジェクトです。Python 3.3 のための最初のポリシーは <a class="reference internal" href="../library/email.policy.html#email.policy.Compat32" title="email.policy.Compat32"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compat32</span></code></a> で、これは Python 3.2 の email パッケージとの後方互換性を提供します。 <code class="docutils literal notranslate"><span class="pre">policy</span></code> は、 <a class="reference internal" href="../library/email.parser.html#module-email.parser" title="email.parser: Parse flat text email messages to produce a message object structure."><code class="xref py py-mod docutils literal notranslate"><span class="pre">parser</span></code></a> によって email メッセージが解析される際、あるいは <a class="reference internal" href="../library/email.compat32-message.html#email.message.Message" title="email.message.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> オブジェクトを生成する際、あるいは <a class="reference internal" href="../library/email.generator.html#module-email.generator" title="email.generator: Generate flat text email messages from a message structure."><code class="xref py py-mod docutils literal notranslate"><span class="pre">generator</span></code></a> を用いて email がシリアライズする際に指定出来ます。オーバライドしない限りは、 <code class="docutils literal notranslate"><span class="pre">parser</span></code> に渡されたポリシーは全ての <code class="docutils literal notranslate"><span class="pre">Message</span></code> オブジェクトと <code class="docutils literal notranslate"><span class="pre">parser</span></code> が生成したサブオブジェクトに引き継がれます。デフォルトでは <code class="docutils literal notranslate"><span class="pre">generator</span></code> は、シリアライズしようとする <code class="docutils literal notranslate"><span class="pre">Message</span></code> オブジェクトのポリシーを使います。デフォルトのポリシーは <a class="reference internal" href="../library/email.policy.html#email.policy.compat32" title="email.policy.compat32"><code class="xref py py-data docutils literal notranslate"><span class="pre">compat32</span></code></a> です。</p>
<p>すべての <code class="docutils literal notranslate"><span class="pre">policy</span></code> オブジェクトで実装される制御の最小限のセットは以下です:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>max_line_length</td>
<td><code class="docutils literal notranslate"><span class="pre">Message</span></code> がシリアライズされる際に各行が持ちうる、linesep 文字(列)を含まない最大の行幅です。デフォルトでは 78 です。</td>
</tr>
<tr class="row-even"><td>linesep</td>
<td><code class="docutils literal notranslate"><span class="pre">Message</span></code> がシリアライズされる際に各行を分割するのに使われる文字です。デフォルトは <code class="docutils literal notranslate"><span class="pre">\n</span></code> です。</td>
</tr>
<tr class="row-odd"><td>cte_type</td>
<td><code class="docutils literal notranslate"><span class="pre">7bit</span></code> または <code class="docutils literal notranslate"><span class="pre">8bit</span></code> 。 <code class="docutils literal notranslate"><span class="pre">8bit</span></code> は <code class="docutils literal notranslate"><span class="pre">Bytes</span></code> <code class="docutils literal notranslate"><span class="pre">generator</span></code> に対してのみ適用され、プロトコルが許す場所 (あるいはオリジナルの入力に含まれる場所) には非 ASCII が使われうることを示します。</td>
</tr>
<tr class="row-even"><td>raise_on_defect</td>
<td><code class="docutils literal notranslate"><span class="pre">parser</span></code> が異常を検出した場合に、 <code class="docutils literal notranslate"><span class="pre">Message</span></code> オブジェクトの <code class="docutils literal notranslate"><span class="pre">defects</span></code> リストに追加するのではなく例外を送出するようにします。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>新たな設定値を持つ新しいポリシーインスタンスは、ポリシーオブジェクトの <a class="reference internal" href="../library/email.policy.html#email.policy.Policy.clone" title="email.policy.Policy.clone"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clone()</span></code></a> メソッドを使って作られます。 <code class="docutils literal notranslate"><span class="pre">clone</span></code> は任意の上記制御値をキーワード引数として受け取ります。この呼び出しで指定されない制御はデフォルトのまま残されます。ですので linesep 文字列として <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> を使うポリシーをこのようにして作れます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mypolicy</span> <span class="o">=</span> <span class="n">compat32</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">linesep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>ポリシーは、あなたのアプリケーションが必要とするフォーマットでメッセージを生成するのを簡単にしてくれます。 <code class="docutils literal notranslate"><span class="pre">generator</span></code> を呼び出す全ての場所で <code class="docutils literal notranslate"><span class="pre">linesep='\r\n'</span></code> を指定するのを忘れないようにする代わりに、あなたのプログラムが <code class="docutils literal notranslate"><span class="pre">Message</span></code> オブジェクトを作成するために使う <code class="docutils literal notranslate"><span class="pre">parser</span></code> あるいは <code class="docutils literal notranslate"><span class="pre">Message</span></code> がポリシーを要求する一箇所だけで指定すれば良いのです。もちろん一方ではメッセージを複数の形式で生成する必要があれば、 <code class="docutils literal notranslate"><span class="pre">generator</span></code> 呼び出しのたびにパラメータで指定する必要があります。もしくは、あなた固有のケースのためにカスタムなポリシーを作って、 <code class="docutils literal notranslate"><span class="pre">generator</span></code> 作成の際にそれを渡すことも出来ます。</p>
</div>
<div class="section" id="provisional-policy-with-new-header-api">
<h4>新規ヘッダ API を伴った暫定ポリシー<a class="headerlink" href="#provisional-policy-with-new-header-api" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>ポリシーフレームワーク単品でもまったくもって価値があるものではありますが、その導入の主たる動機は、それを使わないコードに対しての後方互換を壊さないやり方で、email パッケージに新機能を実現する新しいポリシーを作れるようにすることでした。その新しいポリシーは新規 API を導入するものなので、私たちはそれらを Python 3.3 での <a class="reference internal" href="../glossary.html#term-provisional-package"><span class="xref std std-term">暫定ポリシー</span></a> としてリリースしました。コア開発者が必要と判断すれば、後方互換性を破壊する (コードの破棄さえも含む) 変更が起こりえます。</p>
<p>その新規ポリシーは <a class="reference internal" href="../library/email.policy.html#email.policy.EmailPolicy" title="email.policy.EmailPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailPolicy</span></code></a> のインスタンス (訳注: <a class="reference internal" href="../library/email.policy.html#email.policy.default" title="email.policy.default"><code class="xref py py-data docutils literal notranslate"><span class="pre">email.policy.default</span></code></a> や <a class="reference internal" href="../library/email.policy.html#email.policy.SMTP" title="email.policy.SMTP"><code class="xref py py-data docutils literal notranslate"><span class="pre">email.policy.SMTP</span></code></a> など) です。これには以下の制御が追加されています:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>refold_source</td>
<td><a class="reference internal" href="../library/email.parser.html#module-email.parser" title="email.parser: Parse flat text email messages to produce a message object structure."><code class="xref py py-mod docutils literal notranslate"><span class="pre">parser</span></code></a> により解析されたヘッダを、 <a class="reference internal" href="../library/email.generator.html#module-email.generator" title="email.generator: Generate flat text email messages from a message structure."><code class="xref py py-mod docutils literal notranslate"><span class="pre">generator</span></code></a> が折り返しし直す (refold) かどうかを制御します。 <code class="docutils literal notranslate"><span class="pre">none</span></code>, <code class="docutils literal notranslate"><span class="pre">long</span></code>, <code class="docutils literal notranslate"><span class="pre">all</span></code> のいずれかを指定します。デフォルトは <code class="docutils literal notranslate"><span class="pre">long</span></code> で、ソースのヘッダで <code class="docutils literal notranslate"><span class="pre">max_line_length</span></code> よりも長い行を refold します。 <code class="docutils literal notranslate"><span class="pre">none</span></code> はどの行も refold しません。 <code class="docutils literal notranslate"><span class="pre">all</span></code> は全ての行を refold します。</td>
</tr>
<tr class="row-even"><td>header_factory</td>
<td><code class="docutils literal notranslate"><span class="pre">name</span></code> と <code class="docutils literal notranslate"><span class="pre">value</span></code> を引数に取り、カスタムなヘッダオブジェクトを生成する呼び出し可能 (callable) です。</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">header_factory</span></code> が、この新規ポリシーにより提供される新機能の要です。この新規ポリシーの一つが使われると、 <code class="docutils literal notranslate"><span class="pre">Message</span></code> オブジェクトから抽出されたすべてのヘッダは <code class="docutils literal notranslate"><span class="pre">header_factory</span></code> で生成されるオブジェクトであり、また、 <code class="docutils literal notranslate"><span class="pre">Message</span></code> にヘッダをセットする場合のいつでも、それは <code class="docutils literal notranslate"><span class="pre">header_factory</span></code> で生成されるオブジェクトになります。すべてのその種のヘッダオブジェクトは、ヘッダ名と同名の <code class="docutils literal notranslate"><span class="pre">name</span></code> 属性を持ちます。アドレスヘッダと日付ヘッダは、ヘッダの解析済み日付にアクセス出来るよう、追加の属性群を持ちます。以下のように使えます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">policy</span><span class="o">=</span><span class="n">SMTP</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Éric &lt;foo@example.com&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span>
<span class="go">&#39;Éric &lt;foo@example.com&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">(Address(display_name=&#39;Éric&#39;, username=&#39;foo&#39;, domain=&#39;example.com&#39;),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">username</span>
<span class="go">&#39;foo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addresses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">display_name</span>
<span class="go">&#39;Éric&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
<span class="go">datetime.datetime(2012, 5, 25, 21, 39, 24, 465484, tzinfo=datetime.timezone(datetime.timedelta(-1, 72000), &#39;EDT&#39;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="go">&#39;Fri, 25 May 2012 21:44:27 -0400&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">To: =?utf-8?q?=C3=89ric?= &lt;foo@example.com&gt;</span>
<span class="go">Date: Fri, 25 May 2012 21:44:27 -0400</span>
</pre></div>
</div>
<p>Unicode の display name が、メッセージがシリアライズされる際に自動的に <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> (訳注: 実行例の場合は「の MIME ヘッダエンコード」) でエンコードされ、ヘッダに直接アクセスすると Unicode で返ることに気付くと思います。つまり <a class="reference internal" href="../library/email.header.html#module-email.header" title="email.header: Representing non-ASCII headers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">email.header</span></code></a> の <a class="reference internal" href="../library/email.header.html#email.header.decode_header" title="email.header.decode_header"><code class="xref py py-meth docutils literal notranslate"><span class="pre">decode_header()</span></code></a> 関数や <a class="reference internal" href="../library/email.header.html#email.header.make_header" title="email.header.make_header"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_header()</span></code></a> 関数を取り扱う必要性を取り除いてくれています。</p>
<p>アドレスを部品から組み立てることも出来ます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Group</span><span class="p">(</span><span class="s1">&#39;pals&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">Address</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="s1">&#39;example.com&#39;</span><span class="p">),</span>
<span class="gp">... </span>                          <span class="n">Address</span><span class="p">(</span><span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="s1">&#39;sally&#39;</span><span class="p">,</span> <span class="s1">&#39;example.com&#39;</span><span class="p">)]),</span>
<span class="gp">... </span>           <span class="n">Address</span><span class="p">(</span><span class="s1">&#39;Bonzo&#39;</span><span class="p">,</span> <span class="n">addr_spec</span><span class="o">=</span><span class="s1">&#39;bonz@laugh.com&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">To: =?utf-8?q?=C3=89ric?= &lt;foo@example.com&gt;</span>
<span class="go">Date: Fri, 25 May 2012 21:44:27 -0400</span>
<span class="go">cc: pals: Bob &lt;bob@example.com&gt;, Sally &lt;sally@example.com&gt;;, Bonzo &lt;bonz@laugh.com&gt;</span>
</pre></div>
</div>
<p>Unicode へデコードするのは自動で行われます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">message_from_string</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span>
<span class="go">&#39;Éric &lt;foo@example.com&gt;&#39;</span>
</pre></div>
</div>
<p>メッセージ解析の際、グループと個々のアドレスにアクセスするのにヘッダオブジェクトの <code class="docutils literal notranslate"><span class="pre">addresses</span></code> 属性と <code class="docutils literal notranslate"><span class="pre">groups</span></code> 属性を使えます:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addresses</span>
<span class="go">(Address(display_name=&#39;Bob&#39;, username=&#39;bob&#39;, domain=&#39;example.com&#39;), Address(display_name=&#39;Sally&#39;, username=&#39;sally&#39;, domain=&#39;example.com&#39;), Address(display_name=&#39;Bonzo&#39;, username=&#39;bonz&#39;, domain=&#39;laugh.com&#39;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groups</span>
<span class="go">(Group(display_name=&#39;pals&#39;, addresses=(Address(display_name=&#39;Bob&#39;, username=&#39;bob&#39;, domain=&#39;example.com&#39;), Address(display_name=&#39;Sally&#39;, username=&#39;sally&#39;, domain=&#39;example.com&#39;)), Group(display_name=None, addresses=(Address(display_name=&#39;Bonzo&#39;, username=&#39;bonz&#39;, domain=&#39;laugh.com&#39;),))</span>
</pre></div>
</div>
<p>要するに新規ポリシーのどれか一つを使うことは、ヘッダ操作をこのようなものにしてくれるということです: あなたのアプリケーションは Unicode 文字列でお仕事をし、email パッケージは Unicode のエンコード/デコードを透過的に行って RFC 標準 Content Transfer Encoding との相互変換をやってのける、と。</p>
</div>
<div class="section" id="other-api-changes">
<h4>その他のAPIの変更<a class="headerlink" href="#other-api-changes" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><a class="reference internal" href="../library/email.parser.html#email.parser.BytesHeaderParser" title="email.parser.BytesHeaderParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">BytesHeaderParser</span></code></a> が <a class="reference internal" href="../library/email.parser.html#module-email.parser" title="email.parser: Parse flat text email messages to produce a message object structure."><code class="xref py py-mod docutils literal notranslate"><span class="pre">parser</span></code></a> モジュールに追加されました。これは <a class="reference internal" href="../library/email.parser.html#email.parser.HeaderParser" title="email.parser.HeaderParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">HeaderParser</span></code></a> を補足するものであり、また、 bytes API を完全にする (訳注: What's New in Python 3.2 での email の変更内容参照) ものです。</p>
<p>新しいユーティリティ関数:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../library/email.utils.html#email.utils.format_datetime" title="email.utils.format_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_datetime()</span></code></a>: <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> を与えると email ヘッダで使われる書式でフォーマットした文字列を生成します。</li>
<li><a class="reference internal" href="../library/email.utils.html#email.utils.parsedate_to_datetime" title="email.utils.parsedate_to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">parsedate_to_datetime()</span></code></a>: email ヘッダからの日付文字列を渡すと、 aware な、または naive な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> に変換します。オフセットが <code class="docutils literal notranslate"><span class="pre">-0000</span></code> の場合に naive で返します。</li>
<li><a class="reference internal" href="../library/email.utils.html#email.utils.localtime" title="email.utils.localtime"><code class="xref py py-func docutils literal notranslate"><span class="pre">localtime()</span></code></a>: 引数なしで呼び出すと、ローカル <a class="reference internal" href="../library/datetime.html#datetime.timezone" title="datetime.timezone"><code class="xref py py-class docutils literal notranslate"><span class="pre">timezone</span></code></a> を使った aware な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> として現在ローカル時間を返します。aware な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> を渡して呼び出すと、ローカル <a class="reference internal" href="../library/datetime.html#datetime.timezone" title="datetime.timezone"><code class="xref py py-class docutils literal notranslate"><span class="pre">timezone</span></code></a> を使った aware な <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> に変換します。</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="ftplib">
<h3>ftplib<a class="headerlink" href="#ftplib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../library/ftplib.html#ftplib.FTP" title="ftplib.FTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">ftplib.FTP</span></code></a> に新しいキーワード引数 <code class="docutils literal notranslate"><span class="pre">source_address</span></code> が追加されました。 <code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port)</span></code> の形で指定し、これは外に向かうソケットを作成する際に <a class="reference internal" href="../library/socket.html#socket.socket.bind" title="socket.socket.bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bind()</span></code></a> 呼び出し内でのソースアドレスとして用いられます。 (Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue8594">bpo-8594</a>.)</li>
<li><a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal notranslate"><span class="pre">FTP_TLS</span></code></a> クラスに、制御チャネルを平文に戻すための <a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS.ccc" title="ftplib.FTP_TLS.ccc"><code class="xref py py-func docutils literal notranslate"><span class="pre">ccc()</span></code></a> 関数が追加されました。これは、固定ポートで開くことなく非セキュア FTP で NAT を処理する方法を知っているファイアウォールを利用するのに有用となりえます。(Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue12139">bpo-12139</a>.)</li>
<li>新規メソッド <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.mlsd" title="ftplib.FTP.mlsd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.mlsd()</span></code></a> は機械で読めるディレクトリリスティングのフォーマットを提供し、 <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.nlst" title="ftplib.FTP.nlst"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.nlst()</span></code></a> と <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.dir" title="ftplib.FTP.dir"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.dir()</span></code></a> に取って代わるものとなりました。(Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue11072">bpo-11072</a>.)</li>
</ul>
</div>
<div class="section" id="functools">
<h3>functools<a class="headerlink" href="#functools" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/functools.html#functools.lru_cache" title="functools.lru_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.lru_cache()</span></code></a> デコレータにキーワード引数 <code class="docutils literal notranslate"><span class="pre">typed</span></code> を指定出来るようになりました (デフォルトは <code class="docutils literal notranslate"><span class="pre">False</span></code> です)。これは異なった型の等値比較のキャッシュ値を別々のキャッシュスロットに置くかどうかを決めます。(Contributed by Raymond Hettinger in <a class="reference external" href="https://bugs.python.org/issue13227">bpo-13227</a>.)</p>
</div>
<div class="section" id="gc">
<h3>gc<a class="headerlink" href="#gc" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ガーベージコレクタが回収前後に呼び出すコールバックを登録出来るようになりました。新規属性 <a class="reference internal" href="../library/gc.html#gc.callbacks" title="gc.callbacks"><code class="xref py py-data docutils literal notranslate"><span class="pre">callbacks</span></code></a> リストに登録します。</p>
</div>
<div class="section" id="hmac">
<h3>hmac<a class="headerlink" href="#hmac" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>タイミング解析によるダイジェストに対する <a class="reference external" href="https://en.wikipedia.org/wiki/Side-channel_attack">サイドチャンネル攻撃</a> からの防御のために、 <a class="reference internal" href="../library/hmac.html#hmac.compare_digest" title="hmac.compare_digest"><code class="xref py py-func docutils literal notranslate"><span class="pre">compare_digest()</span></code></a> 関数が追加されました。(Contributed by Nick Coghlan and Christian Heimes in <a class="reference external" href="https://bugs.python.org/issue15061">bpo-15061</a>.)</p>
</div>
<div class="section" id="http">
<h3>http<a class="headerlink" href="#http" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/http.server.html#http.server.BaseHTTPRequestHandler" title="http.server.BaseHTTPRequestHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.server.BaseHTTPRequestHandler</span></code></a> がヘッダをバッファするようになり、 <a class="reference internal" href="../library/http.server.html#http.server.BaseHTTPRequestHandler.end_headers" title="http.server.BaseHTTPRequestHandler.end_headers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">end_headers()</span></code></a> 呼び出し時に一度に全てをまとめて書き出すようになりました。新規のメソッド <a class="reference internal" href="../library/http.server.html#http.server.BaseHTTPRequestHandler.flush_headers" title="http.server.BaseHTTPRequestHandler.flush_headers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flush_headers()</span></code></a> は、集積したヘッダを送信する場合の管理に直接使うことが出来ます。(Contributed by Andrew Schaaf in <a class="reference external" href="https://bugs.python.org/issue3709">bpo-3709</a>.)</p>
<p><a class="reference internal" href="../library/http.server.html#module-http.server" title="http.server: HTTP server and request handlers."><code class="xref py py-class docutils literal notranslate"><span class="pre">http.server</span></code></a> が正当な <code class="docutils literal notranslate"><span class="pre">HTML</span> <span class="pre">4.01</span> <span class="pre">strict</span></code> 出力を生成するようになりました。 (Contributed by Ezio Melotti in <a class="reference external" href="https://bugs.python.org/issue13295">bpo-13295</a>.)</p>
<p><a class="reference internal" href="../library/http.client.html#http.client.HTTPResponse" title="http.client.HTTPResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.client.HTTPResponse</span></code></a> にメソッド <a class="reference internal" href="../library/http.client.html#http.client.HTTPResponse.readinto" title="http.client.HTTPResponse.readinto"><code class="xref py py-meth docutils literal notranslate"><span class="pre">readinto()</span></code></a> が追加されました。つまりこのクラスを <a class="reference internal" href="../library/io.html#io.RawIOBase" title="io.RawIOBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.RawIOBase</span></code></a> のように扱えるということです。 (Contributed by John Kuhn in <a class="reference external" href="https://bugs.python.org/issue13464">bpo-13464</a>.)</p>
</div>
<div class="section" id="html">
<h3>html<a class="headerlink" href="#html" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/html.parser.html#html.parser.HTMLParser" title="html.parser.HTMLParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">html.parser.HTMLParser</span></code></a> が壊れたマークアップをエラーなしで解析出来るようになりました。これによりコンストラクタの <em>strict</em> 引数と <code class="xref py py-exc docutils literal notranslate"><span class="pre">HTMLParseError</span></code> 例外が撤廃されました。この壊れたマークアップを解析出来る能力は数多くのバグフィックスからの結果であり、それらは Python 2.7/3.2 の最新バグフィックスリリースでも利用可能です。(Contributed by Ezio Melotti in <a class="reference external" href="https://bugs.python.org/issue15114">bpo-15114</a>, and <a class="reference external" href="https://bugs.python.org/issue14538">bpo-14538</a>, <a class="reference external" href="https://bugs.python.org/issue13993">bpo-13993</a>, <a class="reference external" href="https://bugs.python.org/issue13960">bpo-13960</a>, <a class="reference external" href="https://bugs.python.org/issue13358">bpo-13358</a>, <a class="reference external" href="https://bugs.python.org/issue1745761">bpo-1745761</a>, <a class="reference external" href="https://bugs.python.org/issue755670">bpo-755670</a>, <a class="reference external" href="https://bugs.python.org/issue13357">bpo-13357</a>, <a class="reference external" href="https://bugs.python.org/issue12629">bpo-12629</a>, <a class="reference external" href="https://bugs.python.org/issue1200313">bpo-1200313</a>, <a class="reference external" href="https://bugs.python.org/issue670664">bpo-670664</a>, <a class="reference external" href="https://bugs.python.org/issue13273">bpo-13273</a>, <a class="reference external" href="https://bugs.python.org/issue12888">bpo-12888</a>, <a class="reference external" href="https://bugs.python.org/issue7311">bpo-7311</a>.)</p>
<p><a class="reference internal" href="../library/html.entities.html#module-html.entities" title="html.entities: Definitions of HTML general entities."><code class="xref py py-mod docutils literal notranslate"><span class="pre">html.entities</span></code></a> モジュールに、HTML5 名前付き文字参照と Unicode 文字(列) とを対応付ける <a class="reference internal" href="../library/html.entities.html#html.entities.html5" title="html.entities.html5"><code class="xref py py-data docutils literal notranslate"><span class="pre">html5</span></code></a> 辞書が追加されました (例: <code class="docutils literal notranslate"><span class="pre">html5['gt;']</span> <span class="pre">==</span> <span class="pre">'&gt;'</span></code>)。この辞書は既に <a class="reference internal" href="../library/html.parser.html#html.parser.HTMLParser" title="html.parser.HTMLParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTMLParser</span></code></a> が使っています。 (Contributed by Ezio Melotti in <a class="reference external" href="https://bugs.python.org/issue11113">bpo-11113</a> and <a class="reference external" href="https://bugs.python.org/issue15156">bpo-15156</a>.)</p>
</div>
<div class="section" id="imaplib">
<h3>imaplib<a class="headerlink" href="#imaplib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4_SSL" title="imaplib.IMAP4_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code></a> コンストラクタが SSLContext パラメータを受け取るようになりました。これはセキュアなチャネルのパラメータを制御します。</p>
<p>(Contributed by Sijin Joseph in <a class="reference external" href="https://bugs.python.org/issue8808">bpo-8808</a>.)</p>
</div>
<div class="section" id="inspect">
<h3>inspect<a class="headerlink" href="#inspect" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/inspect.html#inspect.getclosurevars" title="inspect.getclosurevars"><code class="xref py py-func docutils literal notranslate"><span class="pre">getclosurevars()</span></code></a> 関数が追加されました。この関数は、指定した関数の関数本体から参照されている現在束縛されている全ての名前と、それら名前が解決された場所 (訳注: globals, builtins など) を報告します。これにより、ステートフルなクロージャに依存するコードをテストするのに、正しい内部状態を検証するのが容易になります。</p>
<p>(Contributed by Meador Inge and Nick Coghlan in <a class="reference external" href="https://bugs.python.org/issue13062">bpo-13062</a>.)</p>
<p><a class="reference internal" href="../library/inspect.html#inspect.getgeneratorlocals" title="inspect.getgeneratorlocals"><code class="xref py py-func docutils literal notranslate"><span class="pre">getgeneratorlocals()</span></code></a> 関数が追加されました。この関数は、指定したジェネレータのスタックフレーム内のローカル変数の、現在束縛されているものを報告します。これにより、ジェネレータをテストするのに、正しい内部状態を検証するのが容易になります。</p>
<p>(Contributed by Meador Inge in <a class="reference external" href="https://bugs.python.org/issue15153">bpo-15153</a>.)</p>
</div>
<div class="section" id="io">
<h3>io<a class="headerlink" href="#io" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/io.html#io.open" title="io.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> 関数に排他的作成に使用する新たな <code class="docutils literal notranslate"><span class="pre">'x'</span></code> モードが追加されました。ファイルが既に存在する場合は <a class="reference internal" href="../library/exceptions.html#FileExistsError" title="FileExistsError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">FileExistsError</span></code></a> を送出します。
C11 fopen() の 'x' モードに基づいています。</p>
<p>(Contributed by David Townshend in <a class="reference external" href="https://bugs.python.org/issue12760">bpo-12760</a>.)</p>
<p><a class="reference internal" href="../library/io.html#io.TextIOWrapper" title="io.TextIOWrapper"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code></a> のコンストラクタにオプショナルな引数 <em>write_through</em>  が追加されました。 <em>write_through</em> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、<code class="xref py py-meth docutils literal notranslate"><span class="pre">write()</span></code> の呼び出しはバッファされないことが保証されます。 <code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code> オブジェクトに書かれた全てのデータは直ちに下層のバイナリ <em>buffer</em> に処理されます。</p>
</div>
<div class="section" id="itertools">
<h3>itertools<a class="headerlink" href="#itertools" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/itertools.html#itertools.accumulate" title="itertools.accumulate"><code class="xref py py-func docutils literal notranslate"><span class="pre">accumulate()</span></code></a> がユーザ提供二項関数を渡すためのオプショナル引数 <code class="docutils literal notranslate"><span class="pre">func</span></code> を受け付けるようになりました。</p>
</div>
<div class="section" id="logging">
<h3>logging<a class="headerlink" href="#logging" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/logging.html#logging.basicConfig" title="logging.basicConfig"><code class="xref py py-func docutils literal notranslate"><span class="pre">basicConfig()</span></code></a> 関数がオプショナルな <code class="docutils literal notranslate"><span class="pre">handlers</span></code> 引数をサポートするようになりました。これはルートロガーに追加するハンドラ群の <a class="reference internal" href="../glossary.html#term-iterable"><span class="xref std std-term">イテラブル</span></a> です。</p>
<p><a class="reference internal" href="../library/logging.handlers.html#logging.handlers.SysLogHandler" title="logging.handlers.SysLogHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">SysLogHandler</span></code></a> クラスに、クラスレベル属性の <code class="xref py py-attr docutils literal notranslate"><span class="pre">append_nul</span></code> が追加されました。これは syslog レコードに <code class="docutils literal notranslate"><span class="pre">NUL</span></code> (<code class="docutils literal notranslate"><span class="pre">\000</span></code>) バイトを追加するかどうかを制御します。これはあるデーモンはこれで終端することが必要な一方でほかはメッセージの一部として NUL を通すという、デーモンによって振る舞いが異なることに対応するためです。</p>
</div>
<div class="section" id="math">
<h3>math<a class="headerlink" href="#math" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/math.html#module-math" title="math: Mathematical functions (sin() etc.)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">math</span></code></a> モジュールに新たな関数 <a class="reference internal" href="../library/math.html#math.log2" title="math.log2"><code class="xref py py-func docutils literal notranslate"><span class="pre">log2()</span></code></a> が追加されました。<em>x</em> の 2 を底とする対数を返します。</p>
<p>(Written by Mark Dickinson in <a class="reference external" href="https://bugs.python.org/issue11888">bpo-11888</a>.)</p>
</div>
<div class="section" id="mmap">
<h3>mmap<a class="headerlink" href="#mmap" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/mmap.html#mmap.mmap.read" title="mmap.mmap.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a> メソッドの他のファイルライクなオブジェクトとの互換性が増しました。引数が省略されるか <code class="docutils literal notranslate"><span class="pre">None</span></code> の場合に、ファイルの現在位置からマッピングの末尾までのバイト列を返すようになっています。(Contributed by Petri Lehtinen in <a class="reference external" href="https://bugs.python.org/issue12021">bpo-12021</a>.)</p>
</div>
<div class="section" id="multiprocessing">
<h3>multiprocessing<a class="headerlink" href="#multiprocessing" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>関数 <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.connection.wait" title="multiprocessing.connection.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">multiprocessing.connection.wait()</span></code></a> が追加されました。これは複数の (接続やソケット、パイプのような) オブジェクトをタイムアウト付きでポーリングします。(Contributed by Richard Oudkerk in <a class="reference external" href="https://bugs.python.org/issue12328">bpo-12328</a>.)</p>
<p>プロセス間で　(訳注: <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.send()</span></code> と <code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.recv()</span></code> で) <code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Connection</span></code> オブジェクトを相互に転送出来るようになりました。 (Contributed by Richard Oudkerk in <a class="reference external" href="https://bugs.python.org/issue4892">bpo-4892</a>.)</p>
<p><a class="reference internal" href="../library/multiprocessing.html#multiprocessing.Process" title="multiprocessing.Process"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Process</span></code></a> がキーワード引数 <code class="docutils literal notranslate"><span class="pre">daemon</span></code> を取るようになりました。これは親プロセスから <code class="docutils literal notranslate"><span class="pre">daemon</span></code> フラグを継承するデフォルトの振る舞いをオーバライドします (<a class="reference external" href="https://bugs.python.org/issue6064">bpo-6064</a>)。</p>
<p>属性 <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.Process.sentinel" title="multiprocessing.Process.sentinel"><code class="xref py py-data docutils literal notranslate"><span class="pre">multiprocessing.Process.sentinel</span></code></a> が追加されました。これを用いることで、ふさわしい OS プリミティブ (例えば POSIX システムでの <a class="reference internal" href="../library/select.html#module-select" title="select: Wait for I/O completion on multiple streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">select</span></code></a>) を使った一括での複数 <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.Process" title="multiprocessing.Process"><code class="xref py py-class docutils literal notranslate"><span class="pre">Process</span></code></a> オブジェクト待ちが可能です。</p>
<p><a class="reference internal" href="../library/functions.html#map" title="map"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> と <a class="reference internal" href="../library/itertools.html#itertools.starmap" title="itertools.starmap"><code class="xref py py-func docutils literal notranslate"><span class="pre">itertools.starmap()</span></code></a> との関係と同じ、既存の <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.pool.Pool.map" title="multiprocessing.pool.Pool.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">multiprocessing.pool.Pool.map()</span></code></a> と <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.pool.Pool.map_async" title="multiprocessing.pool.Pool.map_async"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map_async()</span></code></a> に対応する <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.pool.Pool.starmap" title="multiprocessing.pool.Pool.starmap"><code class="xref py py-meth docutils literal notranslate"><span class="pre">multiprocessing.pool.Pool.starmap()</span></code></a> と <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.pool.Pool.starmap_async" title="multiprocessing.pool.Pool.starmap_async"><code class="xref py py-meth docutils literal notranslate"><span class="pre">starmap_async()</span></code></a> が追加されました。 (Contributed by Hynek Schlawack in <a class="reference external" href="https://bugs.python.org/issue12708">bpo-12708</a>.)</p>
</div>
<div class="section" id="nntplib">
<h3>nntplib<a class="headerlink" href="#nntplib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/nntplib.html#nntplib.NNTP" title="nntplib.NNTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">nntplib.NNTP</span></code></a> クラスがコンテキスト管理プロトコルをサポートするようになりました。with ブロックを抜ける際に無条件に NNTP 接続をクローズします (クローズ処理で発生する <a class="reference internal" href="../library/socket.html#socket.error" title="socket.error"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.error</span></code></a> は無視されます)。:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nntplib</span> <span class="kn">import</span> <span class="n">NNTP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">NNTP</span><span class="p">(</span><span class="s1">&#39;news.gmane.org&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">n</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">n</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;gmane.comp.python.committers&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">(&#39;211 1755 1 1755 gmane.comp.python.committers&#39;, 1755, 1, 1755, &#39;gmane.comp.python.committers&#39;)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>(Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue9795">bpo-9795</a>.)</p>
</div>
<div class="section" id="os">
<h3>os<a class="headerlink" href="#os" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first"><a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールに <a class="reference internal" href="../library/os.html#os.pipe2" title="os.pipe2"><code class="xref py py-func docutils literal notranslate"><span class="pre">pipe2()</span></code></a> 関数が追加されました。これはフラグ <a class="reference internal" href="../library/os.html#os.O_CLOEXEC" title="os.O_CLOEXEC"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_CLOEXEC</span></code></a> と <a class="reference internal" href="../library/os.html#os.O_NONBLOCK" title="os.O_NONBLOCK"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_NONBLOCK</span></code></a> を (論理和指定で) セットしたパイプをアトミックに作ることが出来ます。これはマルチスレッドプログラムでの競合状態を避けるために特に有用です。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールに <a class="reference internal" href="../library/os.html#os.sendfile" title="os.sendfile"><code class="xref py py-func docutils literal notranslate"><span class="pre">sendfile()</span></code></a> 関数が追加されました。これはあるファイル (またはソケット) 記述子からのコピーを、効率的な「ゼロコピー」で行います。「ゼロコピー」という言い回しは、これは二つの記述子間でのデータのコピー全てが完全にカーネルによって行われる、という事実について指しています。データコピーにユーザ空間のバッファは使われません。 <a class="reference internal" href="../library/os.html#os.sendfile" title="os.sendfile"><code class="xref py py-func docutils literal notranslate"><span class="pre">sendfile()</span></code></a> は例えばファイルのダウンロードのような、ディスク上のファイルとネットワークソケット間での効率的なデータコピーに使うことが出来ます。</p>
<p>(Patch submitted by Ross Lagerwall and Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue10882">bpo-10882</a>.)</p>
</li>
<li><p class="first">シンボリックリンク攻撃や一時ファイル、一時ディレクトリにまつわる問題のような競合状態を避けるには、ファイル名の代わりにファイル記述子を操作することがより信頼出来ます (そして高速でもあります)。 Python 3.3 はファイル記述子で動作するよう既存関数の強化と新規関数の追加を行ないました。 (<a class="reference external" href="https://bugs.python.org/issue4761">bpo-4761</a>, <a class="reference external" href="https://bugs.python.org/issue10755">bpo-10755</a> and <a class="reference external" href="https://bugs.python.org/issue14626">bpo-14626</a>)</p>
<ul class="simple">
<li><a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールの新規関数 <a class="reference internal" href="../library/os.html#os.fwalk" title="os.fwalk"><code class="xref py py-func docutils literal notranslate"><span class="pre">fwalk()</span></code></a> は <a class="reference internal" href="../library/os.html#os.walk" title="os.walk"><code class="xref py py-func docutils literal notranslate"><span class="pre">walk()</span></code></a> と似ていますが、これは訪問するディレクトリを指すファイル記述子も yield します。これは特にシンボリックリンクの競合を避けるために有用です。</li>
<li>関数 <a class="reference internal" href="../library/os.html#os.access" title="os.access"><code class="xref py py-func docutils literal notranslate"><span class="pre">access()</span></code></a>, <a class="reference internal" href="../library/os.html#os.chflags" title="os.chflags"><code class="xref py py-func docutils literal notranslate"><span class="pre">chflags()</span></code></a>, <a class="reference internal" href="../library/os.html#os.chmod" title="os.chmod"><code class="xref py py-func docutils literal notranslate"><span class="pre">chmod()</span></code></a>, <a class="reference internal" href="../library/os.html#os.chown" title="os.chown"><code class="xref py py-func docutils literal notranslate"><span class="pre">chown()</span></code></a>, <a class="reference internal" href="../library/os.html#os.link" title="os.link"><code class="xref py py-func docutils literal notranslate"><span class="pre">link()</span></code></a>, <a class="reference internal" href="../library/os.html#os.lstat" title="os.lstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">lstat()</span></code></a>, <a class="reference internal" href="../library/os.html#os.mkdir" title="os.mkdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">mkdir()</span></code></a>, <a class="reference internal" href="../library/os.html#os.mkfifo" title="os.mkfifo"><code class="xref py py-func docutils literal notranslate"><span class="pre">mkfifo()</span></code></a>, <a class="reference internal" href="../library/os.html#os.mknod" title="os.mknod"><code class="xref py py-func docutils literal notranslate"><span class="pre">mknod()</span></code></a>, <a class="reference internal" href="../library/os.html#os.open" title="os.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a>, <a class="reference internal" href="../library/os.html#os.readlink" title="os.readlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">readlink()</span></code></a>, <a class="reference internal" href="../library/os.html#os.remove" title="os.remove"><code class="xref py py-func docutils literal notranslate"><span class="pre">remove()</span></code></a>, <a class="reference internal" href="../library/os.html#os.rename" title="os.rename"><code class="xref py py-func docutils literal notranslate"><span class="pre">rename()</span></code></a>, <a class="reference internal" href="../library/os.html#os.replace" title="os.replace"><code class="xref py py-func docutils literal notranslate"><span class="pre">replace()</span></code></a>, <a class="reference internal" href="../library/os.html#os.rmdir" title="os.rmdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">rmdir()</span></code></a>, <a class="reference internal" href="../library/os.html#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">stat()</span></code></a>, <a class="reference internal" href="../library/os.html#os.symlink" title="os.symlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlink()</span></code></a>, <a class="reference internal" href="../library/os.html#os.unlink" title="os.unlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">unlink()</span></code></a>, <a class="reference internal" href="../library/os.html#os.utime" title="os.utime"><code class="xref py py-func docutils literal notranslate"><span class="pre">utime()</span></code></a> が、新たな 2 つのオプショナルなキーワード引数のどちらか、または両方をサポートするようになりました。 <em>dir_fd</em> (<a class="reference internal" href="../library/os.html#dir-fd"><span class="std std-ref">paths relative to directory descriptors</span></a>) と <em>follow_symlinks</em> (<a class="reference internal" href="../library/os.html#follow-symlinks"><span class="std std-ref">not following symlinks</span></a>) です。プラットフォームがそれらパラメータをサポートするかどうかは <a class="reference internal" href="../library/os.html#os.supports_dir_fd" title="os.supports_dir_fd"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.supports_dir_fd</span></code></a> と <a class="reference internal" href="../library/os.html#os.supports_follow_symlinks" title="os.supports_follow_symlinks"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.supports_follow_symlinks</span></code></a> を調べることでわかります。</li>
<li>関数 <a class="reference internal" href="../library/os.html#os.chdir" title="os.chdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">chdir()</span></code></a>, <a class="reference internal" href="../library/os.html#os.chmod" title="os.chmod"><code class="xref py py-func docutils literal notranslate"><span class="pre">chmod()</span></code></a>, <a class="reference internal" href="../library/os.html#os.chown" title="os.chown"><code class="xref py py-func docutils literal notranslate"><span class="pre">chown()</span></code></a>, <a class="reference internal" href="../library/os.html#os.execve" title="os.execve"><code class="xref py py-func docutils literal notranslate"><span class="pre">execve()</span></code></a>, <a class="reference internal" href="../library/os.html#os.listdir" title="os.listdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">listdir()</span></code></a>, <a class="reference internal" href="../library/os.html#os.pathconf" title="os.pathconf"><code class="xref py py-func docutils literal notranslate"><span class="pre">pathconf()</span></code></a>, <a class="reference internal" href="../library/os.path.html#os.path.exists" title="os.path.exists"><code class="xref py py-func docutils literal notranslate"><span class="pre">exists()</span></code></a>, <a class="reference internal" href="../library/os.html#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">stat()</span></code></a>, <a class="reference internal" href="../library/os.html#os.statvfs" title="os.statvfs"><code class="xref py py-func docutils literal notranslate"><span class="pre">statvfs()</span></code></a>, <a class="reference internal" href="../library/os.html#os.utime" title="os.utime"><code class="xref py py-func docutils literal notranslate"><span class="pre">utime()</span></code></a> が、パス引数としてファイル記述子をサポートするようになりました。これをプラットフォームがサポートするかどうかは <a class="reference internal" href="../library/os.html#os.supports_fd" title="os.supports_fd"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.supports_fd</span></code></a> を調べることでわかります。</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="../library/os.html#os.access" title="os.access"><code class="xref py py-func docutils literal notranslate"><span class="pre">access()</span></code></a> がキーワード引数 <code class="docutils literal notranslate"><span class="pre">effective_ids</span></code> を受け取るようになりました。これは実 uid/gid の代わりに実効 uid/gid を使ってアクセスチェックを行うように振る舞いを変更します。これをプラットフォームがサポートするかどうかは <a class="reference internal" href="../library/os.html#os.supports_effective_ids" title="os.supports_effective_ids"><code class="xref py py-data docutils literal notranslate"><span class="pre">supports_effective_ids</span></code></a> を調べることでわかります。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールに 2 つの関数が追加されました。 <a class="reference internal" href="../library/os.html#os.getpriority" title="os.getpriority"><code class="xref py py-func docutils literal notranslate"><span class="pre">getpriority()</span></code></a> と <a class="reference internal" href="../library/os.html#os.setpriority" title="os.setpriority"><code class="xref py py-func docutils literal notranslate"><span class="pre">setpriority()</span></code></a> です。これらはプロセスのナイス値/優先度 (niceness/priority) を <a class="reference internal" href="../library/os.html#os.nice" title="os.nice"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.nice()</span></code></a> と似た方法で取得・設定しますが、現在プロセスだけのものだけではなく全てのプロセスに対して使えるよう拡張されています。</p>
<p>(Patch submitted by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue10784">bpo-10784</a>.)</p>
</li>
<li><p class="first">新規関数 <a class="reference internal" href="../library/os.html#os.replace" title="os.replace"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.replace()</span></code></a> は変更先の上書きにおいてクロスプラットフォームな方法でファイル名変更を行えます。既存の <a class="reference internal" href="../library/os.html#os.rename" title="os.rename"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.rename()</span></code></a> では、変更先が既存のファイルの場合に POSIX では上書き、Windows ではエラーとなります。(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue8828">bpo-8828</a>.)</p>
</li>
<li><p class="first">stat 系関数 (<a class="reference internal" href="../library/os.html#os.stat" title="os.stat"><code class="xref py py-func docutils literal notranslate"><span class="pre">stat()</span></code></a>, <a class="reference internal" href="../library/os.html#os.fstat" title="os.fstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">fstat()</span></code></a>, <a class="reference internal" href="../library/os.html#os.lstat" title="os.lstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">lstat()</span></code></a>) がファイルのタイムスタンプのナノ秒精度を読み取れるようになりました。これと対となる <a class="reference internal" href="../library/os.html#os.utime" title="os.utime"><code class="xref py py-func docutils literal notranslate"><span class="pre">utime()</span></code></a> もファイルのタイムスタンプをナノ秒精度で書き出せるようになりました。 (Contributed by Larry Hastings in <a class="reference external" href="https://bugs.python.org/issue14127">bpo-14127</a>.)</p>
</li>
<li><p class="first">新規関数 <a class="reference internal" href="../library/os.html#os.get_terminal_size" title="os.get_terminal_size"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.get_terminal_size()</span></code></a> はファイル記述子が接続しているターミナルウィンドウのサイズを取得します。 <a class="reference internal" href="../library/shutil.html#shutil.get_terminal_size" title="shutil.get_terminal_size"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.get_terminal_size()</span></code></a> も参照して下さい。 (Contributed by Zbigniew Jędrzejewski-Szmek in <a class="reference external" href="https://bugs.python.org/issue13609">bpo-13609</a>.)</p>
</li>
</ul>
<ul class="simple">
<li>Linux 拡張属性をサポートするための新たな関数 (<a class="reference external" href="https://bugs.python.org/issue12720">bpo-12720</a>): <a class="reference internal" href="../library/os.html#os.getxattr" title="os.getxattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">getxattr()</span></code></a>, <a class="reference internal" href="../library/os.html#os.listxattr" title="os.listxattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">listxattr()</span></code></a>, <a class="reference internal" href="../library/os.html#os.removexattr" title="os.removexattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">removexattr()</span></code></a>, <a class="reference internal" href="../library/os.html#os.setxattr" title="os.setxattr"><code class="xref py py-func docutils literal notranslate"><span class="pre">setxattr()</span></code></a>.</li>
<li>スケジューラに対する新たなインターフェイス。これら関数はプロセスに対する OS による CPU 時間割り当てを制御します。新規関数: <a class="reference internal" href="../library/os.html#os.sched_get_priority_max" title="os.sched_get_priority_max"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_get_priority_max()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_get_priority_min" title="os.sched_get_priority_min"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_get_priority_min()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_getaffinity" title="os.sched_getaffinity"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_getaffinity()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_getparam" title="os.sched_getparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_getparam()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_getscheduler" title="os.sched_getscheduler"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_getscheduler()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_rr_get_interval" title="os.sched_rr_get_interval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_rr_get_interval()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_setaffinity" title="os.sched_setaffinity"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_setaffinity()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_setparam" title="os.sched_setparam"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_setparam()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_setscheduler" title="os.sched_setscheduler"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_setscheduler()</span></code></a>, <a class="reference internal" href="../library/os.html#os.sched_yield" title="os.sched_yield"><code class="xref py py-func docutils literal notranslate"><span class="pre">sched_yield()</span></code></a>,</li>
<li>ファイルシステムを制御する新たな関数:<ul>
<li><a class="reference internal" href="../library/os.html#os.posix_fadvise" title="os.posix_fadvise"><code class="xref py py-func docutils literal notranslate"><span class="pre">posix_fadvise()</span></code></a>: データへアクセスする意思を、パターンを指定して宣言します。これによりカーネルが最適化を行えるようになります。</li>
<li><a class="reference internal" href="../library/os.html#os.posix_fallocate" title="os.posix_fallocate"><code class="xref py py-func docutils literal notranslate"><span class="pre">posix_fallocate()</span></code></a>: ファイルを割り当てるに十分なディスクスペースを確保します。</li>
<li><a class="reference internal" href="../library/os.html#os.sync" title="os.sync"><code class="xref py py-func docutils literal notranslate"><span class="pre">sync()</span></code></a>: ディスクへの全ての書き込みを強制します。</li>
</ul>
</li>
<li>追加された新たな POSIX 関数:<ul>
<li><a class="reference internal" href="../library/os.html#os.lockf" title="os.lockf"><code class="xref py py-func docutils literal notranslate"><span class="pre">lockf()</span></code></a>: オープンされたファイル記述子に対して、POSIX ロックの適用、テスト、解除を行います。</li>
<li><a class="reference internal" href="../library/os.html#os.pread" title="os.pread"><code class="xref py py-func docutils literal notranslate"><span class="pre">pread()</span></code></a>: ファイル記述子の指定オフセット位置から読み込みます。ファイルオフセットは変化しません。</li>
<li><a class="reference internal" href="../library/os.html#os.pwrite" title="os.pwrite"><code class="xref py py-func docutils literal notranslate"><span class="pre">pwrite()</span></code></a>: ファイル記述子に対し、指定オフセット位置から書き出します。ファイルオフセットは変化しません。</li>
<li><a class="reference internal" href="../library/os.html#os.readv" title="os.readv"><code class="xref py py-func docutils literal notranslate"><span class="pre">readv()</span></code></a>: ファイル記述子からデータを読みこんで複数の書き込み可能なバッファに書き込みます。</li>
<li><a class="reference internal" href="../library/os.html#os.truncate" title="os.truncate"><code class="xref py py-func docutils literal notranslate"><span class="pre">truncate()</span></code></a>: <em>path</em> に対応するファイルを、サイズが最大で <em>length</em> バイトになるよう切り詰めます。</li>
<li><a class="reference internal" href="../library/os.html#os.waitid" title="os.waitid"><code class="xref py py-func docutils literal notranslate"><span class="pre">waitid()</span></code></a>: 一つ以上の子プロセスの完了を待ちます。</li>
<li><a class="reference internal" href="../library/os.html#os.writev" title="os.writev"><code class="xref py py-func docutils literal notranslate"><span class="pre">writev()</span></code></a>: <em>buffers</em> の内容をファイル記述子へ書き出します。 <em>buffer</em> は任意のバッファのシーケンスです。</li>
<li><a class="reference internal" href="../library/os.html#os.getgrouplist" title="os.getgrouplist"><code class="xref py py-func docutils literal notranslate"><span class="pre">getgrouplist()</span></code></a> (<a class="reference external" href="https://bugs.python.org/issue9344">bpo-9344</a>): 指定したユーザが属するグループ ID のリストを返します。</li>
</ul>
</li>
<li><a class="reference internal" href="../library/os.html#os.times" title="os.times"><code class="xref py py-func docutils literal notranslate"><span class="pre">times()</span></code></a> および <a class="reference internal" href="../library/os.html#os.uname" title="os.uname"><code class="xref py py-func docutils literal notranslate"><span class="pre">uname()</span></code></a>: 戻り値の型がタプルから属性名のついたタプルライクオブジェクトに変更されました。</li>
<li>いくつかのプラットフォームにおいて、 <a class="reference internal" href="../library/os.html#os.lseek" title="os.lseek"><code class="xref py py-func docutils literal notranslate"><span class="pre">lseek()</span></code></a> 関数で使う追加の定数をサポートするようになりました。 <code class="docutils literal notranslate"><span class="pre">os.SEEK_HOLE</span></code> や <code class="docutils literal notranslate"><span class="pre">os.SEEK_DATA</span></code> などです。</li>
<li>新規の定数 <a class="reference internal" href="../library/os.html#os.RTLD_LAZY" title="os.RTLD_LAZY"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_LAZY</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_NOW" title="os.RTLD_NOW"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_NOW</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_GLOBAL" title="os.RTLD_GLOBAL"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_GLOBAL</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_LOCAL" title="os.RTLD_LOCAL"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_LOCAL</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_NODELETE" title="os.RTLD_NODELETE"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_NODELETE</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_NOLOAD" title="os.RTLD_NOLOAD"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_NOLOAD</span></code></a>, <a class="reference internal" href="../library/os.html#os.RTLD_DEEPBIND" title="os.RTLD_DEEPBIND"><code class="xref py py-data docutils literal notranslate"><span class="pre">RTLD_DEEPBIND</span></code></a> が、それをサポートしているプラットフォームで利用可能になりました。これらは <a class="reference internal" href="../library/sys.html#sys.setdlopenflags" title="sys.setdlopenflags"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setdlopenflags()</span></code></a> 関数で使います。これら定数は <a class="reference internal" href="../library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> モジュールと <code class="xref py py-mod docutils literal notranslate"><span class="pre">DLFCN</span></code> で定義されている同じような定数を置き換えるものです。(Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue13226">bpo-13226</a>.)</li>
<li>クロスプラットフォームのサポートを簡単にするために、非 Windows 環境でも <a class="reference internal" href="../library/os.html#os.symlink" title="os.symlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.symlink()</span></code></a> がキーワード引数 <code class="docutils literal notranslate"><span class="pre">target_is_directory</span></code> を受け付けるようになりました (単に無視します)。</li>
</ul>
</div>
<div class="section" id="pdb">
<h3>pdb<a class="headerlink" href="#pdb" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><kbd class="kbd docutils literal notranslate">Tab</kbd> キーでの補完がコマンド名だけでなくその引数に対しても使えるようになりました。例えば <code class="docutils literal notranslate"><span class="pre">break</span></code> コマンドに対しては、関数、ファイル名が補完されます。</p>
<p>(Contributed by Georg Brandl in <a class="reference external" href="https://bugs.python.org/issue14210">bpo-14210</a>)</p>
</div>
<div class="section" id="pickle">
<h3>pickle<a class="headerlink" href="#pickle" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/pickle.html#pickle.Pickler" title="pickle.Pickler"><code class="xref py py-class docutils literal notranslate"><span class="pre">pickle.Pickler</span></code></a> オブジェクトに pickler ごとのリダクション関数を設定する、オプショナルな <a class="reference internal" href="../library/pickle.html#pickle.Pickler.dispatch_table" title="pickle.Pickler.dispatch_table"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dispatch_table</span></code></a> 属性が追加されました。</p>
<p>(Contributed by Richard Oudkerk in <a class="reference external" href="https://bugs.python.org/issue14166">bpo-14166</a>.)</p>
</div>
<div class="section" id="pydoc">
<h3>pydoc<a class="headerlink" href="#pydoc" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Tk GUI と <code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code> 関数は <a class="reference internal" href="../library/pydoc.html#module-pydoc" title="pydoc: Documentation generator and online help system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pydoc</span></code></a> モジュールから削除されました。 <code class="docutils literal notranslate"><span class="pre">pydoc</span> <span class="pre">-g</span></code> と <code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code> は Python 3.2 から既に非推奨となっていました。</p>
</div>
<div class="section" id="re">
<h3>re<a class="headerlink" href="#re" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 正規表現が <code class="docutils literal notranslate"><span class="pre">\u</span></code> および <code class="docutils literal notranslate"><span class="pre">\U</span></code> エスケープをサポートしました。</p>
<p>(Contributed by Serhiy Storchaka in <a class="reference external" href="https://bugs.python.org/issue3665">bpo-3665</a>.)</p>
</div>
<div class="section" id="sched">
<h3>sched<a class="headerlink" href="#sched" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../library/sched.html#sched.scheduler.run" title="sched.scheduler.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> が <em>blocking</em> パラメータを取るようになりました。
これを偽にセットすると、このメソッドは既に実行予定時間になっているイベント (もしあれば) を実行してすぐに戻ります。
これは <a class="reference internal" href="../library/sched.html#sched.scheduler" title="sched.scheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">scheduler</span></code></a> を非ブロッキングなアプリケーションで使いたい場合に有用です。
(Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue13449">bpo-13449</a>.)
(---訳注: 原文の表現がわかりにくいですが、これは <code class="docutils literal notranslate"><span class="pre">blocking=False</span></code> 時はスケジュールされた時間になっているタスクがあれば通常は <em>delayfunc</em> を呼び出すところをそうせずに、一番早く次の予定時間に達するタスクの予定時間までの時間差を返します。---)</li>
<li><a class="reference internal" href="../library/sched.html#sched.scheduler" title="sched.scheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">scheduler</span></code></a> クラスをマルチスレッド環境で安全に使えるようになりました。 (Contributed by Josiah Carlson and Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue8684">bpo-8684</a>.)</li>
<li><a class="reference internal" href="../library/sched.html#sched.scheduler" title="sched.scheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">scheduler</span></code></a> クラスのコンストラクタでのパラメータ <em>timefunc</em> と <em>delayfunc</em> が省略可能になりました。それぞれデフォルトで順に <a class="reference internal" href="../library/time.html#time.time" title="time.time"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.time()</span></code></a>, <a class="reference internal" href="../library/time.html#time.sleep" title="time.sleep"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.sleep()</span></code></a> が使われます。 (Contributed by Chris Clark in <a class="reference external" href="https://bugs.python.org/issue13245">bpo-13245</a>.)</li>
<li><a class="reference internal" href="../library/sched.html#sched.scheduler.enter" title="sched.scheduler.enter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enter()</span></code></a> と <a class="reference internal" href="../library/sched.html#sched.scheduler.enterabs" title="sched.scheduler.enterabs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enterabs()</span></code></a> の <em>argument</em> パラメータが省略可能になりました。  (Contributed by Chris Clark in <a class="reference external" href="https://bugs.python.org/issue13245">bpo-13245</a>.)</li>
<li><a class="reference internal" href="../library/sched.html#sched.scheduler.enter" title="sched.scheduler.enter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enter()</span></code></a> と <a class="reference internal" href="../library/sched.html#sched.scheduler.enterabs" title="sched.scheduler.enterabs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enterabs()</span></code></a> が <em>kwargs</em> パラメータを受け付けるようになりました。  (Contributed by Chris Clark in <a class="reference external" href="https://bugs.python.org/issue13245">bpo-13245</a>.)</li>
</ul>
</div>
<div class="section" id="select">
<h3>select<a class="headerlink" href="#select" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Solaris とその派生プラットフォームにおいて、新規クラス <a class="reference internal" href="../library/select.html#select.devpoll" title="select.devpoll"><code class="xref py py-class docutils literal notranslate"><span class="pre">select.devpoll</span></code></a> が追加されました。これはハイパフォーマンスな非同期ソケットを <code class="file docutils literal notranslate"><span class="pre">/dev/poll</span></code> 経由で提供するものです。 (Contributed by Jesús Cea Avión in <a class="reference external" href="https://bugs.python.org/issue6397">bpo-6397</a>.)</p>
</div>
<div class="section" id="shlex">
<h3>shlex<a class="headerlink" href="#shlex" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>これまで <a class="reference internal" href="../library/pipes.html#module-pipes" title="pipes: A Python interface to Unix shell pipelines. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pipes</span></code></a> モジュールにいて文書化もされてこなかったヘルパー関数 <code class="docutils literal notranslate"><span class="pre">quote</span></code> が、 <a class="reference internal" href="../library/shlex.html#module-shlex" title="shlex: Simple lexical analysis for Unix shell-like languages."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shlex</span></code></a> に移動の上で文書化されました。この <a class="reference internal" href="../library/shlex.html#shlex.quote" title="shlex.quote"><code class="xref py py-func docutils literal notranslate"><span class="pre">quote()</span></code></a> は、文字列内でシェルによって何か特別な意味を与えられている全ての文字を適切にエスケープします。</p>
</div>
<div class="section" id="shutil">
<h3>shutil<a class="headerlink" href="#shutil" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>新たな関数:<ul>
<li><a class="reference internal" href="../library/shutil.html#shutil.disk_usage" title="shutil.disk_usage"><code class="xref py py-func docutils literal notranslate"><span class="pre">disk_usage()</span></code></a>: ディスクの利用状況について、トータル、使用中、空きの容量を返します。 (Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue12442">bpo-12442</a>.)</li>
<li><a class="reference internal" href="../library/shutil.html#shutil.chown" title="shutil.chown"><code class="xref py py-func docutils literal notranslate"><span class="pre">chown()</span></code></a>: 指定された path のユーザ、グループの両方あるいは一方を変更します。ユーザ、グループは名前もしくは数値での ID (uid, gid) で指定します。(Contributed by Sandro Tosi in <a class="reference external" href="https://bugs.python.org/issue12191">bpo-12191</a>.)</li>
<li><a class="reference internal" href="../library/shutil.html#shutil.get_terminal_size" title="shutil.get_terminal_size"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.get_terminal_size()</span></code></a>: インタプリタが接続しているターミナルウィンドウのサイズを取得します。 (Contributed by Zbigniew Jędrzejewski-Szmek in <a class="reference external" href="https://bugs.python.org/issue13609">bpo-13609</a>.)</li>
</ul>
</li>
<li><a class="reference internal" href="../library/shutil.html#shutil.copy2" title="shutil.copy2"><code class="xref py py-func docutils literal notranslate"><span class="pre">copy2()</span></code></a> と <a class="reference internal" href="../library/shutil.html#shutil.copystat" title="shutil.copystat"><code class="xref py py-func docutils literal notranslate"><span class="pre">copystat()</span></code></a> がファイルのタイムスタンプを、それをサポートするプラットフォームではナノ秒精度も維持するようになりました。また、Linux ではこれらは「拡張属性 (extended attributes)」もコピーするようになりました。 (Contributed by Larry Hastings in <a class="reference external" href="https://bugs.python.org/issue14127">bpo-14127</a> and <a class="reference external" href="https://bugs.python.org/issue15238">bpo-15238</a>.)</li>
<li>いくつかの関数がオプショナルな <code class="docutils literal notranslate"><span class="pre">symlinks</span></code> 引数を取るようになりました。これが真の場合、シンボリックリンクの指す先を解決するのではなくシンボリックそのものに対しての操作をします (そうすることが必要であればシンボリックリンク作成もします)。(Contributed by Hynek Schlawack in <a class="reference external" href="https://bugs.python.org/issue12715">bpo-12715</a>.)</li>
<li>ファイルシステムをまたがったファイルのコピーの際に、 <a class="reference internal" href="../library/shutil.html#shutil.move" title="shutil.move"><code class="xref py py-func docutils literal notranslate"><span class="pre">move()</span></code></a> がシンボリックリンクを POSIX の <code class="docutils literal notranslate"><span class="pre">move</span></code> コマンドが行うのと同じやり方で扱うようになりました。つまりターゲットのファイルの中身をコピーするのではなくシンボリックリンクを再作成します。(Contributed by Jonathan Niehof in <a class="reference external" href="https://bugs.python.org/issue9993">bpo-9993</a>.) また、 <a class="reference internal" href="../library/shutil.html#shutil.move" title="shutil.move"><code class="xref py py-func docutils literal notranslate"><span class="pre">move()</span></code></a> は <code class="docutils literal notranslate"><span class="pre">dst</span></code> 引数を戻り値として返すようになりました。</li>
<li><a class="reference internal" href="../library/os.html#os.open" title="os.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.open()</span></code></a> と <a class="reference internal" href="../library/os.html#os.unlink" title="os.unlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.unlink()</span></code></a> が新パラメータ <code class="docutils literal notranslate"><span class="pre">dir_fd</span></code> をサポートしているプラットフォームでは、 <a class="reference internal" href="../library/shutil.html#shutil.rmtree" title="shutil.rmtree"><code class="xref py py-func docutils literal notranslate"><span class="pre">rmtree()</span></code></a> は今では シンボリックリンク攻撃に耐性を持ちます。 (Contributed by Martin von Löwis and Hynek Schlawack in <a class="reference external" href="https://bugs.python.org/issue4489">bpo-4489</a>.)</li>
</ul>
</div>
<div class="section" id="signal">
<h3>signal<a class="headerlink" href="#signal" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../library/signal.html#module-signal" title="signal: Set handlers for asynchronous events."><code class="xref py py-mod docutils literal notranslate"><span class="pre">signal</span></code></a> モジュールに新規関数が追加されました:<ul>
<li><a class="reference internal" href="../library/signal.html#signal.pthread_sigmask" title="signal.pthread_sigmask"><code class="xref py py-func docutils literal notranslate"><span class="pre">pthread_sigmask()</span></code></a>: これを呼び出すスレッドにセットされているシグナルマスクを取り出したり変更したりします (Contributed by Jean-Paul Calderone in <a class="reference external" href="https://bugs.python.org/issue8407">bpo-8407</a>);</li>
<li><a class="reference internal" href="../library/signal.html#signal.pthread_kill" title="signal.pthread_kill"><code class="xref py py-func docutils literal notranslate"><span class="pre">pthread_kill()</span></code></a>: スレッドにシグナルを送ります;</li>
<li><a class="reference internal" href="../library/signal.html#signal.sigpending" title="signal.sigpending"><code class="xref py py-func docutils literal notranslate"><span class="pre">sigpending()</span></code></a>: 保留中のシグナルを調べます;</li>
<li><a class="reference internal" href="../library/signal.html#signal.sigwait" title="signal.sigwait"><code class="xref py py-func docutils literal notranslate"><span class="pre">sigwait()</span></code></a>: シグナルを待ちます;</li>
<li><a class="reference internal" href="../library/signal.html#signal.sigwaitinfo" title="signal.sigwaitinfo"><code class="xref py py-func docutils literal notranslate"><span class="pre">sigwaitinfo()</span></code></a>: シグナルを待ちますが、それについての詳細情報を返します;</li>
<li><a class="reference internal" href="../library/signal.html#signal.sigtimedwait" title="signal.sigtimedwait"><code class="xref py py-func docutils literal notranslate"><span class="pre">sigtimedwait()</span></code></a>: <a class="reference internal" href="../library/signal.html#signal.sigwaitinfo" title="signal.sigwaitinfo"><code class="xref py py-func docutils literal notranslate"><span class="pre">sigwaitinfo()</span></code></a> と似ていますがタイムアウト指定できます。</li>
</ul>
</li>
<li>シグナルハンドラは wakeup ファイル記述子に以前は <code class="docutils literal notranslate"><span class="pre">\0</span></code> を書き込んでいましたが、シグナル番号を 1 バイト整数として書き込むようにしました。これにより、一つ以上のシグナルを待った上でどのシグナルが発生したのかあとから調べるといったことが出来ます。</li>
<li><a class="reference internal" href="../library/signal.html#signal.signal" title="signal.signal"><code class="xref py py-func docutils literal notranslate"><span class="pre">signal.signal()</span></code></a> と <a class="reference internal" href="../library/signal.html#signal.siginterrupt" title="signal.siginterrupt"><code class="xref py py-func docutils literal notranslate"><span class="pre">signal.siginterrupt()</span></code></a> は RuntimeError ではなく <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> を投げるようになりました: OSError は errno 属性を持っています。</li>
</ul>
</div>
<div class="section" id="smtpd">
<h3>smtpd<a class="headerlink" href="#smtpd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/smtpd.html#module-smtpd" title="smtpd: A SMTP server implementation in Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">smtpd</span></code></a> モジュールが <span class="target" id="index-91"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5321.html"><strong>RFC 5321</strong></a> (extended SMTP) と <span class="target" id="index-92"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc1870.html"><strong>RFC 1870</strong></a> (size extension) をサポートするようになりました。標準により、これら拡張を有効にするための必要十分条件はクライアントがセッションを <code class="docutils literal notranslate"><span class="pre">EHLO</span></code> コマンドで開始することです。</p>
<p>(Initial <code class="docutils literal notranslate"><span class="pre">ELHO</span></code> support by Alberto Trevino.  Size extension by Juhana
Jauhiainen.  Substantial additional work on the patch contributed by Michele
Orrù and Dan Boswell.  <a class="reference external" href="https://bugs.python.org/issue8739">bpo-8739</a>)</p>
</div>
<div class="section" id="smtplib">
<h3>smtplib<a class="headerlink" href="#smtplib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>クラス <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP" title="smtplib.SMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP</span></code></a>, <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP_SSL" title="smtplib.SMTP_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP_SSL</span></code></a>, <a class="reference internal" href="../library/smtplib.html#smtplib.LMTP" title="smtplib.LMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">LMTP</span></code></a> に新しいキーワード引数 <code class="docutils literal notranslate"><span class="pre">source_address</span></code> が追加されました。 <code class="docutils literal notranslate"><span class="pre">(host,</span> <span class="pre">port)</span></code> の形で指定し、これは外に向かうソケットを作成する際に <a class="reference internal" href="../library/socket.html#socket.socket.bind" title="socket.socket.bind"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bind()</span></code></a> 呼び出し内でのソースアドレスとして用いられます。(Contributed by Paulo Scardine in <a class="reference external" href="https://bugs.python.org/issue11281">bpo-11281</a>.)</p>
<p><a class="reference internal" href="../library/smtplib.html#smtplib.SMTP" title="smtplib.SMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP</span></code></a> がコンテキスト管理プロトコルをサポートするようになったので <code class="docutils literal notranslate"><span class="pre">SMTP</span></code> のインスタンスを <code class="docutils literal notranslate"><span class="pre">with</span></code> 文で使えます。  (Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue11289">bpo-11289</a>.)</p>
<p><a class="reference internal" href="../library/smtplib.html#smtplib.SMTP_SSL" title="smtplib.SMTP_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP_SSL</span></code></a> コンストラクタと <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP.starttls" title="smtplib.SMTP.starttls"><code class="xref py py-meth docutils literal notranslate"><span class="pre">starttls()</span></code></a> メソッドが SSLContext パラメータを受け取るようになりました。これはセキュアなチャネルのパラメータを制御します。 (Contributed by Kasun Herath in <a class="reference external" href="https://bugs.python.org/issue8809">bpo-8809</a>.)</p>
</div>
<div class="section" id="socket">
<h3>socket<a class="headerlink" href="#socket" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket</span></code></a> クラスが、前提となるプラットフォームがサポートしていれば従属的なデータを処理する追加のメソッドを公開しました:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/socket.html#socket.socket.sendmsg" title="socket.socket.sendmsg"><code class="xref py py-func docutils literal notranslate"><span class="pre">sendmsg()</span></code></a></li>
<li><a class="reference internal" href="../library/socket.html#socket.socket.recvmsg" title="socket.socket.recvmsg"><code class="xref py py-func docutils literal notranslate"><span class="pre">recvmsg()</span></code></a></li>
<li><a class="reference internal" href="../library/socket.html#socket.socket.recvmsg_into" title="socket.socket.recvmsg_into"><code class="xref py py-func docutils literal notranslate"><span class="pre">recvmsg_into()</span></code></a></li>
</ul>
<p>(Contributed by David Watson in <a class="reference external" href="https://bugs.python.org/issue6560">bpo-6560</a>, based on an earlier patch by
Heiko Wundram)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket</span></code></a> クラスが Linux で (<a class="reference external" href="https://lwn.net/Articles/253425">https://lwn.net/Articles/253425</a>) PF_CAN プロトコルファミリ (<a class="reference external" href="https://en.wikipedia.org/wiki/Socketcan">https://en.wikipedia.org/wiki/Socketcan</a>) をサポートしました。</p>
<p>(Contributed by Matthias Fuchs, updated by Tiago Gonçalves in <a class="reference external" href="https://bugs.python.org/issue10141">bpo-10141</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket</span></code></a> クラスが PF_RDS プロトコルファミリ (<a class="reference external" href="https://en.wikipedia.org/wiki/Reliable_Datagram_Sockets">https://en.wikipedia.org/wiki/Reliable_Datagram_Sockets</a> および <a class="reference external" href="https://oss.oracle.com/projects/rds/">https://oss.oracle.com/projects/rds/</a>) をサポートするようになりました。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket</span></code></a> クラスが OS X で <code class="docutils literal notranslate"><span class="pre">PF_SYSTEM</span></code> プロトコルファミリをサポートするようになりました。 (Contributed by Michael Goderbauer in <a class="reference external" href="https://bugs.python.org/issue13777">bpo-13777</a>.)</p>
</li>
<li><p class="first">Unix システムにおいて新規関数 <a class="reference internal" href="../library/socket.html#socket.sethostname" title="socket.sethostname"><code class="xref py py-func docutils literal notranslate"><span class="pre">sethostname()</span></code></a> により、呼び出しプロセスが十分な特権を持っていればホスト名をセット出来ます。(Contributed by Ross Lagerwall in <a class="reference external" href="https://bugs.python.org/issue10866">bpo-10866</a>.)</p>
</li>
</ul>
</div>
<div class="section" id="socketserver">
<h3>socketserver<a class="headerlink" href="#socketserver" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/socketserver.html#socketserver.BaseServer" title="socketserver.BaseServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseServer</span></code></a> がオーバライド可能な <a class="reference internal" href="../library/socketserver.html#socketserver.BaseServer.service_actions" title="socketserver.BaseServer.service_actions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">service_actions()</span></code></a> メソッドを持つようになり、これは <a class="reference internal" href="../library/socketserver.html#socketserver.BaseServer.serve_forever" title="socketserver.BaseServer.serve_forever"><code class="xref py py-meth docutils literal notranslate"><span class="pre">serve_forever()</span></code></a> によりサービスループ内で呼び出されます。 <a class="reference internal" href="../library/socketserver.html#socketserver.ForkingMixIn" title="socketserver.ForkingMixIn"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForkingMixIn</span></code></a> がこれをゾンビ化した子プロセスのクリーンアップに使っています。 (Contributed by Justin Warkentin in <a class="reference external" href="https://bugs.python.org/issue11109">bpo-11109</a>.)</p>
</div>
<div class="section" id="sqlite3">
<h3>sqlite3<a class="headerlink" href="#sqlite3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection" title="sqlite3.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Connection</span></code></a> の新規のメソッド <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.set_trace_callback" title="sqlite3.Connection.set_trace_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_trace_callback()</span></code></a> を使うと sqlite3 により処理されるすべての sql コマンドの足跡 (トレース) をキャプチャ出来ます。(Contributed by Torsten Landschoff in <a class="reference external" href="https://bugs.python.org/issue11688">bpo-11688</a>.)</p>
</div>
<div class="section" id="ssl">
<h3>ssl<a class="headerlink" href="#ssl" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> モジュールに新たに 2 つの乱数生成関数が追加されました:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/ssl.html#ssl.RAND_bytes" title="ssl.RAND_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_bytes()</span></code></a>: 暗号学的に強固な擬似乱数バイト列を生成します。</li>
<li><a class="reference internal" href="../library/ssl.html#ssl.RAND_pseudo_bytes" title="ssl.RAND_pseudo_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_pseudo_bytes()</span></code></a>: 擬似乱数バイト列を生成します。</li>
</ul>
<p>(Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue12049">bpo-12049</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> モジュールがより粒度の細かい例外階層を公開するようになり、これにより様々な種類のエラーを調べることが容易になります。 (Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue11183">bpo-11183</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#ssl.SSLContext.load_cert_chain" title="ssl.SSLContext.load_cert_chain"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_cert_chain()</span></code></a> が <em>password</em> 引数を受け付けるようになりました。これは秘密鍵が暗号化されている場合に使われます。 (Contributed by Adam Simpkins in <a class="reference external" href="https://bugs.python.org/issue12803">bpo-12803</a>.)</p>
</li>
<li><p class="first">ディフィー・ヘルマン鍵共有の、通常のものと楕円曲線ベースのもの両方が <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.load_dh_params" title="ssl.SSLContext.load_dh_params"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_dh_params()</span></code></a> メソッドと <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.set_ecdh_curve" title="ssl.SSLContext.set_ecdh_curve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_ecdh_curve()</span></code></a> メソッドを通じてサポートされるようになりました。(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue13626">bpo-13626</a> and <a class="reference external" href="https://bugs.python.org/issue13627">bpo-13627</a>.)</p>
</li>
<li><p class="first">SSL ソケットに新規メソッド <a class="reference internal" href="../library/ssl.html#ssl.SSLSocket.get_channel_binding" title="ssl.SSLSocket.get_channel_binding"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_channel_binding()</span></code></a> が追加されました。これは SCRAM-SHA-1-PLUS (訳注: <span class="target" id="index-93"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc5802.html"><strong>RFC 5802</strong></a> など参照) のようなある種の認証メカニズムの実装で拡張されることを想定したものです。(Contributed by Jacek Konieczny in <a class="reference external" href="https://bugs.python.org/issue12551">bpo-12551</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#ssl.SSLSocket.compression" title="ssl.SSLSocket.compression"><code class="xref py py-meth docutils literal notranslate"><span class="pre">compression()</span></code></a> メソッドが追加されたので、SSL ソケットで使われている SSL 圧縮アルゴリズムを問い合わせることが出来ます。また、新規の属性 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_COMPRESSION" title="ssl.OP_NO_COMPRESSION"><code class="xref py py-attr docutils literal notranslate"><span class="pre">OP_NO_COMPRESSION</span></code></a> で圧縮を無効に出来ます。(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue13634">bpo-13634</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#ssl.SSLContext.set_npn_protocols" title="ssl.SSLContext.set_npn_protocols"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.set_npn_protocols()</span></code></a> による Next Protocol Negotiation 拡張のサポートが追加されました。
(Contributed by Colin Marc in <a class="reference external" href="https://bugs.python.org/issue14204">bpo-14204</a>.)</p>
</li>
<li><p class="first">属性 <a class="reference internal" href="../library/ssl.html#ssl.SSLError.library" title="ssl.SSLError.library"><code class="xref py py-attr docutils literal notranslate"><span class="pre">library</span></code></a> と <a class="reference internal" href="../library/ssl.html#ssl.SSLError.reason" title="ssl.SSLError.reason"><code class="xref py py-attr docutils literal notranslate"><span class="pre">reason</span></code></a> が追加されたので、SSL のエラーは以前よりもっと簡単に調べることが出来るようになりました。(Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue14837">bpo-14837</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#ssl.get_server_certificate" title="ssl.get_server_certificate"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_server_certificate()</span></code></a> 関数が IPv6 をサポートするようになりました。 (Contributed by Charles-François Natali in <a class="reference external" href="https://bugs.python.org/issue11811">bpo-11811</a>.)</p>
</li>
<li><p class="first">新規属性 <a class="reference internal" href="../library/ssl.html#ssl.OP_CIPHER_SERVER_PREFERENCE" title="ssl.OP_CIPHER_SERVER_PREFERENCE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">OP_CIPHER_SERVER_PREFERENCE</span></code></a> は SSLv3 サーバソケットに対し、暗号の優先順位をクライアントのものではなくサーバのものを使うようにします。 (<a class="reference external" href="https://bugs.python.org/issue13635">bpo-13635</a>)</p>
</li>
</ul>
</div>
<div class="section" id="stat">
<h3>stat<a class="headerlink" href="#stat" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ドキュメントされていなかった <code class="docutils literal notranslate"><span class="pre">tarfile.filemode</span></code> 関数が <a class="reference internal" href="../library/stat.html#stat.filemode" title="stat.filemode"><code class="xref py py-func docutils literal notranslate"><span class="pre">stat.filemode()</span></code></a> に移動されました。これはファイルモードを '-rwxrwxrwx' 形式の文字列に変換するのに使えます。</p>
<p>(Contributed by Giampaolo Rodolà in <a class="reference external" href="https://bugs.python.org/issue14807">bpo-14807</a>.)</p>
</div>
<div class="section" id="struct">
<h3>struct<a class="headerlink" href="#struct" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/struct.html#module-struct" title="struct: Interpret bytes as packed binary data."><code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code></a> モジュールが新たに <code class="docutils literal notranslate"><span class="pre">ssize_t</span></code> (コード <code class="docutils literal notranslate"><span class="pre">n</span></code>)、 <code class="docutils literal notranslate"><span class="pre">size_t</span></code> (コード <code class="docutils literal notranslate"><span class="pre">N</span></code>) をサポートするようになりました。 (Contributed by Antoine Pitrou in <a class="reference external" href="https://bugs.python.org/issue3163">bpo-3163</a>.)</p>
</div>
<div class="section" id="subprocess">
<h3>subprocess<a class="headerlink" href="#subprocess" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>POSIX プラットフォームにおいて、コマンド文字列として bytes オブジェクトを渡せるようになりました。 (Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue8513">bpo-8513</a>.)</p>
<p>新規定数 <a class="reference internal" href="../library/subprocess.html#subprocess.DEVNULL" title="subprocess.DEVNULL"><code class="xref py py-data docutils literal notranslate"><span class="pre">DEVNULL</span></code></a> は、プラットフォームに依存しない方法で出力を抑制するのに使えます。 (Contributed by Ross Lagerwall in <a class="reference external" href="https://bugs.python.org/issue5870">bpo-5870</a>.)</p>
</div>
<div class="section" id="sys">
<h3>sys<a class="headerlink" href="#sys" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sys</span></code></a> モジュールに、スレッドの実装に関する情報が格納された <span class="xref std std-term">名前付きタプル</span> を保持する <a class="reference internal" href="../library/sys.html#sys.thread_info" title="sys.thread_info"><code class="xref py py-data docutils literal notranslate"><span class="pre">thread_info</span></code></a> が追加されました。 (<a class="reference external" href="https://bugs.python.org/issue11223">bpo-11223</a>)</p>
</div>
<div class="section" id="tarfile">
<h3>tarfile<a class="headerlink" href="#tarfile" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tarfile</span></code></a> が <a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> モジュールにより <code class="docutils literal notranslate"><span class="pre">lzma</span></code> エンコーディングをサポートするようになりました (Contributed by Lars Gustäbel in <a class="reference external" href="https://bugs.python.org/issue5689">bpo-5689</a>.)。</p>
</div>
<div class="section" id="tempfile">
<h3>tempfile<a class="headerlink" href="#tempfile" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/tempfile.html#tempfile.SpooledTemporaryFile" title="tempfile.SpooledTemporaryFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">tempfile.SpooledTemporaryFile</span></code></a> の <code class="xref py py-meth docutils literal notranslate"><span class="pre">truncate()</span></code> メソッドが <code class="docutils literal notranslate"><span class="pre">size</span></code> 引数を受け取るようになりました。
(Contributed by Ryan Kelly in <a class="reference external" href="https://bugs.python.org/issue9957">bpo-9957</a>.)</p>
</div>
<div class="section" id="textwrap">
<h3>textwrap<a class="headerlink" href="#textwrap" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/textwrap.html#module-textwrap" title="textwrap: Text wrapping and filling"><code class="xref py py-mod docutils literal notranslate"><span class="pre">textwrap</span></code></a> モジュールに <a class="reference internal" href="../library/textwrap.html#textwrap.indent" title="textwrap.indent"><code class="xref py py-func docutils literal notranslate"><span class="pre">indent()</span></code></a> が追加されました。これはテキストのブロック内の選択行に共通のプレフィクスを追加する簡単な方法になります。(<a class="reference external" href="https://bugs.python.org/issue13857">bpo-13857</a>)</p>
</div>
<div class="section" id="threading">
<h3>threading<a class="headerlink" href="#threading" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>いずれもかつてインスタンスを返すファクトリ関数であった <a class="reference internal" href="../library/threading.html#threading.Condition" title="threading.Condition"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Condition</span></code></a>, <a class="reference internal" href="../library/threading.html#threading.Semaphore" title="threading.Semaphore"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Semaphore</span></code></a>, <a class="reference internal" href="../library/threading.html#threading.BoundedSemaphore" title="threading.BoundedSemaphore"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.BoundedSemaphore</span></code></a>, <a class="reference internal" href="../library/threading.html#threading.Event" title="threading.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Event</span></code></a>, <a class="reference internal" href="../library/threading.html#threading.Timer" title="threading.Timer"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Timer</span></code></a> がクラスになったので、サブクラス化出来るようになりました。 (Contributed by Éric Araujo in <a class="reference external" href="https://bugs.python.org/issue10968">bpo-10968</a>.)</p>
<p><a class="reference internal" href="../library/threading.html#threading.Thread" title="threading.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Thread</span></code></a> コンストラクタがキーワード引数 <code class="docutils literal notranslate"><span class="pre">daemon</span></code> を取るようになりました。これは親スレッドから <code class="docutils literal notranslate"><span class="pre">daemon</span></code> フラグを継承するデフォルトの振る舞いをオーバライドします (<a class="reference external" href="https://bugs.python.org/issue6064">bpo-6064</a>)。</p>
<p>かつての非公開関数 <code class="docutils literal notranslate"><span class="pre">_thread.get_ident</span></code> が公開関数 <a class="reference internal" href="../library/threading.html#threading.get_ident" title="threading.get_ident"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.get_ident()</span></code></a> として利用可能となっています。これは標準ライブラリにおいて多数の <code class="docutils literal notranslate"><span class="pre">_thread</span></code> モジュールへの直接アクセスを取り除く結果になりました。 <code class="docutils literal notranslate"><span class="pre">_thread.get_ident</span></code> を使っているサードパーティのコードも同じように、新しく公開化されたインターフェイスに乗り換えるべきです。</p>
</div>
<div class="section" id="time">
<h3>time<a class="headerlink" href="#time" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-94"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0418"><strong>PEP 418</strong></a> が <a class="reference internal" href="../library/time.html#module-time" title="time: Time access and conversions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">time</span></code></a> モジュールに新たな関数を追加しました:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/time.html#time.get_clock_info" title="time.get_clock_info"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_clock_info()</span></code></a>: クロックの情報を取得します。</li>
<li><a class="reference internal" href="../library/time.html#time.monotonic" title="time.monotonic"><code class="xref py py-func docutils literal notranslate"><span class="pre">monotonic()</span></code></a>: 単調なクロック (逆行しない)、システムクロックの更新の影響を受けません。</li>
<li><a class="reference internal" href="../library/time.html#time.perf_counter" title="time.perf_counter"><code class="xref py py-func docutils literal notranslate"><span class="pre">perf_counter()</span></code></a>: 短期間の計測のために利用可能な最高の解像度を持つパフォーマンスカウンタです。</li>
<li><a class="reference internal" href="../library/time.html#time.process_time" title="time.process_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_time()</span></code></a>: 現在のプロセスの system と user CPU 時間の和です。</li>
</ul>
<p>その他の新たな関数:</p>
<ul class="simple">
<li>関数 <a class="reference internal" href="../library/time.html#time.clock_getres" title="time.clock_getres"><code class="xref py py-func docutils literal notranslate"><span class="pre">clock_getres()</span></code></a>, <a class="reference internal" href="../library/time.html#time.clock_gettime" title="time.clock_gettime"><code class="xref py py-func docutils literal notranslate"><span class="pre">clock_gettime()</span></code></a>, <a class="reference internal" href="../library/time.html#time.clock_settime" title="time.clock_settime"><code class="xref py py-func docutils literal notranslate"><span class="pre">clock_settime()</span></code></a> と、これに使われる定数群 <code class="docutils literal notranslate"><span class="pre">CLOCK_xxx</span></code> の追加。 (Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue10278">bpo-10278</a>.)</li>
</ul>
<p>クロスプラットフォーム間での一貫性を改善するために、 <a class="reference internal" href="../library/time.html#time.sleep" title="time.sleep"><code class="xref py py-func docutils literal notranslate"><span class="pre">sleep()</span></code></a> が負の値を渡すと <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> を投げるように変更されています。以前から POSIX システムではエラーでしたが、Windows の場合に無限に sleep していました。</p>
</div>
<div class="section" id="types">
<h3>types<a class="headerlink" href="#types" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新規クラス <a class="reference internal" href="../library/types.html#types.MappingProxyType" title="types.MappingProxyType"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> の追加: 読み出し専用のマッピングのプロキシです。 (<a class="reference external" href="https://bugs.python.org/issue14386">bpo-14386</a>)</p>
<p>新規関数 <a class="reference internal" href="../library/types.html#types.new_class" title="types.new_class"><code class="xref py py-func docutils literal notranslate"><span class="pre">types.new_class()</span></code></a> と <a class="reference internal" href="../library/types.html#types.prepare_class" title="types.prepare_class"><code class="xref py py-func docutils literal notranslate"><span class="pre">types.prepare_class()</span></code></a> は <span class="target" id="index-95"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3115"><strong>PEP 3115</strong></a> 準拠の動的な型の生成サポートを提供します。(<a class="reference external" href="https://bugs.python.org/issue14588">bpo-14588</a>)</p>
</div>
<div class="section" id="unittest">
<h3>unittest<a class="headerlink" href="#unittest" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>メソッド <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRaises" title="unittest.TestCase.assertRaises"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRaises()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRaisesRegex" title="unittest.TestCase.assertRaisesRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRaisesRegex()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarns" title="unittest.TestCase.assertWarns"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarns()</span></code></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertWarnsRegex" title="unittest.TestCase.assertWarnsRegex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertWarnsRegex()</span></code></a> が、コンテキストマネージャとして使われる際にキーワード引数 <em>msg</em> を受け付けるようになりました。 (Contributed by Ezio Melotti and Winston Ewert in <a class="reference external" href="https://bugs.python.org/issue10775">bpo-10775</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.run" title="unittest.TestCase.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unittest.TestCase.run()</span></code></a> が <a class="reference internal" href="../library/unittest.html#unittest.TestResult" title="unittest.TestResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestResult</span></code></a> オブジェクトを返すようになりました。</p>
</div>
<div class="section" id="urllib">
<h3>urllib<a class="headerlink" href="#urllib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/urllib.request.html#urllib.request.Request" title="urllib.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> クラスが <a class="reference internal" href="../library/urllib.request.html#urllib.request.Request.get_method" title="urllib.request.Request.get_method"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_method()</span></code></a> で使われる <em>method</em> 引数を受け付けるようになりました。これはどの HTTP メソッドが使われるべきかを指定します。例えば以下は <code class="docutils literal notranslate"><span class="pre">'HEAD'</span></code> リクエストを送信します:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="s1">&#39;https://www.python.org&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;HEAD&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="https://bugs.python.org/issue1673007">bpo-1673007</a>)</p>
</div>
<div class="section" id="webbrowser">
<h3>webbrowser<a class="headerlink" href="#webbrowser" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/webbrowser.html#module-webbrowser" title="webbrowser: Easy-to-use controller for Web browsers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">webbrowser</span></code></a> モジュールがさらに多くの &quot;browsers&quot; をサポートしました: Google Chrome (バージョンと OS 依存で名前が <strong class="program">chrome</strong>, <strong class="program">chromium</strong>, <strong class="program">chrome-browser</strong>, あるいは <strong class="program">chromium-browser</strong>) と、汎用のランチャ <strong class="program">xdg-open</strong> (FreeDesktop.org プロジェクトのもの) と <strong class="program">gvfs-open</strong> (GNOME 3 のデフォルト URI ハンドラ)。 (The former contributed by Arnaud Calmettes in <a class="reference external" href="https://bugs.python.org/issue13620">bpo-13620</a>, the latter by Matthias Klose in <a class="reference external" href="https://bugs.python.org/issue14493">bpo-14493</a>.)</p>
</div>
<div class="section" id="xml-etree-elementtree">
<h3>xml.etree.ElementTree<a class="headerlink" href="#xml-etree-elementtree" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> モジュールはデフォルトで C 実装による高速版をインポートするようになりました; もう明示的に <code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.cElementTree</span></code> をインポートする必要はありません (cElementTree モジュールは後方互換のために残されますが非推奨となりました)。また、 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> クラスの <code class="docutils literal notranslate"><span class="pre">iter</span></code> 系のメソッドに最適化が施されました (C で再実装されました)。また、このモジュールのドキュメントは大幅に改善されて、実例が追加され、さらに詳細なリファレンスになりました。</p>
</div>
<div class="section" id="zlib">
<h3>zlib<a class="headerlink" href="#zlib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新規属性 <a class="reference internal" href="../library/zlib.html#zlib.Decompress.eof" title="zlib.Decompress.eof"><code class="xref py py-attr docutils literal notranslate"><span class="pre">zlib.Decompress.eof</span></code></a> が追加されました。これにより適切に作られたストリームなのか不完全だったり切り捨てられたものなのかを区別することが出来ます。 (Contributed by Nadeem Vawda in <a class="reference external" href="https://bugs.python.org/issue12646">bpo-12646</a>.)</p>
<p>新規属性 <a class="reference internal" href="../library/zlib.html#zlib.ZLIB_RUNTIME_VERSION" title="zlib.ZLIB_RUNTIME_VERSION"><code class="xref py py-attr docutils literal notranslate"><span class="pre">zlib.ZLIB_RUNTIME_VERSION</span></code></a> は実行時にロードされた背後の <code class="docutils literal notranslate"><span class="pre">zlib</span></code> ライブラリのバージョン文字列です。 (Contributed by Torsten Landschoff in <a class="reference external" href="https://bugs.python.org/issue12306">bpo-12306</a>.)</p>
</div>
</div>
<div class="section" id="optimizations">
<h2>最適化<a class="headerlink" href="#optimizations" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大きな性能向上がありました:</p>
<ul>
<li><p class="first"><span class="target" id="index-96"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> により、Unicode 文字列に対する操作が最適化されました:</p>
<ul class="simple">
<li>メモリフットプリントはテキストに依存して 1/2 から 1/4 になりました</li>
<li>ASCII 文字列を UTF-8 にエンコードするのに文字をエンコードする必要はなくなりました、UTF-8 表現は ASCII 表現と共有されます</li>
<li>UTF-8 エンコーダが最適化されました</li>
<li>単一の ASCII 文字を繰り返して ASCII 文字列の部分列を得るのは 4 倍速くなりました</li>
</ul>
</li>
<li><p class="first">UTF-8 が2倍から4倍速くなりました。UTF-16 のエンコーディングが最大で10倍速くなりました。</p>
<p>(Contributed by Serhiy Storchaka, <a class="reference external" href="https://bugs.python.org/issue14624">bpo-14624</a>, <a class="reference external" href="https://bugs.python.org/issue14738">bpo-14738</a> and
<a class="reference external" href="https://bugs.python.org/issue15026">bpo-15026</a>.)</p>
</li>
</ul>
</div>
<div class="section" id="build-and-c-api-changes">
<h2>ビルドならびに C API の変更<a class="headerlink" href="#build-and-c-api-changes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python のビルド過程と C API の変更は以下の通りです:</p>
<ul class="simple">
<li>新しい <span class="target" id="index-97"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> 関連の関数:<ul>
<li><a class="reference internal" href="../c-api/memoryview.html#c.PyMemoryView_FromMemory" title="PyMemoryView_FromMemory"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyMemoryView_FromMemory()</span></code></a></li>
</ul>
</li>
<li><span class="target" id="index-98"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> により追加された新たな Unicode 型、マクロ、関数:<ul>
<li>高水準 API:<ul>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FindChar" title="PyUnicode_FindChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FindChar()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetLength" title="PyUnicode_GetLength"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetLength()</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_LENGTH" title="PyUnicode_GET_LENGTH"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_New" title="PyUnicode_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_New()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Substring" title="PyUnicode_Substring"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Substring()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_ReadChar" title="PyUnicode_ReadChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_ReadChar()</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_WriteChar" title="PyUnicode_WriteChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_WriteChar()</span></code></a></li>
</ul>
</li>
<li>低水準 API:<ul>
<li>型 <a class="reference internal" href="../c-api/unicode.html#c.Py_UCS1" title="Py_UCS1"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UCS1</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.Py_UCS2" title="Py_UCS2"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UCS2</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.Py_UCS4" title="Py_UCS4"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UCS4</span></code></a></li>
<li>構造体 <a class="reference internal" href="../c-api/unicode.html#c.PyASCIIObject" title="PyASCIIObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyASCIIObject</span></code></a> と <a class="reference internal" href="../c-api/unicode.html#c.PyCompactUnicodeObject" title="PyCompactUnicodeObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCompactUnicodeObject</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_READY" title="PyUnicode_READY"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_READY</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromKindAndData" title="PyUnicode_FromKindAndData"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromKindAndData()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUCS4" title="PyUnicode_AsUCS4"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUCS4()</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUCS4Copy" title="PyUnicode_AsUCS4Copy"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUCS4Copy()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_DATA" title="PyUnicode_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_DATA</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_1BYTE_DATA" title="PyUnicode_1BYTE_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_1BYTE_DATA</span></code></a>,
<a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_2BYTE_DATA" title="PyUnicode_2BYTE_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_2BYTE_DATA</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_4BYTE_DATA" title="PyUnicode_4BYTE_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_4BYTE_DATA</span></code></a></li>
<li><code class="xref c c-type docutils literal notranslate"><span class="pre">PyUnicode_Kind</span></code> 列挙型での <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_KIND" title="PyUnicode_KIND"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_KIND</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_WCHAR_KIND" title="PyUnicode_WCHAR_KIND"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyUnicode_WCHAR_KIND</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_1BYTE_KIND" title="PyUnicode_1BYTE_KIND"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyUnicode_1BYTE_KIND</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_2BYTE_KIND" title="PyUnicode_2BYTE_KIND"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyUnicode_2BYTE_KIND</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_4BYTE_KIND" title="PyUnicode_4BYTE_KIND"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyUnicode_4BYTE_KIND</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_READ" title="PyUnicode_READ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_READ</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_READ_CHAR" title="PyUnicode_READ_CHAR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_READ_CHAR</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_WRITE" title="PyUnicode_WRITE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_WRITE</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_MAX_CHAR_VALUE" title="PyUnicode_MAX_CHAR_VALUE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_MAX_CHAR_VALUE</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="../c-api/arg.html#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyArg_ParseTuple</span></code></a> が <code class="docutils literal notranslate"><span class="pre">c</span></code> フォーマットとして <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> を許容するようになりました (<a class="reference external" href="https://bugs.python.org/issue12380">bpo-12380</a>)。</li>
</ul>
</div>
<div class="section" id="deprecated">
<h2>非推奨<a class="headerlink" href="#deprecated" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="unsupported-operating-systems">
<h3>サポートされないオペレーティングシステム<a class="headerlink" href="#unsupported-operating-systems" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>保守する者がいないため OS/2 ならびに VMS はもはやサポートされません。</p>
<p>保守の負担のため WIndows 2000 および <code class="docutils literal notranslate"><span class="pre">COMSPEC</span></code> を <code class="docutils literal notranslate"><span class="pre">command.com</span></code> に設定している Windows プラットフォームはもはやサポートされません。</p>
<p>3.2 で非推奨だった OSF のサポートが完全に削除されました。</p>
</div>
<div class="section" id="deprecated-python-modules-functions-and-methods">
<h3>非推奨の Python モジュール、関数、メソッド<a class="headerlink" href="#deprecated-python-modules-functions-and-methods" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>object 型そのものの <code class="docutils literal notranslate"><span class="pre">object.__format__()</span></code> に空でない文字列が渡すことは非推奨となりました。Python 3.4 ではこれは <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> となります (<a class="reference external" href="https://bugs.python.org/issue9856">bpo-9856</a>)。</li>
<li><span class="target" id="index-99"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> により、 <code class="docutils literal notranslate"><span class="pre">unicode_internal</span></code> コーデックは非推奨となりました。UTF-8, UTF-16 (<code class="docutils literal notranslate"><span class="pre">utf-16-le</span></code> または <code class="docutils literal notranslate"><span class="pre">utf-16-be</span></code>), あるいは UTF-32 (<code class="docutils literal notranslate"><span class="pre">utf-32-le</span></code> または <code class="docutils literal notranslate"><span class="pre">utf-32-be</span></code>) を使ってください。</li>
<li><a class="reference internal" href="../library/ftplib.html#ftplib.FTP.nlst" title="ftplib.FTP.nlst"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.nlst()</span></code></a> および <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.dir" title="ftplib.FTP.dir"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.dir()</span></code></a>: <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.mlsd" title="ftplib.FTP.mlsd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ftplib.FTP.mlsd()</span></code></a> を使ってください</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">platform.popen()</span></code>: <a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> モジュールを使ってください。 <a class="reference internal" href="../library/subprocess.html#subprocess-replacements"><span class="std std-ref">古い関数を subprocess モジュールで置き換える</span></a> を是非お読みください (<a class="reference external" href="https://bugs.python.org/issue11377">bpo-11377</a>)。</li>
<li><a class="reference external" href="https://bugs.python.org/issue13374">bpo-13374</a>: <a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> モジュールにある Windows のバイト列 API は非推奨となりました。ANSI コードページに依存しないようにしてあらゆるファイル名をサポートするために、バイト列文字列のファイル名ではなく Unicode ファイル名を使ってください。</li>
<li><a class="reference external" href="https://bugs.python.org/issue13988">bpo-13988</a>: <code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.cElementTree</span></code> モジュールは非推奨です。利用できる際はいつでも自動的にアクセラレータを使用します。</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">time.clock()</span></code> の振る舞いがプラットフォーム依存のため、今後は要件に応じて新たに追加された <a class="reference internal" href="../library/time.html#time.perf_counter" title="time.perf_counter"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.perf_counter()</span></code></a> または <a class="reference internal" href="../library/time.html#time.process_time" title="time.process_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.process_time()</span></code></a> を使ってください。これらの振る舞いは良く定義されています(well defined)。</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat_float_times()</span></code> 関数は非推奨です。</li>
<li><a class="reference internal" href="../library/abc.html#module-abc" title="abc: Abstract base classes according to :pep:`3119`."><code class="xref py py-mod docutils literal notranslate"><span class="pre">abc</span></code></a> モジュール:<ul>
<li><a class="reference internal" href="../library/abc.html#abc.abstractproperty" title="abc.abstractproperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractproperty</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#property" title="property"><code class="xref py py-class docutils literal notranslate"><span class="pre">property</span></code></a> を渡して使ってください。</li>
<li><a class="reference internal" href="../library/abc.html#abc.abstractclassmethod" title="abc.abstractclassmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractclassmethod</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">classmethod</span></code></a> を渡して使ってください。</li>
<li><a class="reference internal" href="../library/abc.html#abc.abstractstaticmethod" title="abc.abstractstaticmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.abstractstaticmethod</span></code></a> は非推奨となりました。代わりに <a class="reference internal" href="../library/abc.html#abc.abstractmethod" title="abc.abstractmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">abc.abstractmethod()</span></code></a> に <a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">staticmethod</span></code></a> を渡して使ってください。</li>
</ul>
</li>
<li><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> パッケージ:<ul>
<li>バイトコードファイルとしての <a class="reference internal" href="../library/importlib.html#importlib.abc.SourceLoader.path_stats" title="importlib.abc.SourceLoader.path_stats"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.SourceLoader.path_stats()</span></code></a> によりコンパイル時点の修正時刻とソースファイルサイズの両方を格納するようになったので、 <a class="reference internal" href="../library/importlib.html#importlib.abc.SourceLoader.path_mtime" title="importlib.abc.SourceLoader.path_mtime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.SourceLoader.path_mtime()</span></code></a> は非推奨となりました。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="deprecated-functions-and-types-of-the-c-api">
<h3>C API の非推奨の関数ならびに型<a class="headerlink" href="#deprecated-functions-and-types-of-the-c-api" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><span class="target" id="index-100"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> で <a class="reference internal" href="../c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE</span></code></a> は非推奨になり、Python 4 で削除されます。この型を使用している全ての関数は非推奨です。</p>
<p>型 <a class="reference internal" href="../c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE</span></code></a> および <a class="reference internal" href="../c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE*</span></code></a> を使用しているユニコード関数ならびにメソッド:</p>
<ul class="simple">
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromUnicode" title="PyUnicode_FromUnicode"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_FromUnicode</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromWideChar" title="PyUnicode_FromWideChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromWideChar()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromKindAndData" title="PyUnicode_FromKindAndData"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromKindAndData()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AS_UNICODE" title="PyUnicode_AS_UNICODE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_AS_UNICODE</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicode" title="PyUnicode_AsUnicode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicode()</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicodeAndSize" title="PyUnicode_AsUnicodeAndSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeAndSize()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsWideCharString" title="PyUnicode_AsWideCharString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsWideCharString()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AS_DATA" title="PyUnicode_AS_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_AS_DATA</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_READ" title="PyUnicode_READ"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_READ</span></code></a> および <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_WRITE" title="PyUnicode_WRITE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_WRITE</span></code></a> とともに <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_DATA" title="PyUnicode_DATA"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_DATA</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_SIZE" title="PyUnicode_GET_SIZE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_SIZE</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetSize" title="PyUnicode_GetSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetSize()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_LENGTH" title="PyUnicode_GET_LENGTH"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetLength" title="PyUnicode_GetLength"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetLength()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_DATA_SIZE" title="PyUnicode_GET_DATA_SIZE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_DATA_SIZE</span></code></a>: <code class="docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH(str)</span> <span class="pre">*</span> <span class="pre">PyUnicode_KIND(str)</span></code> を使用してください (既存の文字列でのみうまくいきます)</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicodeCopy" title="PyUnicode_AsUnicodeCopy"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeCopy()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUCS4Copy" title="PyUnicode_AsUCS4Copy"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUCS4Copy()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsWideCharString" title="PyUnicode_AsWideCharString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsWideCharString()</span></code></a> を使用してください</li>
<li><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetMax()</span></code></li>
</ul>
<p>Py_UNICODE* 文字列を操作する関数ならびにマクロ:</p>
<ul class="simple">
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strlen</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetLength" title="PyUnicode_GetLength"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetLength()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_LENGTH" title="PyUnicode_GET_LENGTH"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strcat</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strcpy</span></code>, <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strncpy</span></code>, <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_COPY</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Substring" title="PyUnicode_Substring"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Substring()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strcmp</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Compare" title="PyUnicode_Compare"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Compare()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strncmp</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Tailmatch" title="PyUnicode_Tailmatch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Tailmatch()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strchr</span></code>, <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_strrchr</span></code>:  <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FindChar" title="PyUnicode_FindChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FindChar()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_FILL</span></code>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Fill" title="PyUnicode_Fill"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Fill()</span></code></a> を使用してください</li>
<li><code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_UNICODE_MATCH</span></code></li>
</ul>
<p>エンコーダ:</p>
<ul class="simple">
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Encode" title="PyUnicode_Encode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Encode()</span></code></a>: <code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsEncodedObject()</span></code> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeUTF7" title="PyUnicode_EncodeUTF7"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeUTF7()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeUTF8" title="PyUnicode_EncodeUTF8"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeUTF8()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUTF8" title="PyUnicode_AsUTF8"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUTF8()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUTF8String" title="PyUnicode_AsUTF8String"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUTF8String()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeUTF32" title="PyUnicode_EncodeUTF32"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeUTF32()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeUTF16" title="PyUnicode_EncodeUTF16"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeUTF16()</span></code></a></li>
<li><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeUnicodeEscape:()</span></code> <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicodeEscapeString" title="PyUnicode_AsUnicodeEscapeString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeEscapeString()</span></code></a> を使用してください</li>
<li><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeRawUnicodeEscape:()</span></code> <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsRawUnicodeEscapeString" title="PyUnicode_AsRawUnicodeEscapeString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsRawUnicodeEscapeString()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeLatin1" title="PyUnicode_EncodeLatin1"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeLatin1()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsLatin1String" title="PyUnicode_AsLatin1String"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsLatin1String()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeASCII" title="PyUnicode_EncodeASCII"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeASCII()</span></code></a>: <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsASCIIString" title="PyUnicode_AsASCIIString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsASCIIString()</span></code></a> を使用してください</li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeCharmap" title="PyUnicode_EncodeCharmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeCharmap()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_TranslateCharmap" title="PyUnicode_TranslateCharmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_TranslateCharmap()</span></code></a></li>
<li><a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeMBCS" title="PyUnicode_EncodeMBCS"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeMBCS()</span></code></a>: (<code class="docutils literal notranslate"><span class="pre">CP_ACP</span></code> code_page とともに) <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsMBCSString" title="PyUnicode_AsMBCSString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsMBCSString()</span></code></a> または <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_EncodeCodePage" title="PyUnicode_EncodeCodePage"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeCodePage()</span></code></a>  を使用してください</li>
<li><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_EncodeDecimal()</span></code>,
<a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_TransformDecimalToASCII" title="PyUnicode_TransformDecimalToASCII"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_TransformDecimalToASCII()</span></code></a></li>
</ul>
</div>
<div class="section" id="deprecated-features">
<h3>非推奨の機能<a class="headerlink" href="#deprecated-features" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/array.html#module-array" title="array: Space efficient arrays of uniformly typed numeric values."><code class="xref py py-mod docutils literal notranslate"><span class="pre">array</span></code></a> モジュールの <code class="docutils literal notranslate"><span class="pre">'u'</span></code> 書式化コードは非推奨となりました。Python 4 ではほかの (<a class="reference internal" href="../c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE</span></code></a>) API と一緒に削除されるでしょう。</p>
</div>
</div>
<div class="section" id="porting-to-python-3-3">
<h2>Python 3.3 への移植<a class="headerlink" href="#porting-to-python-3-3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このセクションでは前述の変更とバグフィックスにより必要となるかもしれないコードの変更を列挙します:</p>
<div class="section" id="porting-python-code">
<span id="portingpythoncode"></span><h3>Python コードの移植<a class="headerlink" href="#porting-python-code" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>ハッシュのランダム化がデフォルトで有効になりました。これを無効にするには環境変数 <span class="target" id="index-101"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONHASHSEED"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHASHSEED</span></code></a> を <code class="docutils literal notranslate"><span class="pre">0</span></code> にセットして下さい。 <a class="reference internal" href="../reference/datamodel.html#object.__hash__" title="object.__hash__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">object.__hash__()</span></code></a> メソッドも参照して下さい。</li>
<li><a class="reference external" href="https://bugs.python.org/issue12326">bpo-12326</a>: Linux では、 <a class="reference internal" href="../library/sys.html#sys.platform" title="sys.platform"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.platform</span></code></a> はもはやメジャーバージョン番号を含みません。 これは今では常に 'linux' です。以前はこれは Python のビルドに使われた Linux バージョンに依存した <code class="docutils literal notranslate"><span class="pre">'linux2'</span></code> や <code class="docutils literal notranslate"><span class="pre">'linux3'</span></code> でした。 <code class="docutils literal notranslate"><span class="pre">sys.platform</span> <span class="pre">==</span> <span class="pre">'linux2'</span></code> などとするのではなく、 <code class="docutils literal notranslate"><span class="pre">sys.platform.startswith('linux')</span></code> とするか、古い Python バージョンのサポートが不要であれば直接的に <code class="docutils literal notranslate"><span class="pre">sys.platform</span> <span class="pre">==</span> <span class="pre">'linux'</span></code> として下さい。</li>
<li><a class="reference external" href="https://bugs.python.org/issue13847">bpo-13847</a>, <a class="reference external" href="https://bugs.python.org/issue14180">bpo-14180</a>: <a class="reference internal" href="../library/time.html#module-time" title="time: Time access and conversions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">time</span></code></a> および <a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code class="xref py py-mod docutils literal notranslate"><span class="pre">datetime</span></code></a>: タイムスタンプが範囲外の場合に、 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> ではなく <a class="reference internal" href="../library/exceptions.html#OverflowError" title="OverflowError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OverflowError</span></code></a> を送出するようになりました。また、C 関数の <code class="xref c c-func docutils literal notranslate"><span class="pre">gmtime()</span></code> あるいは <code class="xref c c-func docutils literal notranslate"><span class="pre">localtime()</span></code> が失敗した場合には <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> を送出するようになりました。</li>
<li>インポートで使われるデフォルトのファインダが、特定のディレクトリに何が含まれるのかについてのキャッシュを利用するようになっています。実行中に Python ソースファイルやバイトコードファイルを作ったら、キャッシュをクリアしてファインダが新しく作られたファイルに気付けるように、 <a class="reference internal" href="../library/importlib.html#importlib.invalidate_caches" title="importlib.invalidate_caches"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.invalidate_caches()</span></code></a> を呼ぶ必要があることに注意してください。</li>
<li><a class="reference internal" href="../library/exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> がインポートを試みたモジュール名として完全名を使うようになっています。ImportError のメッセージをチェックする doctest は、モジュール名をその末尾の名前ではなく完全な名前を使うように更新する必要があります。</li>
<li><a class="reference internal" href="../library/functions.html#__import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> の引数 <em>index</em> のデフォルトが -1 ではなく 0 となり、また、もはや負の値はサポートされません。デフォルト値が -1 で残されたのは(訳注: つまり絶対、相対インポートの両方を試みるようにしたのは) <span class="target" id="index-102"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0328"><strong>PEP 328</strong></a> を実装した際の過失でした。絶対インポートに先立って相対インポートを実行する振る舞いがまだ必要なのであれば、index を 1 にして相対インポートを実行して、その後で index 0 のインポートをするようにしてください。そうなのですが、 <a class="reference internal" href="../library/functions.html#__import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> を直接呼び出すのではなく、 <a class="reference internal" href="../library/importlib.html#importlib.import_module" title="importlib.import_module"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.import_module()</span></code></a> を使うことが望ましいやり方です。</li>
<li><a class="reference internal" href="../library/functions.html#__import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> の index に、トップレベルモジュールに対して 0 でなく 1 を与えることは今では許されません。例えば <code class="docutils literal notranslate"><span class="pre">__import__('sys',</span> <span class="pre">level=1)</span></code> はエラーです。</li>
<li><a class="reference internal" href="../library/sys.html#sys.meta_path" title="sys.meta_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.meta_path</span></code></a> と <a class="reference internal" href="../library/sys.html#sys.path_hooks" title="sys.path_hooks"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_hooks</span></code></a> にデフォルトでファインダが含まれるようになったので、これらリストの操作で <code class="xref py py-meth docutils literal notranslate"><span class="pre">list.append()</span></code> してきたのであれば、今後はおそらくほとんどは <code class="xref py py-meth docutils literal notranslate"><span class="pre">list.insert()</span></code> が相応しいでしょう。</li>
<li>ファインダが見つからない場合に <a class="reference internal" href="../library/sys.html#sys.path_importer_cache" title="sys.path_importer_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code></a> に <code class="docutils literal notranslate"><span class="pre">None</span></code> が挿入されるようになったので、ファインダを持たないパスの辞書エントリをクリアするには、後方互換性を保つためには <a class="reference internal" href="../library/imp.html#imp.NullImporter" title="imp.NullImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">imp.NullImporter</span></code></a> を値に持つエントリと <code class="docutils literal notranslate"><span class="pre">None</span></code> を値に持つエントリ <strong>の両方を</strong> 削除する必要があります。古い Python バージョンと比較して、暗黙のファインダを使うことを示すのに <a class="reference internal" href="../library/sys.html#sys.path_importer_cache" title="sys.path_importer_cache"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code></a> に <code class="docutils literal notranslate"><span class="pre">None</span></code> を再挿入するという追加のオーバヘッドが必要となりますが、意味的には何の変更もないはずです。</li>
<li><a class="reference internal" href="../library/importlib.html#importlib.abc.Finder" title="importlib.abc.Finder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Finder</span></code></a> が <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> 実装を強制することで行われていた抽象化は撤廃されています。そのメソッドを実装するサブクラスに依存していたならば、メソッドの存在を先にチェックするようにしてください。ですが、 <a class="reference internal" href="../glossary.html#term-path-entry-finder"><span class="xref std std-term">path entry finders</span></a> とともに動作させるのに、 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_loader" title="importlib.abc.PathEntryFinder.find_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_loader()</span></code></a> を最初にチェックしたくなるかもしれません。</li>
<li><a class="reference internal" href="../library/pkgutil.html#module-pkgutil" title="pkgutil: Utilities for the import system."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pkgutil</span></code></a> は、内部的に <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> を使うように変更されました。このことは、 <span class="target" id="index-103"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0302"><strong>PEP 302</strong></a> インポートエミュレーションの古い振る舞いが本物のインポートシステムの振る舞いに合わせるのに失敗していた数多くの特殊ケースの問題を取り除きます。インポートエミュレーションそのものはまだ存在しますが、今では非推奨です。 <a class="reference internal" href="../library/pkgutil.html#pkgutil.iter_importers" title="pkgutil.iter_importers"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.iter_importers()</span></code></a> 関数と <a class="reference internal" href="../library/pkgutil.html#pkgutil.walk_packages" title="pkgutil.walk_packages"><code class="xref py py-func docutils literal notranslate"><span class="pre">pkgutil.walk_packages()</span></code></a> 関数は標準インポートフックを特別に扱うので、ファインダの <code class="docutils literal notranslate"><span class="pre">iter_modules()</span></code> メソッドは標準ではないにも関わらず、まだサポートされます。</li>
<li><a class="reference internal" href="../library/email.header.html#email.header.decode_header" title="email.header.decode_header"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.header.decode_header()</span></code></a> によってなされる解析に長い間存在していた RFC 非準拠のバグ (<a class="reference external" href="https://bugs.python.org/issue1079">bpo-1079</a>) が修正されました。エンコードされたヘッダを Unicode に変換するための標準的なイディオム (<code class="docutils literal notranslate"><span class="pre">str(make_header(decode_header(h))</span></code>) を使うコードからは変化はみえません。ですが、 decode_header から返される個々のタプル要素を見ているコードでは、 <code class="docutils literal notranslate"><span class="pre">ASCII</span></code> セクションの前後の空白が <code class="docutils literal notranslate"><span class="pre">ASCII</span></code> 内に含まれるようになったことがわかります。 <code class="docutils literal notranslate"><span class="pre">make_header</span></code> は入力文字列に既に存在していなければ <code class="docutils literal notranslate"><span class="pre">ASCII</span></code> 非 <code class="docutils literal notranslate"><span class="pre">ASCII</span></code> セクション間に以前と同じく空白を追加するので、 <code class="docutils literal notranslate"><span class="pre">make_header</span></code> を使ってヘッダを構築するコードは変更なしで動作するはずです。</li>
<li><a class="reference internal" href="../library/email.utils.html#email.utils.formataddr" title="email.utils.formataddr"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.utils.formataddr()</span></code></a> は非 ASCII の display name に対し正しい content transfer encoding の扱いをするようになっています。かつての、フォーマット後文字列内に非 ASCII Unicode を維持してしまう誤った振る舞いに依存するすべてのコードは、変更の必要があります。 (<a class="reference external" href="https://bugs.python.org/issue1690608">bpo-1690608</a>)</li>
<li><a class="reference internal" href="../library/poplib.html#poplib.POP3.quit" title="poplib.POP3.quit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">poplib.POP3.quit()</span></code></a> メソッドもほかの全ての <code class="docutils literal notranslate"><span class="pre">poplib</span></code> のメソッドと同じく、今ではプロトコルエラーを送出し得ます。 <code class="docutils literal notranslate"><span class="pre">quit</span></code> が <a class="reference internal" href="../library/poplib.html#poplib.error_proto" title="poplib.error_proto"><code class="xref py py-exc docutils literal notranslate"><span class="pre">poplib.error_proto</span></code></a> エラーを送出しないことをあてにしていたコードは、 <code class="docutils literal notranslate"><span class="pre">quit</span></code> でのエラーが特定のアプリケーションにとって問題となるようであれば、修正の必要があるかもしれません (<a class="reference external" href="https://bugs.python.org/issue11291">bpo-11291</a>)。</li>
<li>Python 2.4 から非推奨となっていた、 <a class="reference internal" href="../library/email.parser.html#email.parser.Parser" title="email.parser.Parser"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.parser.Parser</span></code></a> への <code class="docutils literal notranslate"><span class="pre">strict</span></code> 引数はついに削除されました。</li>
<li>非推奨となっていたメソッド <code class="docutils literal notranslate"><span class="pre">unittest.TestCase.assertSameElements</span></code> は削除されました。</li>
<li>非推奨となっていた変数 <code class="docutils literal notranslate"><span class="pre">time.accept2dyear</span></code> は削除されました。</li>
<li>非推奨となっていた <code class="docutils literal notranslate"><span class="pre">Context._clamp</span></code> 属性が <a class="reference internal" href="../library/decimal.html#module-decimal" title="decimal: Implementation of the General Decimal Arithmetic  Specification."><code class="xref py py-mod docutils literal notranslate"><span class="pre">decimal</span></code></a> モジュールから削除されました。以前に既にこれは公開属性 <code class="xref py py-attr docutils literal notranslate"><span class="pre">clamp</span></code> に置き換えられていました (<a class="reference external" href="https://bugs.python.org/issue8540">bpo-8540</a> 参照)。</li>
<li>文書化されていなかった内部ヘルパクラス <code class="docutils literal notranslate"><span class="pre">SSLFakeFile</span></code> が <a class="reference internal" href="../library/smtplib.html#module-smtplib" title="smtplib: SMTP protocol client (requires sockets)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">smtplib</span></code></a> モジュールより削除されました。この機能はずっと以前から <a class="reference internal" href="../library/socket.html#socket.socket.makefile" title="socket.socket.makefile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.socket.makefile()</span></code></a> によって直接的に提供されています。</li>
<li>Windows では <a class="reference internal" href="../library/time.html#time.sleep" title="time.sleep"><code class="xref py py-func docutils literal notranslate"><span class="pre">time.sleep()</span></code></a> に負値を与えた場合に無限に眠っていましたが、今ではこれは例外を送出します。POSIX ではこれは以前より常に例外です。</li>
<li>定数 <code class="docutils literal notranslate"><span class="pre">ast.__version__</span></code> は削除されました。AST バージョンに依拠して何かしらの決定をする必要があるのであれば、 <a class="reference internal" href="../library/sys.html#sys.version_info" title="sys.version_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> を使ってください。</li>
<li><a class="reference internal" href="../library/threading.html#module-threading" title="threading: Thread-based parallelism."><code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code></a> モジュールの、非公開クラスをサブクラス化するファクトリ関数を迂回していたコードは、今では公開クラスになったので修正の必要があります。</li>
<li>threading モジュール内の文書化されていなかったデバッグ機構を削除してコードを単純化しました。このことが製品コードに影響することがあってはなりませんが、これと連携していたアプリケーションデバッグフレームワークのケースがありうるので、言及しておきます (<a class="reference external" href="https://bugs.python.org/issue13550">bpo-13550</a>)。</li>
</ul>
</div>
<div class="section" id="porting-c-code">
<h3>C コードの移植<a class="headerlink" href="#porting-c-code" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">バッファ API 変更の一環で、文書化されてこなかった <a class="reference internal" href="../c-api/buffer.html#c.Py_buffer" title="Py_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_buffer</span></code></a> 構造体のメンバ <code class="xref c c-member docutils literal notranslate"><span class="pre">smalltable</span></code> が削除され、また、 <code class="xref c c-type docutils literal notranslate"><span class="pre">PyMemoryViewObject</span></code> のレイアウトが変更されました。</p>
<p><code class="docutils literal notranslate"><span class="pre">memoryobject.h</span></code> あるいは <code class="docutils literal notranslate"><span class="pre">object.h</span></code> での関係する部分に依存する全ての拡張は、再ビルドが必要です。</p>
</li>
<li><p class="first"><a class="reference internal" href="#pep-393"><span class="std std-ref">PEP 393</span></a> により、 <a class="reference internal" href="../c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UNICODE</span></code></a> 型とこの型を使う全ての関数は非推奨となりました (ただし最低 5 年は利用可能なまま保たれます)。Unicode オブジェクトの構築とアクセスに低水準 Unicode API をこれまで使っていて、 <span class="target" id="index-104"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0393"><strong>PEP 393</strong></a> によって提供されるメモリフットプリント削減の恩恵を受けたければ、新しい <a class="reference internal" href="../c-api/unicode.html"><span class="doc">Unicode API</span></a> に乗り換える必要があります。</p>
<p>一方で <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Concat" title="PyUnicode_Concat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Concat()</span></code></a> 、 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Join" title="PyUnicode_Join"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Join()</span></code></a> あるいは <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a> といった高水準関数のみを使ってきたのであれば、あなたのコードは自動的に新しい Unicode 表現に便乗できます。</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/import.html#c.PyImport_GetMagicNumber" title="PyImport_GetMagicNumber"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_GetMagicNumber()</span></code></a> は失敗時に <code class="docutils literal notranslate"><span class="pre">-1</span></code> を返すようになりました。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/functions.html#__import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> の <em>level</em> 引数に負値を渡すことはもはや有効ではないので、対応する <a class="reference internal" href="../c-api/import.html#c.PyImport_ImportModuleLevel" title="PyImport_ImportModuleLevel"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModuleLevel()</span></code></a> でも同じです。このことは <a class="reference internal" href="../c-api/import.html#c.PyImport_ImportModuleEx" title="PyImport_ImportModuleEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModuleEx()</span></code></a> に使われる <em>level</em> の値が <code class="docutils literal notranslate"><span class="pre">-1</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">0</span></code> を使うようになったことも意味しています。</p>
</li>
</ul>
</div>
<div class="section" id="building-c-extensions">
<h3>C 拡張のビルド<a class="headerlink" href="#building-c-extensions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first">C 拡張のファイル名として認められる範囲が狭められました。滅多に使われてこなかった命名は取りやめられました: POSIX では、 <code class="docutils literal notranslate"><span class="pre">xxxmodule.so</span></code>, <code class="docutils literal notranslate"><span class="pre">xxxmodule.abi3.so</span></code>, <code class="docutils literal notranslate"><span class="pre">xxxmodule.cpython-*.so</span></code> 命名は今後 <code class="docutils literal notranslate"><span class="pre">xxx</span></code> モジュールの実装とは認識されません。これまでそのようなファイルを作ってきたのであれば、別の命名に乗り換えてください (つまり <code class="docutils literal notranslate"><span class="pre">module</span></code> 文字列をファイル名から取り除いてください)。</p>
<p>(implemented in <a class="reference external" href="https://bugs.python.org/issue14040">bpo-14040</a>.)</p>
</li>
</ul>
</div>
<div class="section" id="command-line-switch-changes">
<h3>コマンドラインスイッチの変更<a class="headerlink" href="#command-line-switch-changes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">-Q</span></code> コマンドラインスイッチとそれに関係するものは削除されました。 <code class="docutils literal notranslate"><span class="pre">sys.flags.division_warning</span></code> をチェックしているコードは修正する必要があります。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue10998">bpo-10998</a>, contributed by Éric Araujo.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../using/cmdline.html#id3"><code class="xref std std-option docutils literal notranslate"><span class="pre">-S</span></code></a> スイッチ付きで <strong class="program">python</strong> を開始すると、 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">site</span></code> がモジュール検索パスにサイト固有のパスを追加しなくなります。以前のバージョンではそれをしていました。</p>
<p>(<a class="reference external" href="https://bugs.python.org/issue11591">bpo-11591</a>, contributed by Carl Meyer with editions by Éric Araujo.)</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">What's New In Python 3.3</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">概要 -- リリースハイライト</a></li>
<li><a class="reference internal" href="#pep-405-virtual-environments">PEP 405: 仮想環境</a></li>
<li><a class="reference internal" href="#pep-420-implicit-namespace-packages">PEP 420: 暗黙的な名前空間パッケージ</a></li>
<li><a class="reference internal" href="#pep-3118-new-memoryview-implementation-and-buffer-protocol-documentation">PEP 3118: 新たなメモリビューの実装とバッファプロトコルのドキュメント</a><ul>
<li><a class="reference internal" href="#features">フィーチャー</a></li>
<li><a class="reference internal" href="#api-changes">API の変更</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-393-flexible-string-representation">PEP 393: 文字列の柔軟な表現</a><ul>
<li><a class="reference internal" href="#functionality">機能性</a></li>
<li><a class="reference internal" href="#performance-and-resource-usage">性能およびリソース使用量</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-397-python-launcher-for-windows">PEP 397: Windows の Python ランチャ</a></li>
<li><a class="reference internal" href="#pep-3151-reworking-the-os-and-io-exception-hierarchy">PEP 3151: OS および IO 例外階層の手直し</a></li>
<li><a class="reference internal" href="#pep-380-syntax-for-delegating-to-a-subgenerator">PEP 380: サブジェネレータへの委譲構文</a></li>
<li><a class="reference internal" href="#pep-409-suppressing-exception-context">PEP 409: 例外コンテキストの抑制</a></li>
<li><a class="reference internal" href="#pep-414-explicit-unicode-literals">PEP 414: 明示的なユニコードリテラル</a></li>
<li><a class="reference internal" href="#pep-3155-qualified-name-for-classes-and-functions">PEP 3155: クラスと関数の正規名</a></li>
<li><a class="reference internal" href="#pep-412-key-sharing-dictionary">PEP 412: キー共有辞書</a></li>
<li><a class="reference internal" href="#pep-362-function-signature-object">PEP 362: 関数シグニチャオブジェクト</a></li>
<li><a class="reference internal" href="#pep-421-adding-sys-implementation">PEP 421: sys.implementation の追加</a><ul>
<li><a class="reference internal" href="#simplenamespace">SimpleNamespace</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-importlib-as-the-implementation-of-import">インポート実装としての importlib の使用</a><ul>
<li><a class="reference internal" href="#new-apis">新たな API</a></li>
<li><a class="reference internal" href="#visible-changes">目に見える変化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">その他の言語変更</a></li>
<li><a class="reference internal" href="#a-finer-grained-import-lock">細粒度のインポートロック</a></li>
<li><a class="reference internal" href="#builtin-functions-and-types">組み込みの関数と型</a></li>
<li><a class="reference internal" href="#new-modules">新たなモジュール</a><ul>
<li><a class="reference internal" href="#faulthandler">faulthandler</a></li>
<li><a class="reference internal" href="#ipaddress">ipaddress</a></li>
<li><a class="reference internal" href="#lzma">lzma</a></li>
</ul>
</li>
<li><a class="reference internal" href="#improved-modules">改良されたモジュール</a><ul>
<li><a class="reference internal" href="#abc">abc</a></li>
<li><a class="reference internal" href="#array">array</a></li>
<li><a class="reference internal" href="#base64">base64</a></li>
<li><a class="reference internal" href="#binascii">binascii</a></li>
<li><a class="reference internal" href="#bz2">bz2</a></li>
<li><a class="reference internal" href="#codecs">codecs</a></li>
<li><a class="reference internal" href="#collections">collections</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#crypt">crypt</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#datetime">datetime</a></li>
<li><a class="reference internal" href="#decimal">decimal</a><ul>
<li><a class="reference internal" href="#id1">フィーチャー</a></li>
<li><a class="reference internal" href="#id2">API の変更</a></li>
</ul>
</li>
<li><a class="reference internal" href="#email">email</a><ul>
<li><a class="reference internal" href="#policy-framework">ポリシーフレームワーク</a></li>
<li><a class="reference internal" href="#provisional-policy-with-new-header-api">新規ヘッダ API を伴った暫定ポリシー</a></li>
<li><a class="reference internal" href="#other-api-changes">その他のAPIの変更</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ftplib">ftplib</a></li>
<li><a class="reference internal" href="#functools">functools</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#hmac">hmac</a></li>
<li><a class="reference internal" href="#http">http</a></li>
<li><a class="reference internal" href="#html">html</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#io">io</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#logging">logging</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#mmap">mmap</a></li>
<li><a class="reference internal" href="#multiprocessing">multiprocessing</a></li>
<li><a class="reference internal" href="#nntplib">nntplib</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#pickle">pickle</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#re">re</a></li>
<li><a class="reference internal" href="#sched">sched</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#shlex">shlex</a></li>
<li><a class="reference internal" href="#shutil">shutil</a></li>
<li><a class="reference internal" href="#signal">signal</a></li>
<li><a class="reference internal" href="#smtpd">smtpd</a></li>
<li><a class="reference internal" href="#smtplib">smtplib</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#socketserver">socketserver</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#stat">stat</a></li>
<li><a class="reference internal" href="#struct">struct</a></li>
<li><a class="reference internal" href="#subprocess">subprocess</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#tarfile">tarfile</a></li>
<li><a class="reference internal" href="#tempfile">tempfile</a></li>
<li><a class="reference internal" href="#textwrap">textwrap</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#time">time</a></li>
<li><a class="reference internal" href="#types">types</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#urllib">urllib</a></li>
<li><a class="reference internal" href="#webbrowser">webbrowser</a></li>
<li><a class="reference internal" href="#xml-etree-elementtree">xml.etree.ElementTree</a></li>
<li><a class="reference internal" href="#zlib">zlib</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">最適化</a></li>
<li><a class="reference internal" href="#build-and-c-api-changes">ビルドならびに C API の変更</a></li>
<li><a class="reference internal" href="#deprecated">非推奨</a><ul>
<li><a class="reference internal" href="#unsupported-operating-systems">サポートされないオペレーティングシステム</a></li>
<li><a class="reference internal" href="#deprecated-python-modules-functions-and-methods">非推奨の Python モジュール、関数、メソッド</a></li>
<li><a class="reference internal" href="#deprecated-functions-and-types-of-the-c-api">C API の非推奨の関数ならびに型</a></li>
<li><a class="reference internal" href="#deprecated-features">非推奨の機能</a></li>
</ul>
</li>
<li><a class="reference internal" href="#porting-to-python-3-3">Python 3.3 への移植</a><ul>
<li><a class="reference internal" href="#porting-python-code">Python コードの移植</a></li>
<li><a class="reference internal" href="#porting-c-code">C コードの移植</a></li>
<li><a class="reference internal" href="#building-c-extensions">C 拡張のビルド</a></li>
<li><a class="reference internal" href="#command-line-switch-changes">コマンドラインスイッチの変更</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="3.4.html"
                        title="前の章へ">What's New In Python 3.4</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="3.2.html"
                        title="次の章へ">What's New In Python 3.2</a></p>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">バグ報告</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/3.8/Doc/whatsnew/3.3.rst"
            rel="nofollow">ソースコードを表示
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="3.2.html" title="What&#39;s New In Python 3.2"
             >次へ</a> |</li>
        <li class="right" >
          <a href="3.4.html" title="What&#39;s New In Python 3.4"
             >前へ</a> |</li>

    <li><img src="../_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    

    <li>
      <a href="../index.html">3.8.3 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >What's New in Python</a> &#187;</li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="クイック検索" type="text" name="q" />
          <input type="submit" value="検索" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">著作権</a> 2001-2020, Python Software Foundation.
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最終更新: 5月 15, 2020
    <a href="https://docs.python.org/3/bugs.html">Found a bug</a>?
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>

  </body>
</html>